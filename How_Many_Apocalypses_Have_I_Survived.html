<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>How Many Apocalypses Have I Survived?</title>
    <script src="http://js.cdn.tl/jquery-1.8.1.min.js"></script>
        <style>
            body {font-family:sans-serif;}
            #main {
                  display:-webkit-box;
                  display:-moz-box;
                  display:box;
            }
            #loading, #form, #results {
                -webkit-box-pack:center;
                -moz-box-pack:center;
                box-pack:center;
                -webkit-box-align:center;
                -moz-box-align:center;
                box-align:center;
            }
            #year, #submit {
                  display:inline-block;
                  font-size:2em;
                  line-height:1.5;
            }

            h1 {font-size:2em}
            #result, #form {display:none}
            #main {text-align:center;max-width:90%;min-width:50%;}
            #result {margin-top:1em;}
        </style>
</head>
<body>
    <div id="main">
<div id="loading">Loading<br/><img src="http://img.cdn.tl/loading20.gif" alt="" /></div>
<form id="form" action="#">
    <h1>How Many Apocalypses Have I Survived?</h1>
    <input type="text" id="year" placeholder="Year of Birth"/><button type="submit" id="submit">&raquo;</button>
</form>
<div id="result">
    <h2>You have survived the end <span id="counter"></span> times.</h2><p>Find out more on <a href="https://en.wikipedia.org/wiki/List_of_dates_predicted_for_apocalyptic_events">wikipedia</a></p> 
</div>
    </div>
<script>
    var getYears = [],
        count = 0,
        d = new Date(),
        currYear = d.getFullYear();
    $(function() {
        $.getJSON("http://en.wikipedia.org/w/api.php?action=parse&rvprop=content&page=List_of_dates_predicted_for_apocalyptic_events&format=json&callback=?", function(data) {
            $(data.parse.text["*"]).find("tr").each(function() {
                var origin = $(this).find("td:first").text();
                if (origin.search(/\d\d+/) != -1) {
                    getYears.push(origin.replace(/,/gi, ""));
                    $("#loading").hide();
                    $("#form").show();
                }
            });
        });
    });

    $("#form").on("submit", function(e) {
        e.preventDefault();
        var inputYear = parseInt($("#year").val(),10);
        if(!inputYear){
            $("#year").val("");
            alert("Try a number, genius.");
            return false;
        }
        getYears.map(function(item) {
            var yr = item.match(/\d{3,9}/);
            if (yr !== null && 
                (yr[0] >= inputYear) && 
                (yr[0] <= currYear)
            ) {
                count++;
            }
        });
        $("#counter").text(count);
        $("#result").show();
        count = 0;
        return false;
    });
</script>
</body>
</html>
