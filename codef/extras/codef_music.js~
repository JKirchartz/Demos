/*------------------------------------------------------------------------------
Copyright (c) 2011 Antoine Santo Aka NoNameNo

This File is part of the CODEF project. (http://code.google.com/p/codef/)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
------------------------------------------------------------------------------*/

var CODEF_MUSICPLAYER=null;
var CODEF_AUDIO_CONTEXT=null;
var CODEF_AUDIO_NODE=null;
function music(type){
if(typeof(webkitAudioContext) != 'undefined'){
	switch(type){
		case "MK":	CODEF_MUSICPLAYER = window.neoart.createMKPlayer(); // (Soundtracker 2.3, Soundtracker 2.5, NoiseTracker 1.0, NoiseTracker 1.1, NoiseTracker 2.0)
				break;
		case "FC":	CODEF_MUSICPLAYER = window.neoart.createFCPlayer(); // (FutureComposer 1.0, FutureComposer 1.2, FutureComposer 1.3, FutureComposer 1.4)
				break;
		case "YM":	CODEF_AUDIO_CONTEXT = new webkitAudioContext(); // Atari YM Format !!! ;)
				CODEF_AUDIO_NODE = CODEF_AUDIO_CONTEXT.createJavaScriptNode(8192);
				CODEF_MUSICPLAYER = new YmProcessor();
				break

	}
	CODEF_MUSICPLAYER.stereo=false;
}	
	if(type=="YM"){
		
		this.LoadAndRun=function(zic){
if(typeof(webkitAudioContext) != 'undefined'){
			var fetch = new XMLHttpRequest();
			fetch.open('GET', zic);
			fetch.overrideMimeType("text/plain; charset=x-user-defined");
			fetch.onreadystatechange = function() {
				if(this.readyState == 4 && this.status == 200) {
					var t = this.responseText || "" ;
					var ff = [];
					var mx = t.length;
					var scc= String.fromCharCode;
					for (var z = 0; z < mx; z++) {
						ff[z] = scc(t.charCodeAt(z) & 255);
					}
					var binString = new dataType();
					binString.data = ff.join("");
					YmConst_PLAYER_FREQ = CODEF_AUDIO_CONTEXT.sampleRate;

					CODEF_MUSICPLAYER.load(binString);
				}
			}
			fetch.send();
}
		}
	}
	else{
		this.LoadAndRun=function(zic){
if(typeof(webkitAudioContext) != 'undefined'){
			var fetch = new XMLHttpRequest();
			fetch.open('GET', zic);
			fetch.overrideMimeType("text/plain; charset=x-user-defined");
			fetch.responseType = "arraybuffer";
			fetch.onreadystatechange = function() {
				if(this.readyState == 4 && this.status == 200) {
					CODEF_MUSICPLAYER.load(this.response);
					CODEF_MUSICPLAYER.play();
				}
			}
			fetch.send();
}
		}
	}
	
	this.stereo=function(stat){
if(typeof(webkitAudioContext) != 'undefined'){
		CODEF_MUSICPLAYER.stereo=stat;
}
	}
	
	
	this.player=CODEF_MUSICPLAYER;
	return this;
	
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// YM replay routine
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////
//
// YmConst.js
//
////////////////////////////////////////////////////////////////////
	var YmConst_BUFFER_SIZE = 8192;
 	var YmConst_PLAYER_FREQ = 48000;
	var YmConst_DRUM_PREC = 15;

	var YmConst_AMSTRAD_FREQ = 1000000;
	var YmConst_ATARI_FREQ = 2000000;
	var YmConst_SPECTRUM_FREQ = 1773400;

	var YmConst_INTERLEAVED = 1;
	var YmConst_DRUM_SIGNED = 2;
	var YmConst_DRUM_4BITS = 4;
	var YmConst_TIME_CONTROL = 8;
	var YmConst_LOOP_MODE  = 16;

	var YmConst_MFP_PREDIV = [0, 4, 10, 16, 50, 64, 100, 200];

	var YmConst_MONO = [
      0.00063071586250394, 0.00163782667521185, 0.00269580167037975, 0.00383515935748365,
      0.00590024516535946, 0.00787377544480728, 0.01174962614825892, 0.01602221747489853,
      0.02299061047191789, 0.03141371908729311, 0.04648986276843572, 0.06340728985463016,
      0.09491256447035126, 0.13414919481999166, 0.21586759036022013, 0.33333333333333333
     ];

	var YmConst_STEREO = [
      0.00094607379375591, 0.00245674001281777, 0.00404370250556963, 0.00575273903622547,
      0.00885036774803918, 0.01181066316721091, 0.01762443922238838, 0.02403332621234779,
      0.03448591570787683, 0.04712057863093966, 0.06973479415265358, 0.09511093478194525,
      0.14236884670552690, 0.20122379222998749, 0.32380138554033021, 0.50000000000000000
    ];

	var YmConst_ENVELOPES = [
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0,15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0,
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0,15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0,
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0,
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,
      15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,
      15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0,
      15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,
       0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    ];
    
////////////////////////////////////////////////////////////////////
//
// YmSong.js
//
////////////////////////////////////////////////////////////////////
function YmSong(stream){
	this.title;
	this.author;
	this.comment;

	this.attribs;
	this.clock;
	this.digidrums;
	this.drums;
	this.frames=new Array();
	this.frameSize;
	this.length;
	this.rate;
	this.restart;
	this.supported = true;

	this.data = new dataType();
	this.data.data=stream;
	
	
	this.init=function(){
		this.decode();
		if (this.attribs & YmConst_INTERLEAVED) this.deinterleave();

		for (i = 0; i < this.length; ++i) {
			this.frames[i]=this.data.readBytes(0, this.frameSize);
		}

	}
	
	this.decode=function(){
		var digidrum;
		var i;
		var id= this.data.readMultiByte(4,"txt");
		
		switch (id) {
			case "YM2!":
			case "YM3!":
			case "YM3b":
				this.frameSize = 14;
				this.length = (this.data.data.length - 4) / this.frameSize;
				this.clock = YmConst_ATARI_FREQ;
				this.rate = 50;
				this.restart = (id != "YM3b") ? 0 : this.data.readByte();
				this.attribs = YmConst_INTERLEAVED | YmConst_TIME_CONTROL;
				break;

			case "YM4!":
				this.supported = false;
				break;
				
			case "YM5!":
			case "YM6!":
				id = this.data.readMultiByte(8, "txt");
				if (id != "LeOnArD!") {
					this.supported = false;
					return;
				}

				this.length  = this.data.readInt();
				this.attribs = this.data.readInt();
				this.drums   = this.data.readShort();
				this.clock   = this.data.readInt();
				this.rate    = this.data.readShort();
				this.restart = this.data.readInt();
				this.data.readShort();

				if (this.drums) {
					this.digidrums = new Array();

					for (i = 0; i < this.drums; ++i) {
						this.digidrum = new Digidrum(this.data.readInt());

						if (this.digidrum.size != 0) {
							this.digidrum.wave.data = this.data.readBytes(0, this.digidrum.size);
							this.digidrum.convert(this.attribs);
							this.digidrums[i] = this.digidrum;
						}
					}
					this.attribs &= (~YmConst_DRUM_4BITS);
				}

				this.title = this.data.readString();
				this.author = this.data.readString();
				this.comment = this.data.readString();

				this.frameSize = 16;
				this.attribs = YmConst_INTERLEAVED | YmConst_TIME_CONTROL;
				break;

			case "MIX1":
				supported = false;
				break;

			case "YMT1":
			case "YMT2":
				supported = false;
				break;

			default:
				supported = false;
				break;
		}

	}
	
	this.deinterleave=function(){
		var i;
		var j;
		var s=0;
		
		var p=new Array();
		var r=new Array();

		for (i = 0; i < this.frameSize; ++i) p[i] = this.data.pos + (this.length * i);

		for (i = 0; i < this.length; ++i) {
			for (j = 0; j < this.frameSize; ++j) r[j + s] = this.data.data[i + p[j]];
			s += this.frameSize;
		}

		this.data.data="";
		this.data.data = r;
		this.data.pos=0;
		this.attribs &= (~YmConst_INTERLEAVED);
	}
	
	this.init();
	
}

////////////////////////////////////////////////////////////////////
//
// YmProcessor.js
//
////////////////////////////////////////////////////////////////////
function YmProcessor(){
	this.counter;

	this.sound;
	this.soundChannel;
	this.soundChannelPos;
	this.song;
	this.loop=1;
	this.stereo=0;

	this.audioFreq;
	this.clock;
	this.registers=new Array();
	this.volumeEnv;

	this.buffer;
	this.bufferSize;
	this.voiceA=new YmChannel(this);;
	this.voiceB=new YmChannel(this);;
	this.voiceC=new YmChannel(this);;

	this.samplesTick;
	this.samplesLeft;
	this.frame;

	this.envData;
	this.envPhase;
	this.envPos;
	this.envShape;
	this.envStep;

	this.noiseOutput;
	this.noisePos;
	this.noiseStep;
	this.rng;

	this.syncBuzzer;
	this.syncBuzzerPhase;
	this.syncBuzzerStep;
	


	this.init=function(){
		var i;

		this.bufferSize = YmConst_BUFFER_SIZE;
		this.buffer = new Array();

		for (i = 0; i < this.bufferSize; ++i) this.buffer[i] = new Sample();

		this.envData = YmConst_ENVELOPES;
	}
	
	this.load=function(stream){
		var monLHa = new LHa();
		this.song = new YmSong(monLHa.unpack(stream));

		this.audioFreq = YmConst_PLAYER_FREQ;
		this.clock = this.song.clock;
		this.samplesTick = this.audioFreq / this.song.rate;

		CODEF_AUDIO_NODE.onaudioprocess = function (event) {
			CODEF_MUSICPLAYER.mixer(event);
		}

		
		return this.song.supported;
	}
	
	this.mixer=function(e){
		var b=0;
		var i=0;
		var mixed=0;
		var mixPos=0;
		var sample;
		var size=0;
		var toMix=0;
		var value=0;

		while (mixed < this.bufferSize) {
			if (this.samplesLeft == 0) {
				if (this.frame >= this.song.length) {
					if (this.loop) {
						this.frame = this.song.restart;
					} else {
						this.stop();
						return;
					}
				}

				this.syncBuzzerStop();
				
				for(i=0;i<this.song.frameSize;i++){
					this.registers[i]=this.song.frames[this.frame][i].charCodeAt(0);
				}
				this.frame++;
				//this.registers = this.song.frames[this.frame++];
				this.updateEffects(1, 6, 14);
				this.updateEffects(3, 8, 15);

				this.writeRegisters();
				this.samplesLeft = this.samplesTick;
			}

			toMix = this.samplesLeft;
			if ((mixed + toMix) > this.bufferSize)
				toMix = this.bufferSize - mixed;
			size = mixPos + toMix;

			for (i = mixPos; i < size; ++i) {
				sample = this.buffer[i];

				if (this.noisePos & 65536) {
					b = (this.rng & 1) ^ ((this.rng >> 2) & 1);
					this.rng = (this.rng >> 1) | (b << 16);
					this.noiseOutput ^= (b ? 0 : 65535);
					this.noisePos &= 65535;
				}

				this.volumeEnv = this.envData[Math.floor((this.envShape << 6) + (this.envPhase << 5) + (this.envPos >> 26))];

				this.voiceA.computeVolume();
				this.voiceB.computeVolume();
				this.voiceC.computeVolume();

				b = this.voiceA.enabled() & (this.noiseOutput | this.voiceA.mixNoise);
				var toto = this.voiceA.getvolume();
				sample.voiceA = (b) ? this.voiceA.getvolume() : -1;
				b = this.voiceB.enabled() & (this.noiseOutput | this.voiceB.mixNoise);
				sample.voiceB = (b) ? this.voiceB.getvolume() : -1;
				b = this.voiceC.enabled() & (this.noiseOutput | this.voiceC.mixNoise);
				sample.voiceC = (b) ? this.voiceC.getvolume() : -1;

				this.voiceA.next();
				this.voiceB.next();
				this.voiceC.next();

				this.noisePos += this.noiseStep;
				this.envPos += this.envStep;
				if (this.envPos > 2147483647)
					this.envPos -= 2147483647;
				if (this.envPhase == 0 && this.envPos < this.envStep) 
					envPhase = 1;

				if (this.syncBuzzer) {
					this.syncBuzzerPhase += this.syncBuzzerStep;

						if (this.syncBuzzerPhase & 1073741824) {
							this.envPos = 0;
							this.envPhase = 0;
							this.syncBuzzerPhase &= 0x3fffffff;
						}
				}
			}

			mixed += toMix;
			mixPos = size;
			this.samplesLeft -= toMix;
		}
		
		var l = event.outputBuffer.getChannelData(0);
		var r = event.outputBuffer.getChannelData(1);

		if (this.stereo) {
			for (i = 0; i < this.bufferSize; ++i) {
				sample = this.buffer[i];
				l[i]=sample.left();
				r[i]=sample.right();
			}
		} else {
			
			for (i = 0; i < this.bufferSize; ++i) {
				value = this.buffer[i].mono();
				l[i]=value;
				r[i]=value;
			}
		}
		
	}
	
	this.writeRegisters=function(){
		var p;

		this.registers[0] &= 255;
		this.registers[1] &= 15;
		this.voiceA.computeTone(this.registers[1], this.registers[0]);

		this.registers[2] &= 255;
		this.registers[3] &= 15;
		this.voiceB.computeTone(this.registers[3], this.registers[2]);

		this.registers[4] &= 255;
		this.registers[5] &= 15;
		this.voiceC.computeTone(this.registers[5], this.registers[4]);

		this.registers[6] &= 31;

		if (this.registers[6] < 3) {
			this.noisePos = 0;
			this.noiseOutput = 65535;
			this.noiseStep = 0;
		} else {
			p = this.clock / ((this.registers[6] << 3) * this.audioFreq);
			this.noiseStep = Math.floor(p * 32768);
		}

		this.registers[7] &= 255;

		this.voiceA.mixTone = (this.registers[7] & 1) ? 65535 : 0;
		this.voiceB.mixTone = (this.registers[7] & 2) ? 65535 : 0;
		this.voiceC.mixTone = (this.registers[7] & 4) ? 65535 : 0;

		this.voiceA.mixNoise = (this.registers[7] &  8) ? 65535 : 0;
		this.voiceB.mixNoise = (this.registers[7] & 16) ? 65535 : 0;
		this.voiceC.mixNoise = (this.registers[7] & 32) ? 65535 : 0;

		this.registers[8] &= 31;
		this.voiceA.setvolume(this.registers[8]);
		this.registers[9] &= 31;
		this.voiceB.setvolume(this.registers[9]);
		this.registers[10] &= 31;
		this.voiceC.setvolume(this.registers[10]);

		this.registers[11] &= 255;
		this.registers[12] &= 255;
		p = (this.registers[12] << 8) | this.registers[11];

		if (p < 3) {
			this.envStep = 0;
		} else {
			p = this.clock / ((p << 8) * this.audioFreq);
			this.envStep = Math.floor(p * 1073741824);
		}

		if (this.registers[13] == 255) {
			this.registers[13] = 0;
		} else {
			this.registers[13] &= 15;
			this.envPhase = 0;
			this.envPos = 0;
			this.envShape = this.registers[13];
		}
	}
	
	this.updateEffects=function(code, preDiv, count){
		var index=0;
		var tmpFreq=0;
		var voice=0;
		
		

		code   = this.registers[code] & 0xf0;
		preDiv = (this.registers[preDiv] >> 5) & 7;
		count  = this.registers[count];

		if (code & 0x30) {
			voice = ((code & 0x30) >> 4) - 1;

			switch (code & 0xc0) {
				case 0x00:
				case 0x80:
					break;
				case 0x40:
					index = this.registers[voice + 8] & 31;

					if ((index >= 0) && (index < this.song.drums)) {
						preDiv = YmConst_MFP_PREDIV[preDiv] * count;
						if (preDiv > 0) {
							tmpFreq = 2457600 / preDiv;

							if (voice == 0) {
								this.voiceA.drum = this.song.digidrums[index];
								this.voiceA.drumStart(tmpFreq);
							} else if (voice == 1) {
								this.voiceB.drum = this.song.digidrums[index];
								this.voiceB.drumStart(tmpFreq);
							} else if (voice == 2) {
								this.voiceC.drum = this.song.digidrums[index];
								this.voiceC.drumStart(tmpFreq);
							}
						}
					}
					break;
				case 0xc0:
					break;
			}
		}
	}

	
	this.syncBuzzerStart=function(timerFreq, shapeEnv){
		this.envShape = this.shapeEnv & 15;
		this.syncBuzzerStep = (this.timerFreq * 1073741824) / this.audioFreq;;
		this.syncBuzzerPhase = 0;
		this.syncBuzzer = true;
	}
    
	this.syncBuzzerStop=function(){
		this.syncBuzzer = false;
		this.syncBuzzerPhase = 0;
		this.syncBuzzerStep = 0;
	}
	
	this.stop=function(){
		
			this.reset();
			return true;
	}
	
	this.reset=function(){
		var i;

		this.voiceA = new YmChannel(this);
		this.voiceB = new YmChannel(this);
		this.voiceC = new YmChannel(this);
		this.samplesLeft = 0;
		this.frame = 0;

		this.registers = new Array();
		for (i = 0; i < 16; ++i) 
			this.registers[i]=0;
		this.registers[7] = 255;

		this.writeRegisters();
		this.volumeEnv = 0;

		this.noiseOutput = 65535;
		this.noisePos = 0;
		this.noiseStep = 0;
		this.rng = 1;

		this.envPhase = 0;
		this.envPos = 0;
		this.envShape = 0;
		this.envStep = 0;

		this.syncBuzzerStop();
	}
	
	this.init();
	this.reset();
	
	CODEF_AUDIO_NODE.connect(CODEF_AUDIO_CONTEXT.destination);


	
}
////////////////////////////////////////////////////////////////////
//
// Sample.js
//
////////////////////////////////////////////////////////////////////
function Sample(){
	this.voiceA = -1;
	this.voiceB = -1;
	this.voiceC = -1;



	this.mono=function(){
		var v = YmConst_MONO;
		var vol = 0.0;

		if (this.voiceA > -1) vol += v[this.voiceA];
		if (this.voiceB > -1) vol += v[this.voiceB];
		if (this.voiceC > -1) vol += v[this.voiceC];
		return vol;
	}

	this.left=function(){
		var v = YmConst_STEREO;
		var vol = 0.0;

		if (this.voiceA > -1) vol += v[this.voiceA];
		if (this.voiceB > -1) vol += v[this.voiceB];
		return vol;
	}

	this.right=function(){
		var v = YmConst_STEREO;
		var vol = 0.0;

		if (this.voiceB > -1) vol += v[this.voiceB];
		if (this.voiceC > -1) vol += v[this.voiceC];
		return vol;
	}
}
////////////////////////////////////////////////////////////////////
//
// YmChannel.js
//
////////////////////////////////////////////////////////////////////
function YmChannel(processor){
	this.mixNoise=0;
	this.mixTone=0;
	this.mode=0;
	this.position=0;
	this.step=0;

	this.digidrum=0;
	this.drum=0;
	this.drumPos=0;
	this.drumStep=0;

	this.processor = processor;
	this.vol=0;

	this.enabled=function(){
		return (this.position >> 30) | this.mixTone;
	}

	this.getvolume=function(){
		return (this.mode) ? this.processor.volumeEnv : this.vol;
	}

	this.setvolume=function(value){
		if(value & 16) 
			this.mode=true
		else 
			this.mode=false;
		this.vol = value;
	}

	this.next=function(){
		this.position += this.step;
		if (this.position > 2147483647) this.position -= 2147483647;
	}

	this.computeTone=function(high, low){
		var p = (high << 8) | low;

		if (p < 5) {
			this.position = 1073741824;
			this.step = 0;
		} else {
			p = this.processor.clock / ((p << 3) * this.processor.audioFreq);
			this.step = Math.floor(p * 1073741824);
		}
	}

	this.computeVolume=function(){
		var pos;

		if (this.digidrum) {
			pos = this.drumPos >> YmConst_DRUM_PREC;
			this.vol = this.drum.data[pos] / 16;//6;
			this.mixNoise = 65535;
			this.mixTone  = 65535;

			this.drumPos += this.drumStep;
			pos = this.drumPos >> YmConst_DRUM_PREC;
			if (pos >= this.drum.size) 
				this.digidrum = false;
		}
	}

	this.drumStart=function(drumFreq){
		this.digidrum = true;
		this.drumPos = 0;
		this.drumStep = (this.drumFreq << 15) / this.processor.audioFreq;
	}

	this.drumStop=function(){
		this.digidrum = false;
	}
	
}
////////////////////////////////////////////////////////////////////
//
// Digidrum.js
//
////////////////////////////////////////////////////////////////////
function Digidrum(size){
	this.data;
	this.repeatLen;
	this.size;
	this.wave=null;

	this.size = size;

	this.wave = new dataType();

	this.convert=function(attribs){
		var b;
		var i;
		this.data = new Array;

		if (attribs & YmConst_DRUM_4BITS) {
			for (i = 0; i < this.size; ++i) {
				b = (this.wave.readByte() & 15) >> 7;
				this.data[i] = YmConst_MONO[b];
			}
		} else {
			for (i = 0; i < this.size; ++i) {
				this.data[i] = this.wave.readByte();// / 255;
			}
		}
		this.wave = null;
	}

}

function dataType(){
	this.data;
	this.pos=0;
	this.endian="BIG";
	
	
	this.readBytes = function(offset, nb){
		var tmp="";
		for(var i=0;i<nb;i++){
			tmp+=this.data[offset+this.pos++];
		}
		return tmp;
	}
	
	this.readMultiByte = function(nb, type){
		if(type=="txt"){
			var tmp="";
			for(var i=0; i<nb; i++){
				tmp+=this.data[this.pos++]
			}
			return tmp;
		}
	}
	
	this.readInt = function(){
		var tmp1 = parseInt(this.data[this.pos+0].charCodeAt(0).toString(16),16);
		var tmp2 = parseInt(this.data[this.pos+1].charCodeAt(0).toString(16),16);
		var tmp3 = parseInt(this.data[this.pos+2].charCodeAt(0).toString(16),16);
		var tmp4 = parseInt(this.data[this.pos+3].charCodeAt(0).toString(16),16);
		if(this.endian=="BIG")
			var tmp = (tmp1<<24)|(tmp2<<16)|(tmp3<<8)|tmp4;
		else
			var tmp = (tmp4<<24)|(tmp3<<16)|(tmp2<<8)|tmp1;
		this.pos+=4;
		return tmp;
	}
	
	this.readShort = function(){
		var tmp1 = parseInt(this.data[this.pos+0].charCodeAt(0).toString(16),16);
		var tmp2 = parseInt(this.data[this.pos+1].charCodeAt(0).toString(16),16);
		var tmp = (tmp1<<8)|tmp2;
		this.pos+=2;
		return tmp;
	}
	this.readByte = function(){
		var tmp =  parseInt(this.data[this.pos].charCodeAt(0).toString(16),16)
		this.pos+=1;
		return tmp;
	}
	this.readString = function(){
		var tmp="";
		while(1){
			if(this.data[this.pos++].charCodeAt(0) !=0)
				tmp+=this.data[this.pos-1];
			else
				return tmp;
		}
	}

	this.substr= function(start, nb){
		return this.data.substr(start,nb);
	}
	
	this.bytesAvailable=function(){
		return this.length-this.pos;
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// LHA depack routine
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function LHa() {
	this.data;

	this.source;
	this.buffer;
	this.output;
	this.srcSize;
	this.dstSize;
	this.srcPos;
	this.dstPos;

	this.c_Table;
	this.p_Table;
	this.c_Len;
	this.p_Len;
	this.l_Tree;
	this.r_Tree;

	this.bitBuffer;
	this.bitCount;
	this.subBuffer;
	this.blockSize;
	this.fillBufferSize;
	this.fillIndex;
	this.decodei;
	this.decodej;


	this.data = "";
	this.buffer = new Array();
	this.output = new Array();

	this.c_Table = new Array();
	this.p_Table = new Array();
	this.c_Len = new Array();
	this.p_Len = new Array();
	this.l_Tree = new Array();
	this.r_Tree = new Array();


	this.unpack=function(source){
		this.header = new LHaHeader(source);
		if (this.header.size == 0 || this.header.method != "-lh5-" || this.header.level != 0) return source.data;

		this.source = source;
		this.srcSize = this.header.packed;
		this.srcPos = this.source.pos;
		this.dstSize = this.header.original;

		this.fillBufferSize = 0;
		this.bitBuffer = 0;
		this.bitCount = 0;
		this.subBuffer = 0;
		this.fillBuffer(16);
		this.blockSize = 0;
		this.decodej = 0;

		var l = this.dstSize;
		var n;
		var np;

		while (l != 0) {
			n = l > 8192 ? 8192 : l;
			this.decode(n);
			np = n > this.dstSize ? this.dstSize : n;

			if (np > 0) {
				this.output.pos = 0;
				for(var yop=0;yop<np;yop++){
					this.data+=String.fromCharCode(this.output[yop]);
				}
				this.dstPos += np;
				this.dstSize -= np;
			}

			l -= n;
		}
      
		this.buffer="";
		this.output=new Array;
		return this.data;
	}

	this.decode=function(count){
		var c;
		var r=0;

		while (--this.decodej >= 0) {
			this.output[r] = this.output[this.decodei];
			this.decodei = ++this.decodei & 8191;
			if (++r == count) return;
		}

		for (;;) {
			c = this.decode_c();

			if (c <= 255) {
				this.output[r] = c;
				if (++r == count) return;
			} 
			else {
				this.decodej = c - 253;
				this.decodei = (r - this.decode_p() - 1) & 8191;

				while (--this.decodej >= 0) {
					this.output[r] = this.output[this.decodei];
					this.decodei = ++this.decodei & 8191;
					if (++r == count) return;
				}
			}
		}
	}

	this.decode_c=function(){
		var j;
		var mask=0;

		if (this.blockSize == 0) {
			this.blockSize = this.getBits(16);
			this.read_p(19, 5, 3);
			this.read_c();
			this.read_p(14, 4, -1);
		}

		this.blockSize--;
		j = this.c_Table[this.bitBuffer >> 4];

		if (j >= 510) {
			mask = 1 << 3;

			do {
				j = (this.bitBuffer & mask) ? this.r_Tree[j] : this.l_Tree[j];
				mask >>= 1;
			} while (j >= 510);
		}

		this.fillBuffer(this.c_Len[j]);
		return j & 0xffff;
	}
    


	this.decode_p=function(){
		var j = this.p_Table[this.bitBuffer >> 8];
		var mask=0;

		if (j >= 14) {
			mask = 1 << 7;

			do {
				j = (this.bitBuffer & mask) ? this.r_Tree[j] : this.l_Tree[j];
				mask >>= 1;
			} while (j >= 14);
		}

		this.fillBuffer(this.p_Len[j]);
		if (j != 0) j = (1 << (j - 1)) + this.getBits(j - 1);
			return j & 0xffff;
	}

	this.read_c=function(){
		var c;
		var i=0;
		var mask=0
		var n = this.getBits(9);

		if (n == 0) {
			c = this.getBits(9);
			for (i = 0; i < 510; ++i) this.c_Len[i] = 0;
			for (i = 0; i < 4096; ++i) this.c_Table[i] = c;
		} else {
			while (i < n) {
				c = this.p_Table[this.bitBuffer >> 8];

				if (c >= 19) {
					mask = 1 << 7;
					do {
						c = (this.bitBuffer & mask) ? this.r_Tree[c] : this.l_Tree[c];
					mask >>= 1;
					} while (c >= 19);
				}	

				this.fillBuffer(this.p_Len[c]);

				if (c <= 2) {
					if (c == 0)
						c = 1;
					else if (c == 1)
						c = this.getBits(4) + 3;
					else
						c = this.getBits(9) + 20;

					while (--c >= 0) this.c_Len[i++] = 0;
				} else {
				this.c_Len[i++] = c - 2;
				}
			}

			while (i < 510) this.c_Len[i++] = 0;
			this.makeTable(510, this.c_Len, 12, this.c_Table);
		}
	}

	this.read_p=function(nn, nbit, iSpecial){
		var c;
		var i=0;
		var mask=0;
		var n = this.getBits(nbit);

		if (n == 0) {
			c = this.getBits(nbit);
			for (i = 0; i < nn; ++i) this.p_Len[i] = 0;
			for (i = 0; i < 256; ++i) this.p_Table[i] = c;
		} else {
			while (i < n) {
				c = this.bitBuffer >> 13;

				if (c == 7) {
					mask = 1 << 12;

					while (mask & this.bitBuffer) {
						mask >>= 1;
						c++;
					}
				}

				this.fillBuffer(c < 7 ? 3 : c - 3);
				this.p_Len[i++] = c;

				if (i == iSpecial) {
					c = this.getBits(2);
					while (--c >= 0) this.p_Len[i++] = 0;
				}
			}

			while (i < nn) this.p_Len[i++] = 0;
			this.makeTable(nn, this.p_Len, 8, this.p_Table);
		}
	}

	this.getBits=function(n){
		var r = this.bitBuffer >> (16 - n);
		this.fillBuffer(n);
		return r & 0xffff;
	}

	this.fillBuffer=function(n){
		var np;

		this.bitBuffer = (this.bitBuffer << n) & 0xffff;

		while (n > this.bitCount) {
			this.bitBuffer |= this.subBuffer << (n -= this.bitCount);
			this.bitBuffer &= 0xffff;

			if (this.fillBufferSize == 0) {
				this.fillIndex = 0;
				np = this.srcSize > 4064 ? 4064 : this.srcSize;

				if (np > 0) {
					this.source.pos = this.srcPos;
					this.buffer=this.source.readBytes(0, np);
					this.srcPos += np;
					this.srcSize -= np;
				}

				this.fillBufferSize = np;
			}

			if (this.fillBufferSize > 0) {
				this.fillBufferSize--;
				this.subBuffer = this.buffer[this.fillIndex++].charCodeAt(0);
			} else {
				this.subBuffer = 0;
			}

			this.bitCount = 8;
		}

		this.bitBuffer |= this.subBuffer >> (this.bitCount -= n);
		this.bitBuffer &= 0xffff;
	}

	this.makeTable=function(nchar, bitlen, tablebits, table){
		var a = nchar;
		var h;
		var i;
		var j;
		var k;
		var l; 
		var n;
		var p;
		var t;
		var r;
		var c = new Array();
		var w = new Array();
		var s = new Array();
		var mask = 1 << (15 - tablebits);
		for (i = 0; i < nchar; ++i)
			c[i]=0;

		for (i = 0; i < nchar; ++i) c[bitlen[i]]++;

		s[1] = 0;
		for (i = 1; i < 17; ++i) s[i + 1] = (s[i] + (c[i] << (16 - i))) & 0xffff;

		if (s[17] != 0) return false;
		j = 16 - tablebits;

		for (i = 1; i <= tablebits; ++i) {
			s[i] >>= j;
			w[i] = 1 << (tablebits - i);
		}

		while (i < 17) w[i] = 1 << (16 - i++);
		i = s[tablebits + 1] >> j;

		if (i != 0) {
			k = 1 << tablebits;
			while (i != k) table[i++] = 0;
		}

		for (h = 0; h < nchar; ++h) {
			if ((l = bitlen[h]) == 0) continue;
			n = s[l] + w[l];

			if (l <= tablebits) {
				for (i = s[l]; i < n; ++i) table[i] = h;
			} else {
				i = l - tablebits;
				k = s[l];
				p = k >> j;
				t = table;

				while (i != 0) {
					if (t[p] == 0) {
						this.l_Tree[a] = 0;
						this.r_Tree[a] = 0;
						t[p] = a++;
					}

					r = (k & mask) ? this.r_Tree : this.l_Tree;
					k <<= 1;
					i--;
				}

				r[t[p]] = h;
			}
			s[l] = n;
		}

		return true;
	}
    
}


function LHaHeader(source) {
	this.size;
	this.checksum;
	this.method;
	this.packed;
	this.original;
	this.timeStamp;
	this.attribute;
	this.level;
	this.nameLength;
	this.name;

	source.endian = "LITTLE";
	source.pos = 0;

	this.size = source.readByte();
	this.checksum = source.readByte();
	this.method = source.readMultiByte(5, "txt");
	this.packed = source.readInt();
	this.original = source.readInt();
	this.timeStamp = source.readInt();
	this.attribute = source.readByte();
	this.level = source.readByte();
	this.nameLength = source.readByte();
	this.name = source.readMultiByte(this.nameLength, "txt");

	source.readShort();
}


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// MOD replay routine
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
(function(){
	window.neoart=Object.create(null);
	function createByteArray(b){
		var a=Object.create(null,{buffer:{value:null,writable:!0},view:{value:null,writable:!0},endian:{value:1,writable:!0},length:{value:0,writable:!0},currpos:{value:0,writable:!0},bytesAvailable:{get:function(){return this.length-this.currpos}},position:{get:function(){return this.currpos},set:function(a){if(0>a)a=0;else if(a>this.length)a=this.length;this.currpos=a}},readByte:{value:function(){var a=this.view.getInt8(this.currpos);this.currpos++;return a}},readShort:{value:function(){var a=this.view.getInt16(this.currpos,this.endian);this.currpos+=2;return a}},readInt:{value:function(){var a=this.view.getInt32(this.currpos,this.endian);this.currpos+=4;return a}},readUnsignedByte:{value:function(){var a=this.view.getUint8(this.currpos);this.currpos++;return a}},readUnsignedShort:{value:function(){var a=this.view.getUint16(this.currpos,this.endian);this.currpos+=2;return a}},readUnsignedInt:{value:function(){var a=this.view.getUint32(this.currpos,this.endian);this.currpos+=4;return a}},readBytes:{value:function(a,b,c){var d=this.currpos,c=c+d;if(c>this.length)c=this.length;for(;d<c;++d)a.setInt8(b++,this.view.getInt8(d))}},readString:{value:function(a){for(var b=this.currpos,c="",a=a+this.currpos;b<a;++b)c+=String.fromCharCode(this.view.getUint8(b));this.currpos=a;return c}},writeByte:{value:function(a){this.view.setInt8(this.currpos,a);this.currpos++}},writeInt:{value:function(a){this.view.setInt32(this.currpos,a,this.endian);this.currpos+=4}}});
		a.buffer=b;
		a.view=new DataView(b);
		a.length=b.byteLength;
		return Object.seal(a)
	}
	
	function createSample(){
		return Object.create(null,{l:{value:0,writable:!0},r:{value:0,writable:!0},next:{value:null,writable:!0}})
	}
	
	function createCoreMixer(){
		return Object.create(null,{player:{value:null,writable:!0},channels:{value:[],writable:!0},buffer:{value:[],writable:!0},samplesTick:{value:0,writable:!0},samplesLeft:{value:0,writable:!0},completed:{value:0,writable:!0},remains:{value:0,writable:!0},bufferSize:{get:function(){return this.buffer.length},set:function(b){var a;a=this.buffer.length||0;if(b!=a&&(this.buffer.length=b,b>a)){this.buffer[a]=createSample();for(a=++a;a<b;++a)this.buffer[a]=this.buffer[a-1].next=createSample()}}},complete:{get:function(){return this.completed},set:function(b){this.completed=b^this.player.loopSong}},core_initialize:{value:function(){var b=this.channels[0],a=this.buffer[0];for(this.samplesLeft=this.remains=this.completed=0;b;)b.initialize(),b=b.next;for(;a;)a.l=a.r=0,a=a.next}},reset:{configurable:!0,value:function(){}}})
	}
	
	function createCorePlayer(){
		var b=Object.create(null,{context:{value:null,writable:!0},node:{value:null,writable:!0},analyse:{value:0,writable:!0},sampleRate:{value:0,writable:!0},version:{value:0,writable:!0},title:{value:"",writable:!0},channels:{value:0,writable:!0},loopSong:{value:1,writable:!0},speed:{value:0,writable:!0},tempo:{value:0,writable:!0},mixer:{value:null,writable:!0},tick:{value:0,writable:!0},timer:{value:0,writable:!0},endian:{value:0,writable:!0},paused:{value:0,writable:!0},callback:{value:null,writable:!0},quality:{configurable:!0,set:function(a){this.callback=a?this.mixer.accurate.bind(this.mixer):this.mixer.fast.bind(this.mixer)}},toggle:{set:function(a){this.mixer.channels[a].mute^=1}},core_initialize:{value:function(){this.timer=this.speed;this.tick=0;this.mixer.initialize();this.mixer.samplesTick=2.5*this.sampleRate/this.tempo>>0}},load:{value:function(a){this.mixer.reset();this.version=0;a=createByteArray(a);a.endian=this.endian;this.loader(a);this.version&&this.setup();return this.version}},play:{value:function(){var a=this.callback,b;if(this.version)this.paused?this.paused=0:(this.initialize(),this.node=this.context.createJavaScriptNode(this.mixer.bufferSize),this.node.onaudioprocess=function(b){a(b)}),this.analyse?(node=neoart.analyserNode=this.context.createAnalyser(),this.node.connect(node),node.connect(this.context.destination)):this.node.connect(this.context.destination),b=document.createEvent("Event"),b.initEvent("flodPlay",!0,!1),document.dispatchEvent(b)}},pause:{value:function(){if(this.node){this.node.disconnect();this.paused=1;var a=document.createEvent("Event");a.initEvent("flodPause",!0,!1);document.dispatchEvent(a)}}},stop:{value:function(){if(this.node){this.node.disconnect();this.node.onaudioprocess=this.node=null;this.paused=0;var a=document.createEvent("Event");a.initEvent("flodStop",!0,!1);document.dispatchEvent(a)}}},setup:{configurable:!0,value:function(){}}});
		if(!window.neoart.AudioContext)window.neoart.AudioContext=new webkitAudioContext;
		b.context=window.neoart.AudioContext;
		b.sampleRate=b.context.sampleRate;
		return b
	};
	
	function createAmigaChannel(c){
		c=0==(++c&2)?-1:1;
		return Object.create(null,{next:{value:null,writable:!0},mute:{value:0,writable:!0},panning:{value:c,writable:!0},delay:{value:0,writable:!0},pointer:{value:0,writable:!0},length:{value:0,writable:!0},audena:{value:0,writable:!0},audcnt:{value:0,writable:!0},audloc:{value:0,writable:!0},audper:{value:0,writable:!0},audvol:{value:0,writable:!0},timer:{value:0,writable:!0},level:{value:c,writable:!0},ldata:{value:0,writable:!0},rdata:{value:0,writable:!0},enabled:{set:function(a){if(a!=this.audena)this.audena=a,this.audloc=this.pointer,this.audcnt=this.pointer+this.length,this.timer=1,a&&(this.delay+=2)}},period:{set:function(a){if(1>a||65536<a)a=65536;this.audper=a}},volume:{set:function(a){0>a?a=0:64<a&&(a=64);this.audvol=a}},initialize:{value:function(){this.audloc=this.audcnt=this.audena=0;this.audper=50;this.length=this.pointer=this.delay=this.rdata=this.ldata=this.timer=this.audvol=0}}})
	}
	
	function createAmigaFilter(){
		return Object.create(null,{active:{value:0,writable:!0},forced:{value:-1,writable:!0},l0:{value:0,writable:!0},l1:{value:0,writable:!0},l2:{value:0,writable:!0},l3:{value:0,writable:!0},l4:{value:0,writable:!0},r0:{value:0,writable:!0},r1:{value:0,writable:!0},r2:{value:0,writable:!0},r3:{value:0,writable:!0},r4:{value:0,writable:!0},initialize:{value:function(){this.r0=this.r1=this.r2=this.r3=this.r4=this.l0=this.l1=this.l2=this.l3=this.l4=0}},process:{value:function(c,a){var b=0.5139651662784244;if(0==c)this.l0=0.4860348337215757*a.l+b*this.l0,this.r0=0.4860348337215757*a.r+b*this.r0,b=0.06850445132502514,a.l=this.l1=0.9314955486749749*this.l0+b*this.l1,a.r=this.r1=0.9314955486749749*this.r0+b*this.r1;if(0<(this.active|this.forced))b=0.47866541564678,this.l2=0.52133458435322*a.l+b*this.l2,this.r2=0.52133458435322*a.r+b*this.r2,this.l3=0.52133458435322*this.l2+b*this.l3,this.r3=0.52133458435322*this.r2+b*this.r3,a.l=this.l4=0.52133458435322*this.l3+b*this.l4,a.r=this.r4=0.52133458435322*this.r3+b*this.r4;if(1<a.l)a.l=1;else if(-1>a.l)a.l=-1;if(1<a.r)a.r=1;else if(-1>a.r)a.r=-1}}})
}

function createAmiga(){
	var c=createCoreMixer();
	Object.defineProperties(c,{filter:{value:null,writable:!0},model:{value:1,writable:!0},memory:{value:[],writable:!0},loopPtr:{value:0,writable:!0},loopLen:{value:4,writable:!0},clock:{value:0,writable:!0},master:{value:0,writable:!0},ready:{value:0,writable:!0},volume:{set:function(a){0<a?(64<a&&(a=64),this.master=0.00390625*(a/64>>0)):this.master=0}},initialize:{value:function(){var a=this.memory.length,b=a+this.loopLen;this.core_initialize();this.filter.initialize();if(!this.ready){this.ready=1;for(this.loopPtr=a;a<b;++a)this.memory[a]=0}}},reset:{configurable:!1,value:function(){this.ready=0;this.memory.length=0}},store:{value:function(a,b,c){var j,e,g=a.position,h=this.memory.length;if(c)a.position=c;e=a.position+b;e>=a.length&&(j=e-a.length,b=a.length-a.position);for(e=h,b+=h;e<b;++e)this.memory[e]=a.readByte();for(b+=j;e<b;++e)this.memory[e]=0;if(c)a.position=g;return h}},fast:{value:function(a){var b,c,j=this.memory,e,g=0,h,l=0,m,d,f=this.bufferSize,n,k,i;if(this.completed){if(!this.remains){this.player.stop();return}f=this.remains}for(;g<f;){if(!this.samplesLeft&&(this.player.process(),this.samplesLeft=this.samplesTick,this.completed&&(f=g+this.samplesTick,f>this.bufferSize)))this.remains=f-this.bufferSize,f=this.bufferSize;k=this.samplesLeft;g+k>=f&&(k=f-g);h=l+k;for(b=this.channels[0];b;){d=this.buffer[l];if(b.audena){n=b.audper/this.clock;i=b.audvol*this.master;e=i*(1-b.level);m=i*(1+b.level);for(c=l;c<h;++c)if(b.delay)b.delay--;else{if(1>--b.timer){if(!b.mute)i=0.0078125*j[b.audloc],b.ldata=i*e,b.rdata=i*m;b.audloc++;b.timer+=n;if(b.audloc>=b.audcnt)b.audloc=b.pointer,b.audcnt=b.pointer+b.length}d.l+=b.ldata;d.r+=b.rdata;d=d.next}}else for(c=l;c<h;++c)d.l+=b.ldata,d.r+=b.rdata,d=d.next;b=b.next}l=h;g+=k;this.samplesLeft-=k}d=this.buffer[0];b=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);j=this.filter;i=this.model;for(c=0;c<f;++c)j.process(i,d),b[c]=d.l,a[c]=d.r,d.l=d.r=0,d=d.next}},createRow:{configurable:!0,value:function(){return Object.create(null,{note:{value:0,writable:!0},sample:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0}})}},createSample:{configurable:!0,value:function(){return Object.create(null,{name:{value:"",writable:!0},length:{value:0,writable:!0},loop:{value:0,writable:!0},repeat:{value:0,writable:!0},volume:{value:0,writable:!0},pointer:{value:0,writable:!0},loopPtr:{value:0,writable:!0}})}}});
	c.bufferSize=8192;
	c.filter=createAmigaFilter();
	c.master=0.00396025;
	c.channels[0]=createAmigaChannel(0);
	c.channels[0].next=c.channels[1]=createAmigaChannel(1);
	c.channels[1].next=c.channels[2]=createAmigaChannel(2);
	c.channels[2].next=c.channels[3]=createAmigaChannel(3);
	return Object.seal(c)
	
}

function createAmigaPlayer(c){
	var a=createCorePlayer();
	Object.defineProperties(a,{playSong:{value:0,writable:!0},lastSong:{value:1,writable:!0},standard:{value:0,writable:!0},quality:{configurable:!1,set:function(){this.callback=this.mixer.fast.bind(this.mixer)}},stereo:{set:function(b){var a=this.mixer.channels[0];for(0>b?b=0:1<b&&(b=1);a;)a.level=b*a.panning,a=a.next}},volume:{set:function(a){0>a?a=0:1<a&&(a=1);this.mixer.master=0.00390625*a}},mode:{value:function(a){(this.standard=a)?(this.mixer.clock=3579545/this.sampleRate,this.mixer.samplesTick=735):(this.mixer.clock=3546895/this.sampleRate,this.mixer.samplesTick=882)}}});
	a.mixer=c||createAmiga();
	a.mixer.player=a;a.mode(0);
	a.endian=0;
	a.quality=0;
	a.speed=6;
	a.tempo=125;
	return a
	
}

function createSBChannel(){
	return Object.create(null,{next:{value:null,writable:!0},mute:{value:0,writable:!0},enabled:{value:0,writable:!0},sample:{value:null,writable:!0},length:{value:0,writable:!0},index:{value:0,writable:!0},pointer:{value:0,writable:!0},delta:{value:0,writable:!0},fraction:{value:0,writable:!0},speed:{value:0,writable:!0},dir:{value:0,writable:!0},oldSample:{value:null,writable:!0},oldLength:{value:0,writable:!0},oldPointer:{value:0,writable:!0},oldFraction:{value:0,writable:!0},oldSpeed:{value:0,writable:!0},oldDir:{value:0,writable:!0},volume:{value:0,writable:!0},lvol:{value:0,writable:!0},rvol:{value:0,writable:!0},panning:{value:128,writable:!0},lpan:{value:0.5,writable:!0},rpan:{value:0.5,writable:!0},ldata:{value:0,writable:!0},rdata:{value:0,writable:!0},mixCounter:{value:0,writable:!0},lmixRampU:{value:0,writable:!0},lmixDeltaU:{value:0,writable:!0},rmixRampU:{value:0,writable:!0},rmixDeltaU:{value:0,writable:!0},lmixRampD:{value:0,writable:!0},lmixDeltaD:{value:0,writable:!0},rmixRampD:{value:0,writable:!0},rmixDeltaD:{value:0,writable:!0},volCounter:{value:0,writable:!0},lvolDelta:{value:0,writable:!0},rvolDelta:{value:0,writable:!0},panCounter:{value:0,writable:!0},lpanDelta:{value:0,writable:!0},rpanDelta:{value:0,writable:!0},initialize:{value:function(){this.enabled=0;this.sample=null;this.dir=this.speed=this.fraction=this.delta=this.pointer=this.index=this.length=0;this.oldSample=null;this.rvol=this.lvol=this.volume=this.oldDir=this.oldSpeed=this.oldFraction=this.oldPointer=this.oldLength=0;this.panning=128;this.rpan=this.lpan=0.5;this.rpanDelta=this.lpanDelta=this.panCounter=this.rvolDelta=this.lvolDelta=this.volCounter=this.rmixDeltaD=this.rmixRampD=this.lmixDeltaD=this.lmixRampD=this.rmixDeltaU=this.rmixRampU=this.lmixDeltaU=this.lmixRampU=this.mixCounter=this.rdata=this.ldata=0}}})
	}


	function createSoundblaster(){
		var q=createCoreMixer();
		Object.defineProperties(q,{setup:{value:function(b){var a=1;this.channels=[];this.channels.length=b;for(this.channels[0]=createSBChannel();a<b;++a)this.channels[a]=this.channels[a-1].next=createSBChannel()}},initialize:{value:function(){this.core_initialize()}},fast:{value:function(b){var a,g,e,f=0,k,m=0,l,d,i=this.bufferSize,h,j;if(this.completed){if(!this.remains){this.player.stop();return}i=this.remains}for(;f<i;){if(!this.samplesLeft&&(this.player.process(),this.player.fast(),this.samplesLeft=this.samplesTick,this.completed&&(i=f+this.samplesTick,i>this.bufferSize)))this.remains=i-this.bufferSize,i=this.bufferSize;h=this.samplesLeft;f+h>=i&&(h=i-f);k=m+h;for(a=this.channels[0];a;){if(a.enabled){l=a.sample;g=l.data;d=this.buffer[m];for(e=m;e<k;++e){if(a.index!=a.pointer){if(a.index>=a.length)if(l.loopMode){if(a.pointer=l.loopStart+(a.index-a.length),a.length=l.length,2==l.loopMode)a.dir=a.dir?0:l.length+l.loopStart-1}else{a.enabled=0;break}else a.pointer=a.index;a.mute?(a.ldata=0,a.rdata=0):(j=a.dir?g[a.dir-a.pointer]:g[a.pointer],a.ldata=j*a.lvol,a.rdata=j*a.rvol)}a.index=a.pointer+a.delta;if(1<=(a.fraction+=a.speed))a.index++,a.fraction--;d.l+=a.ldata;d.r+=a.rdata;d=d.next}}a=a.next}m=k;f+=h;this.samplesLeft-=h}d=this.buffer[0];a=b.outputBuffer.getChannelData(0);b=b.outputBuffer.getChannelData(1);for(e=0;e<i;++e){if(1<d.l)d.l=1;else if(-1>d.l)d.l=-1;if(1<d.r)d.r=1;else if(-1>d.r)d.r=-1;a[e]=d.l;b[e]=d.r;d.l=d.r=0;d=d.next}}},accurate:{value:function(b){var a,g,e,f,k,m=0,l,d=0,i,h,j,c,o=this.bufferSize,p,n;if(this.completed){if(!this.remains){this.player.stop();return}o=this.remains}for(;m<o;){if(!this.samplesLeft&&(this.player.process(),this.player.accurate(),this.samplesLeft=this.samplesTick,this.completed&&(o=m+this.samplesTick,o>this.bufferSize)))this.remains=o-this.bufferSize,o=this.bufferSize;p=this.samplesLeft;m+p>=o&&(p=o-m);l=d+p;for(a=this.channels[0];a;){if(a.enabled){h=a.sample;g=h.data;if(j=a.oldSample)e=j.data;c=this.buffer[d];for(k=d;k<l;++k){n=a.mute?0:g[a.pointer];n+=(g[a.pointer+a.dir]-n)*a.fraction;if(1<=(a.fraction+=a.speed))if(f=a.fraction>>0,a.fraction-=f,0<a.dir){if(a.pointer+=f,a.pointer>a.length)a.fraction+=a.pointer-a.length,a.pointer=a.length}else if(a.pointer-=f,a.pointer<a.length)a.fraction+=a.length-a.pointer,a.pointer=a.length;if(a.mixCounter){if(j){i=a.mute?0:e[a.oldPointer];i+=(e[a.oldPointer+a.oldDir]-i)*a.oldFraction;if(1<(a.oldFraction+=a.oldSpeed))if(f=a.oldFraction>>0,a.oldFraction-=f,0<a.oldDir){if(a.oldPointer+=f,a.oldPointer>a.oldLength)a.oldFraction+=a.oldPointer-a.oldLength,a.oldPointer=a.oldLength}else if(a.oldPointer-=f,a.oldPointer<a.oldLength)a.oldFraction+=a.oldLength-a.oldPointer,a.oldPointer=a.oldLength;c.l+=n*a.lmixRampU+i*a.lmixRampD;c.r+=n*a.rmixRampU+i*a.rmixRampD;a.lmixRampD-=a.lmixDeltaD;a.rmixRampD-=a.rmixDeltaD}else c.l+=n*a.lmixRampU,c.r+=n*a.rmixRampU;a.lmixRampU+=a.lmixDeltaU;a.rmixRampU+=a.rmixDeltaU;a.mixCounter--;if(a.oldPointer==a.oldLength)j.loopMode?1==j.loopMode?(a.oldPointer=j.loopStart,a.oldLength=j.length):0<a.oldDir?(a.oldPointer=j.length-1,a.oldLength=j.loopStart,a.oldDir=-1):(a.oldFraction-=1,a.oldPointer=j.loopStart,a.oldLength=j.length,a.oldDir=1):(j=null,a.oldPointer=0)}else if(c.l+=n*a.lvol,c.r+=n*a.rvol,a.volCounter)a.lvol+=a.lvolDelta,a.rvol+=a.rvolDelta,a.volCounter--;else if(a.panCounter)a.lpan+=a.lpanDelta,a.rpan+=a.rpanDelta,a.panCounter--,a.lvol=a.volume*a.lpan,a.rvol=a.volume*a.rpan;if(a.pointer==a.length)if(h.loopMode)1==h.loopMode?(a.pointer=h.loopStart,a.length=h.length):0<a.dir?(a.pointer=h.length-1,a.length=h.loopStart,a.dir=-1):(a.fraction-=1,a.pointer=h.loopStart,a.length=h.length,a.dir=1);else{a.enabled=0;break}c=c.next}}a=a.next}d=l;m+=p;this.samplesLeft-=p}c=this.buffer[0];a=b.outputBuffer.getChannelData(0);b=b.outputBuffer.getChannelData(1);for(k=0;k<o;++k){if(1<c.l)c.l=1;else if(-1>c.l)c.l=-1;if(1<c.r)c.r=1;else if(-1>c.r)c.r=-1;a[k]=c.l;b[k]=c.r;c.l=c.r=0;c=c.next}}},createSample:{value:function(){return Object.create(null,{name:{value:"",writable:!0},bits:{value:8,writable:!0},volume:{value:0,writable:!0},panning:{value:0,writable:!0},finetune:{value:0,writable:!0},relative:{value:0,writable:!0},length:{value:0,writable:!0},data:{value:[],writable:!0},loopMode:{value:0,writable:!0},loopStart:{value:0,writable:!0},loopLen:{value:0,writable:!0},store:{value:function(b){var a=0,g,e=this.length,f;if(!this.loopLen)this.loopMode=0;f=b.position;this.data=new Float32Array;this.loopMode?(e=this.loopStart+this.loopLen,this.data.length=e+1):this.data.length=this.length+1;if(8==this.bits){f+e>b.length&&(e=b.length-f);for(g=0;g<e;g++)a=b.readByte()+a,-128>a?a+=256:127<a&&(a-=256),this.data[g]=0.0078125*a}else{f+(e<<1)>b.length&&(e=b.length-f>>1);for(g=0;g<e;g++)a=b.readShort()+a,-32768>a?a+=65536:32767<a&&(a-=65536),this.data[g]=3.051758E-5*a}a=f+length;this.loopMode?(this.length=this.loopStart+this.loopLen,this.data[e]=1==this.loopMode?this.data[this.loopStart]:this.data[e-1]):this.data[this.length]=0;if(e!=this.length){f=this.data[e-1];for(g=e;g<this.length;g++)this.data[g]=f}b.position=a<b.length?a:b.length-1}}})}}});
		q.bufferSize=8192;
		return Object.seal(q)
		
	}

	function createSBPlayer(q){
		var b=createCorePlayer();
		Object.defineProperties(b,{track:{value:null,writable:!0},length:{value:0,writable:!0},restart:{value:0,writable:!0},master:{value:0,writable:!0},setup:{configurable:!1,value:function(){this.mixer.setup(this.channels)}}});
		b.mixer=q||createSoundblaster();
		b.mixer.player=b;
		b.endian=1;
		b.quality=1;
		return b
	}
	
	(function(){
		function h(e){
			return Object.create(null,{index:{value:e,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},period:{value:0,writable:!0},last:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.param=this.effect=this.last=this.period=this.enabled=0}}})
		}
		
		window.neoart.createSTPlayer=function(e){
			e=createAmigaPlayer(e);
			Object.defineProperties(e,{id:{value:"STPlayer"},track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},force:{set:function(b){b<i?b=i:b>j&&(b=j);this.version=b}},ntsc:{set:function(b){this.mode(b);if(this.version<k)b=(b?20.44952532:20.637767904)*(this.sampleRate/1E3)/120,this.mixer.samplesTick=(240-this.tempo)*b>>0}},initialize:{value:function(){var b=this.voices[0];this.core_initialize();this.ntsc=this.standard;this.timer=6;for(this.jumpFlag=this.patternPos=this.trackPos=0;b;)b.initialize(),b.channel=this.mixer.channels[b.index],b.sample=this.samples[0],b=b.next}},loader:{value:function(b){var d=0,c,a,e=0,g=0,f;if(!(1626>b.length)){this.title=b.readString(20);e+=this.isLegal(this.title);this.version=i;b.position=42;for(c=1;16>c;++c)if(f=b.readUnsignedShort()){if(a=this.mixer.createSample(),b.position-=24,a.name=b.readString(22),a.length=f<<1,b.position+=3,a.volume=b.readUnsignedByte(),a.loop=b.readUnsignedShort(),a.repeat=b.readUnsignedShort()<<1,b.position+=22,a.pointer=g,g+=a.length,this.samples[c]=a,e+=this.isLegal(a.name),9999<a.length)this.version=k}else this.samples[c]=null,b.position+=28;b.position=470;this.length=b.readUnsignedByte();this.tempo=b.readUnsignedByte();for(c=0;128>c;++c)f=b.readUnsignedByte()<<8,16384<f&&e--,this.track[c]=f,f>d&&(d=f);b.position=600;d+=256;this.patterns=[];this.patterns.length=d;c=b.length-g-600>>2;d>c&&(d=c);for(c=0;c<d;++c){a=this.mixer.createRow();a.note=b.readUnsignedShort();f=b.readUnsignedByte();a.param=b.readUnsignedByte();a.effect=f&15;a.sample=f>>4;this.patterns[c]=a;2<a.effect&&11>a.effect&&e--;a.note&&(113>a.note||856<a.note)&&e--;if(a.sample&&(15<a.sample||!this.samples[a.sample]))15<a.sample&&e--,a.sample=0;if(2<a.effect||0==a.effect&&0!=a.param)this.version=m;if(11==a.effect||13==a.effect)this.version=j}this.mixer.store(b,g);for(c=1;16>c;++c)if(a=this.samples[c]){a.loop?(a.loopPtr=a.pointer+a.loop,a.pointer=a.loopPtr,a.length=a.repeat):(a.loopPtr=this.mixer.memory.length,a.repeat=2);g=a.pointer+4;for(b=a.pointer;b<g;++b)this.mixer.memory[b]=0}a=this.mixer.createSample();a.pointer=a.loopPtr=this.mixer.memory.length;a.length=a.repeat=2;this.samples[0]=a;if(1>e)this.version=0}}},process:{value:function(){var f;var b,d,c,a=this.voices[0];if(this.tick)for(;a;){if(0!=a.param)if(b=a.channel,this.version==i)if(1==a.effect)this.arpeggio(a);else{if(2==a.effect)c=a.param>>4,a.period=c?a.period+c:a.period-(a.param&15),b.period=a.period}else{switch(a.effect){case 0:this.arpeggio(a);break;case 1:a.period-=a.param&15;if(113>a.period)a.period=113;b.period=a.period;break;case 2:a.period+=a.param&15;if(856<a.period)a.period=856;b.period=a.period}if(2!=(this.version&2)){a=a.next;continue}switch(a.effect){case 12:b.volume=a.param;break;case 13:this.mixer.filter.active=0;break;case 14:this.timer=a.param&15}}a=a.next}else for(c=this.track[this.trackPos]+this.patternPos;a;){b=a.channel;a.enabled=0;d=this.patterns[c+a.index];a.period=d.note;a.effect=d.effect;a.param=d.param;d.sample?(f=a.sample=this.samples[d.sample],d=f,b.volume=2==(this.version&2)&&12==a.effect?a.param:d.volume):d=a.sample;if(a.period)a.enabled=1,b.enabled=0,b.pointer=d.pointer,b.length=d.length,b.period=a.last=a.period;if(a.enabled)b.enabled=1;b.pointer=d.loopPtr;b.length=d.repeat;if(!(this.version<j))switch(a.effect){case 11:this.trackPos=a.param-1;this.jumpFlag^=1;break;case 12:b.volume=a.param;break;case 13:this.jumpFlag^=1;break;case 14:this.mixer.filter.active=a.param^1;break;case 15:if(0==a.param)break;this.timer=a.param&15;this.tick=0}a=a.next}if(++this.tick==this.timer&&(this.tick=0,this.patternPos+=4,256==this.patternPos||this.jumpFlag))if(this.patternPos=this.jumpFlag=0,++this.trackPos==this.length)this.trackPos=0,this.mixer.complete=1}},arpeggio:{value:function(b){var d=b.channel,c=0,a=this.tick%3;if(a){for(a=1==a?b.param>>4:b.param&15;b.last!=l[c];)c++;d.period=l[c+a]}else d.period=b.last}},isLegal:{value:function(b){var d,c=0,a=b.length;if(!a)return 0;for(;c<a;++c)if((d=b.charCodeAt(c))&&(32>d||127<d))return 0;return 1}}});
			e.track=new Uint32Array(128);
			e.voices[0]=h(0);
			e.voices[0].next=e.voices[1]=h(1);
			e.voices[1].next=e.voices[2]=h(2);
			e.voices[2].next=e.voices[3]=h(3);
			return Object.seal(e)
			
		}
		var i=1,m=2,k=3,j=4,l=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,0]
	})();
	
	(function(){
		function i(f){
			return Object.create(null,{index:{value:f,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},period:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0},volume:{value:0,writable:!0},portaDir:{value:0,writable:!0},portaPeriod:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.vibratoSpeed=this.vibratoPos=this.portaSpeed=this.portaPeriod=this.portaDir=this.volume=this.param=this.effect=this.period=this.enabled=0}}})
		}
		
		window.neoart.createMKPlayer=function(f){
			f=createAmigaPlayer(f);
			Object.defineProperties(f,{id:{value:"MKPlayer"},track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},restart:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},restartSave:{value:0,writable:!0},force:{set:function(b){b<j?b=j:b>h&&(b=h);this.version=b;this.vibratoDepth=b==h?6:7;b==k?(this.restartSave=this.restart,this.restart=0):(this.restart=this.restartSave,this.restartSave=0)}},initialize:{value:function(){var b=this.voices[0];this.core_initialize();this.force=this.version;this.timer=6;for(this.jumpFlag=this.patternPos=this.trackPos=0;b;)b.initialize(),b.channel=this.mixer.channels[b.index],b.sample=this.samples[0],b=b.next}},loader:{value:function(b){var f=0,e,c,d=0,g;if(!(2150>b.length)&&(b.position=1080,e=b.readString(4),!("M.K."!=e&&"FLT4"!=e))){b.position=0;this.title=b.readString(20);this.version=j;b.position+=22;for(e=1;32>e;++e)if(g=b.readUnsignedShort()){if(c=this.mixer.createSample(),b.position-=24,c.name=b.readString(22),c.length=g<<1,b.position+=3,c.volume=b.readUnsignedByte(),c.loop=b.readUnsignedShort()<<1,c.repeat=b.readUnsignedShort()<<1,b.position+=22,c.pointer=d,d+=c.length,this.samples[e]=c,32768<c.length)this.version=m}else this.samples[e]=null,b.position+=28;b.position=950;this.length=b.readUnsignedByte();g=b.readUnsignedByte();this.restart=g<length?g:0;for(e=0;128>e;++e)g=b.readUnsignedByte()<<8,this.track[e]=g,g>f&&(f=g);b.position=1084;f+=256;this.patterns=[];this.patterns.length=f;for(e=0;e<f;++e){c=this.mixer.createRow();g=b.readUnsignedInt();c.note=g>>16&4095;c.effect=g>>8&15;c.sample=g>>24&240|g>>12&15;c.param=g&255;this.patterns[e]=c;if(31<c.sample||!this.samples[c.sample])c.sample=0;if(3==c.effect||4==c.effect)this.version=k;if(5==c.effect||6==c.effect)this.version=h;if(6<c.effect&&10>c.effect){this.version=0;return}}this.mixer.store(b,d);for(e=1;32>e;++e)if(c=this.samples[e]){if(-1<c.name.indexOf("2.0"))this.version=h;c.loop?(c.loopPtr=c.pointer+c.loop,c.length=c.loop+c.repeat):(c.loopPtr=this.mixer.memory.length,c.repeat=2);d=c.pointer+4;for(b=c.pointer;b<d;++b)this.mixer.memory[b]=0}c=this.mixer.createSample();c.pointer=c.loopPtr=this.mixer.memory.length;c.length=c.repeat=2;this.samples[0]=c;if(this.version<h&&this.restart)this.version=n}}},process:{value:function(){var b,f,e,c,d,g,a=this.voices[0];if(this.tick)for(;a;){b=a.channel;if(0==a.effect&&0==a.param)b.period=a.period;else{switch(a.effect){case 0:d=this.tick%3;if(!d){b.period=a.period;a=a.next;continue}d=1==d?a.param>>4:a.param&15;c=a.period&4095;e=37-d;for(f=0;f<e;++f)if(c>=l[f]){b.period=l[f+d];break}break;case 1:a.period-=a.param;if(113>a.period)a.period=113;b.period=a.period;break;case 2:a.period+=a.param;if(856<a.period)a.period=856;b.period=a.period;break;case 3:case 5:if(5==a.effect)g=1;else if(a.param)a.portaSpeed=a.param,a.param=0;if(a.portaPeriod)if(a.portaDir){if(a.period-=a.portaSpeed,a.period<=a.portaPeriod)a.period=a.portaPeriod,a.portaPeriod=0}else if(a.period+=a.portaSpeed,a.period>=a.portaPeriod)a.period=a.portaPeriod,a.portaPeriod=0;b.period=a.period;break;case 4:case 6:if(6==a.effect)g=1;else if(a.param)a.vibratoSpeed=a.param;d=a.vibratoPos>>2&31;d=(a.vibratoSpeed&15)*o[d]>>this.vibratoDepth;b.period=127<a.vibratoPos?a.period-d:a.period+d;d=a.vibratoSpeed>>2&60;a.vibratoPos=a.vibratoPos+d&255;break;case 10:g=1}if(g){d=a.param>>4;g=0;a.volume=d?a.volume+d:a.volume-(a.param&15);if(0>a.volume)a.volume=0;else if(64<a.volume)a.volume=64;b.volume=a.volume}}a=a.next}else for(f=this.track[this.trackPos]+this.patternPos;a;){b=a.channel;a.enabled=0;d=this.patterns[f+a.index];a.effect=d.effect;a.param=d.param;d.sample?(e=a.sample=this.samples[d.sample],b.volume=a.volume=e.volume):e=a.sample;if(d.note)3==a.effect||5==a.effect?d.note<a.period?(a.portaDir=1,a.portaPeriod=d.note):d.note>a.period?(a.portaDir=0,a.portaPeriod=d.note):a.portaPeriod=0:(a.enabled=1,a.vibratoPos=0,b.enabled=0,b.pointer=e.pointer,b.length=e.length,b.period=a.period=d.note);switch(a.effect){case 11:this.trackPos=a.param-1;this.jumpFlag^=1;break;case 12:b.volume=a.param;if(this.version==h)a.volume=a.param;break;case 13:this.jumpFlag^=1;break;case 14:this.mixer.filter.active=a.param^1;break;case 15:d=a.param,1>d?d=1:31<d&&(d=31),this.timer=d,this.tick=0}if(a.enabled)b.enabled=1;b.pointer=e.loopPtr;b.length=e.repeat;a=a.next}if(++this.tick==this.timer&&(this.tick=0,this.patternPos+=4,256==this.patternPos||this.jumpFlag))if(this.patternPos=this.jumpFlag=0,this.trackPos=++this.trackPos&127,this.trackPos==this.length)this.trackPos=this.restart,this.mixer.complete=1}}});
			f.track=new Uint32Array(128);
			f.voices[0]=i(0);
			f.voices[0].next=f.voices[1]=i(1);
			f.voices[1].next=f.voices[2]=i(2);
			f.voices[2].next=f.voices[3]=i(3);
			return Object.seal(f)
			
		}
		var j=1,m=2,k=3,n=4,h=5,l=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,0],o=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24]
	})();
	
	(function(){
		function j(f){
			return Object.create(null,{index:{value:f,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},period:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0},volume1:{value:0,writable:!0},volume2:{value:0,writable:!0},handler:{value:0,writable:!0},portaDir:{value:0,writable:!0},portaPeriod:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},wavePos:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.wavePos=this.vibratoSpeed=this.vibratoPos=this.portaSpeed=this.portaPeriod=this.portaDir=this.handler=this.volume2=this.volume1=this.param=this.effect=this.period=this.enabled=0}}})
		}
		
		window.neoart.createHMPlayer=function(f){
			f=createAmigaPlayer(f);
			Object.defineProperties(f,{id:{value:"HMPlayer"},track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},restart:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},initialize:{value:function(){var a=this.voices[0];this.core_initialize();this.timer=6;this.jumpFlag=this.patternPos=this.trackPos=0;for(this.mixer.samplesTick=884;a;)a.initialize(),a.channel=this.mixer.channels[a.index],a.sample=this.samples[0],a=a.next}},loader:{value:function(a){var i=0,d,g,e,c=0,b,f=0,h;if(!(2150>a.length)&&(a.position=1080,g=a.readString(4),"FEST"==g)){a.position=950;this.length=a.readUnsignedByte();this.restart=a.readUnsignedByte();for(d=0;128>d;++d)this.track[d]=a.readUnsignedByte();a.position=0;this.title=a.readString(20);for(d=this.version=1;32>d;++d){this.samples[d]=null;g=a.readString(4);if("Mupp"==g){h=a.readUnsignedByte();for(e=0;128>e;++e)this.track[e]>=h&&this.track[e]--;b=this.createSample();b.name=g;b.length=b.repeat=32;b.restart=a.readUnsignedByte();b.waveLen=a.readUnsignedByte();a.position+=17;b.finetune=a.readByte();b.volume=a.readUnsignedByte();g=a.position+4;h=1084+(h<<10);a.position=h;b.pointer=this.mixer.memory.length;b.waves=new Uint32Array(64);b.volumes=new Uint32Array(64);this.mixer.store(a,896);for(e=0;64>e;++e)b.waves[e]=a.readUnsignedByte()<<5;for(e=0;64>e;++e)b.volumes[e]=a.readUnsignedByte()&127;a.position=h;a.writeInt(1718382436);a.position=g;c+=896}else{g=g.substr(0,2);"El"==g?a.position+=18:(a.position-=4,g=a.readString(22));h=a.readUnsignedShort();if(0==h){a.position+=6;continue}b=this.createSample();b.name=g;b.pointer=f;b.length=h<<1;b.finetune=a.readByte();b.volume=a.readUnsignedByte();b.loop=a.readUnsignedShort()<<1;b.repeat=a.readUnsignedShort()<<1;f+=b.length}this.samples[d]=b}for(d=0;128>d;++d)h=this.track[d]<<8,this.track[d]=h,h>i&&(i=h);a.position=1084;i+=256;this.patterns=[];this.patterns.length=i;for(d=0;d<i;++d){for(h=a.readUnsignedInt();1718382436==h;)a.position+=1020,h=a.readUnsignedInt();e=this.mixer.createRow();e.note=h>>16&4095;e.sample=h>>24&240|h>>12&15;e.effect=h>>8&15;e.param=h&255;this.patterns[d]=e}this.mixer.store(a,f);for(d=1;32>d;++d)if(b=this.samples[d],!(null==b||"Mupp"==b.name)){b.pointer+=c;b.loop?(b.loopPtr=b.pointer+b.loop,b.length=b.loop+b.repeat):(b.loopPtr=this.mixer.memory.length,b.repeat=2);f=b.pointer+4;for(e=b.pointer;e<f;++e)this.mixer.memory[e]=0}b=this.createSample();b.pointer=b.loopPtr=this.mixer.memory.length;b.length=b.repeat=2;this.samples[0]=b}}},process:{value:function(){var a,f,d,g,e,c=this.voices[0];if(this.tick)for(;c;)this.effects(c),this.handler(c),g=c.sample,c.channel.pointer=g.loopPtr,c.channel.length=g.repeat,c=c.next;else for(f=this.track[this.trackPos]+this.patternPos;c;){a=c.channel;c.enabled=0;d=this.patterns[f+c.index];c.effect=d.effect;c.param=d.param;d.sample?(g=c.sample=this.samples[d.sample],c.volume2=g.volume,"Mupp"==g.name?(g.loopPtr=g.pointer+g.waves[0],c.handler=1,c.volume1=g.volumes[0]):(c.handler=0,c.volume1=64)):g=c.sample;if(d.note){3==c.effect||5==c.effect?d.note<c.period?(c.portaDir=1,c.portaPeriod=d.note):d.note>c.period?(c.portaDir=0,c.portaPeriod=d.note):c.portaPeriod=0:(c.period=d.note,c.vibratoPos=0,c.wavePos=0,c.enabled=1,a.enabled=0,e=c.period*g.finetune>>8,a.period=c.period+e,c.handler?(a.pointer=g.loopPtr,a.length=g.repeat):(a.pointer=g.pointer,a.length=g.length));switch(c.effect){case 11:this.trackPos=c.param-1;this.jumpFlag=1;break;case 12:c.volume2=c.param;if(64<c.volume2)c.volume2=64;break;case 13:this.jumpFlag=1;break;case 14:this.mixer.filter.active=c.param^1;break;case 15:e=c.param,1>e?e=1:31<e&&(e=31),this.timer=e,this.tick=0}0==d.note&&this.effects(c);this.handler(c);if(c.enabled)a.enabled=1;a.pointer=g.loopPtr;a.length=g.repeat}c=c.next}if(++this.tick==this.timer&&(this.tick=0,this.patternPos+=4,256==this.patternPos||this.jumpFlag))if(this.patternPos=this.jumpFlag=0,this.trackPos=++this.trackPos&127,this.trackPos==this.length)this.trackPos=this.restart,this.mixer.complete=1}},effects:{value:function(a){var f=a.channel,d,g,e=a.period&4095,c,b;if(a.effect||a.param)switch(a.effect){case 0:b=l[this.tick];if(0==b)break;b=1==b?a.param>>4:a.param&15;g=37-b;for(d=0;d<g;++d)if(e>=k[d]){e=k[d+b];break}break;case 1:a.period-=a.param;if(113>a.period)a.period=113;e=a.period;break;case 2:a.period+=a.param;if(856<a.period)a.period=856;e=a.period;break;case 3:case 5:if(5==a.effect)c=1;else if(a.param)a.portaSpeed=a.param,a.param=0;if(a.portaPeriod)if(a.portaDir){if(a.period-=a.portaSpeed,a.period<a.portaPeriod)a.period=a.portaPeriod,a.portaPeriod=0}else if(a.period+=a.portaSpeed,a.period>a.portaPeriod)a.period=a.portaPeriod,a.portaPeriod=0;e=a.period;break;case 4:case 6:if(6==a.effect)c=1;else if(a.param)a.vibratoSpeed=a.param;b=m[a.vibratoPos>>2&31];b=(a.vibratoSpeed&15)*b>>7;e=127<a.vibratoPos?e-b:e+b;b=a.vibratoSpeed>>2&60;a.vibratoPos=a.vibratoPos+b&255;break;case 7:b=n[(a.vibratoPos&15)+((a.param&15)<<4)];a.vibratoPos++;for(d=0;37>d&&!(e>=k[d]);++d);b+=d;35<b&&(b-=12);e=k[b];break;case 10:c=1}f.period=e+(e*a.sample.finetune>>8);if(c)if(b=a.param>>4,a.volume2=b?a.volume2+b:a.volume2-(a.param&15),64<a.volume2)a.volume2=64;else if(0>a.volume2)a.volume2=0}},handler:{value:function(a){var f;if(a.handler&&(f=a.sample,f.loopPtr=f.pointer+f.waves[a.wavePos],a.volume1=f.volumes[a.wavePos],++a.wavePos>f.waveLen))a.wavePos=f.restart;a.channel.volume=a.volume1*a.volume2>>6}},createSample:{value:function(){var a=this.mixer.createSample();Object.defineProperties(a,{finetune:{value:0,writable:!0},restart:{value:0,writable:!0},waveLen:{value:0,writable:!0},waves:{value:null,writable:!0},volumes:{value:null,writable:!0}});return a}}});
			f.track=new Uint32Array(128);
			f.voices[0]=j(0);
			f.voices[0].next=f.voices[1]=j(1);
			f.voices[1].next=f.voices[2]=j(2);
			f.voices[2].next=f.voices[3]=j(3);
			return Object.seal(f)
			
		}
		var l=[0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1],n=[0,3,7,12,15,12,7,3,0,3,7,12,15,12,7,3,0,4,7,12,16,12,7,4,0,4,7,12,16,12,7,4,0,3,8,12,15,12,8,3,0,3,8,12,15,12,8,3,0,4,8,12,16,12,8,4,0,4,8,12,16,12,8,4,0,5,8,12,17,12,8,5,0,5,8,12,17,12,8,5,0,5,9,12,17,12,9,5,0,5,9,12,17,12,9,5,12,0,7,0,3,0,7,0,12,0,7,0,3,0,7,0,12,0,7,0,4,0,7,0,12,0,7,0,4,0,7,0,0,3,7,3,7,12,7,12,15,12,7,12,7,3,7,3,0,4,7,4,7,12,7,12,16,12,7,12,7,4,7,4,31,27,24,19,15,12,7,3,0,3,7,12,15,19,24,27,31,28,24,19,16,12,7,4,0,4,7,12,16,19,24,28,0,12,0,12,0,12,0,12,0,12,0,12,0,12,0,12,0,12,24,12,0,12,24,12,0,12,24,12,0,12,24,12,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0,4,0,4,0,4,0,4,0,4,0,4,0,4,0,4],k=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,0],m=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24]
	})();
	
	(function(){
		function i(g){
			return Object.create(null,{index:{value:g,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},loopCtr:{value:0,writable:!0},loopPos:{value:0,writable:!0},step:{value:0,writable:!0},period:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0},volume:{value:0,writable:!0},pointer:{value:0,writable:!0},length:{value:0,writable:!0},loopPtr:{value:0,writable:!0},repeat:{value:0,writable:!0},finetune:{value:0,writable:!0},offset:{value:0,writable:!0},portaDir:{value:0,writable:!0},portaPeriod:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},glissando:{value:0,writable:!0},tremoloParam:{value:0,writable:!0},tremoloPos:{value:0,writable:!0},tremoloWave:{value:0,writable:!0},vibratoParam:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoWave:{value:0,writable:!0},funkPos:{value:0,writable:!0},funkSpeed:{value:0,writable:!0},funkWave:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.funkWave=this.funkSpeed=this.funkPos=this.vibratoWave=this.vibratoPos=this.vibratoParam=this.tremoloWave=this.tremoloPos=this.tremoloParam=this.glissando=this.portaSpeed=this.portaPeriod=this.portaDir=this.offset=this.finetune=this.repeat=this.loopPtr=this.length=this.pointer=this.volume=this.param=this.effect=this.period=this.step=this.loopPos=this.loopCtr=this.enabled=0}}})
		}
		
		window.neoart.createPTPlayer=function(g){
			g=createAmigaPlayer(g);
			Object.defineProperties(g,{id:{value:"PTPlayer"},track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},patternBreak:{value:0,writable:!0},patternDelay:{value:0,writable:!0},breakPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},force:{set:function(a){a<j?a=j:a>k&&(a=k);this.version=a;this.vibratoDepth=a<l?6:7}},initialize:{value:function(){var a=this.voices[0];this.core_initialize();this.force=this.version;this.tempo=125;this.timer=6;this.jumpFlag=this.breakPos=this.patternDelay=this.patternBreak=this.patternPos=this.trackPos=0;for(this.mixer.samplesTick=2.5*this.sampleRate/this.tempo>>0;a;)a.initialize(),a.channel=this.mixer.channels[a.index],a.sample=this.samples[0],a=a.next}},loader:{value:function(a){var c=0,e,d,f=0,b;if(!(2150>a.length)&&(a.position=1080,e=a.readString(4),!("M.K."!=e&&"M!K!"!=e))){a.position=0;this.title=a.readString(20);this.version=j;a.position+=22;for(e=1;32>e;++e)(b=a.readUnsignedShort())?(d=this.createSample(),a.position-=24,d.name=a.readString(22),d.length=d.realLen=b<<1,a.position+=2,d.finetune=37*a.readUnsignedByte(),d.volume=a.readUnsignedByte(),d.loop=a.readUnsignedShort()<<1,d.repeat=a.readUnsignedShort()<<1,a.position+=22,d.pointer=f,f+=d.length,this.samples[e]=d):(this.samples[e]=null,a.position+=28);a.position=950;this.length=a.readUnsignedByte();a.position++;for(e=0;128>e;++e)b=a.readUnsignedByte()<<8,this.track[e]=b,b>c&&(c=b);a.position=1084;c+=256;this.patterns=[];this.patterns.length=c;for(e=0;e<c;++e){d=this.createRow();d.step=b=a.readUnsignedInt();d.note=b>>16&4095;d.effect=b>>8&15;d.sample=b>>24&240|b>>12&15;d.param=b&255;this.patterns[e]=d;if(31<d.sample||!this.samples[d.sample])d.sample=0;if(15==d.effect&&31<d.param)this.version=l;if(8==d.effect)this.version=k}this.mixer.store(a,f);for(e=1;32>e;++e)if(d=this.samples[e]){d.loop||4<d.repeat?(d.loopPtr=d.pointer+d.loop,d.length=d.loop+d.repeat):(d.loopPtr=this.mixer.memory.length,d.repeat=2);f=d.pointer+2;for(a=d.pointer;a<f;++a)this.mixer.memory[a]=0}d=this.createSample();d.pointer=d.loopPtr=this.mixer.memory.length;d.length=d.repeat=2;this.samples[0]=d}}},process:{value:function(){var a,c,e,d,f,b=this.voices[0];if(this.tick)this.effects();else if(this.patternDelay)this.effects();else{for(e=this.track[this.trackPos]+this.patternPos;b;){a=b.channel;b.enabled=0;if(0==b.step)a.period=b.period;d=this.patterns[e+b.index];b.step=d.step;b.effect=d.effect;b.param=d.param;if(d.sample)c=b.sample=this.samples[d.sample],b.pointer=c.pointer,b.length=c.length,b.loopPtr=b.funkWave=c.loopPtr,b.repeat=c.repeat,b.finetune=c.finetune,a.volume=b.volume=c.volume;if(d.note){if(3664==(b.step&4080))b.finetune=37*(b.param&15);else if(3==b.effect||5==b.effect)if(d.note==b.period)b.portaPeriod=0;else{c=b.finetune;for(f=c+37;c<f&&!(d.note>=h[c]);++c);c==f&&f--;0<c&&(f=b.finetune/37>>0&8)&&c--;b.portaPeriod=h[c];b.portaDir=d.note>b.portaPeriod?0:1}else 9==b.effect&&this.moreEffects(b);for(c=0;37>c&&!(d.note>=h[c]);++c);b.period=h[b.finetune+c];if(3792==(b.step&4080))b.funkSpeed&&this.updateFunk(b),this.extended(b);else{if(4>b.vibratoWave)b.vibratoPos=0;if(4>b.tremoloWave)b.tremoloPos=0;a.enabled=0;a.pointer=b.pointer;a.length=b.length;a.period=b.period;b.enabled=1;this.moreEffects(b)}}else this.moreEffects(b);b=b.next}for(b=this.voices[0];b;){a=b.channel;if(b.enabled)a.enabled=1;a.pointer=b.loopPtr;a.length=b.repeat;b=b.next}}if(++this.tick==this.timer){this.tick=0;this.patternPos+=4;this.patternDelay&&--this.patternDelay&&(this.patternPos-=4);if(this.patternBreak)this.patternBreak=0,this.patternPos=this.breakPos,this.breakPos=0;if(256==this.patternPos||this.jumpFlag)if(this.patternPos=this.breakPos,this.jumpFlag=this.breakPos=0,++this.trackPos==this.length)this.trackPos=0,this.mixer.complete=1}}},effects:{value:function(){for(var a,c,e,d,f,b=this.voices[0];b;){a=b.channel;b.funkSpeed&&this.updateFunk(b);if(0==(b.step&4095))a.period=b.period;else{switch(b.effect){case 0:f=this.tick%3;if(!f){a.period=b.period;b=b.next;continue}f=1==f?b.param>>4:b.param&15;c=b.finetune;for(e=c+37;c<e;++c)if(b.period>=h[c]){a.period=h[c+f];break}break;case 1:b.period-=b.param;if(113>b.period)b.period=113;a.period=b.period;break;case 2:b.period+=b.param;if(856<b.period)b.period=856;a.period=b.period;break;case 3:case 5:5==b.effect?d=1:(b.portaSpeed=b.param,b.param=0);if(b.portaPeriod){if(b.portaDir){if(b.period-=b.portaSpeed,b.period<=b.portaPeriod)b.period=b.portaPeriod,b.portaPeriod=0}else if(b.period+=b.portaSpeed,b.period>=b.portaPeriod)b.period=b.portaPeriod,b.portaPeriod=0;if(b.glissando){c=b.finetune;for(f=c+37;c<f&&!(b.period>=h[c]);++c);c==f&&c--;a.period=h[c]}else a.period=b.period}break;case 4:case 6:if(6==b.effect)d=1;else if(b.param){if(f=b.param&15)b.vibratoParam=b.vibratoParam&240|f;if(f=b.param&240)b.vibratoParam=b.vibratoParam&15|f}e=b.vibratoPos>>2&31;(c=b.vibratoWave&3)?(f=255,e<<=3,1==c&&(f=127<b.vibratoPos?f-e:e)):f=m[e];f=(b.vibratoParam&15)*f>>this.vibratoDepth;a.period=127<b.vibratoPos?b.period-f:b.period+f;f=b.vibratoParam>>2&60;b.vibratoPos=b.vibratoPos+f&255;break;case 7:a.period=b.period;if(b.param){if(f=b.param&15)b.tremoloParam=b.tremoloParam&240|f;if(f=b.param&240)b.tremoloParam=b.tremoloParam&15|f}e=b.tremoloPos>>2&31;(c=b.tremoloWave&3)?(f=255,e<<=3,1==c&&(f=127<b.tremoloPos?f-e:e)):f=m[e];f=(b.tremoloParam&15)*f>>6;a.volume=127<b.tremoloPos?b.volume-f:b.volume+f;f=b.tremoloParam>>2&60;b.tremoloPos=b.tremoloPos+f&255;break;case 10:d=1;break;case 14:this.extended(b)}if(d){d=0;f=b.param>>4;b.volume=f?b.volume+f:b.volume-(b.param&15);if(0>b.volume)b.volume=0;else if(64<b.volume)b.volume=64;a.volume=b.volume}}b=b.next}}},moreEffects:{value:function(a){var c=a.channel;a.funkSpeed&&this.updateFunk(a);switch(a.effect){case 9:if(a.param)a.offset=a.param;c=a.offset<<8;c>=a.length?a.length=2:(a.pointer+=c,a.length-=c);break;case 11:this.trackPos=a.param-1;this.breakPos=0;this.jumpFlag=1;break;case 12:a.volume=a.param;if(64<a.volume)a.volume=64;c.volume=a.volume;break;case 13:this.breakPos=10*(a.param>>4)+(a.param&15);this.breakPos=63<this.breakPos?0:this.breakPos<<2;this.jumpFlag=1;break;case 14:this.extended(a);break;case 15:if(!a.param)break;32>a.param?this.timer=a.param:this.mixer.samplesTick=2.5*this.sampleRate/a.param>>0;this.tick=0}}},extended:{value:function(a){var c=a.channel,e;e=a.param&15;switch(a.param>>4){case 0:this.mixer.filter.active=e;break;case 1:if(this.tick)break;a.period-=e;if(113>a.period)a.period=113;c.period=a.period;break;case 2:if(this.tick)break;a.period+=e;if(856<a.period)a.period=856;c.period=a.period;break;case 3:a.glissando=e;break;case 4:a.vibratoWave=e;break;case 5:a.finetune=37*e;break;case 6:if(this.tick)break;if(e){if(a.loopCtr?a.loopCtr--:a.loopCtr=e,a.loopCtr)this.breakPos=a.loopPos<<2,this.patternBreak=1}else a.loopPos=this.patternPos>>2;break;case 7:a.tremoloWave=e;break;case 8:c=a.length-2;e=this.mixer.memory;for(a=a.loopPtr;a<c;)e[a]=0.5*(e[a]+e[++a]);e[++a]=0.5*(e[a]+e[0]);break;case 9:if(this.tick||!e||0==a.period)break;if(this.tick%e)break;c.enabled=0;c.pointer=a.pointer;c.length=a.length;c.delay=30;c.enabled=1;c.pointer=a.loopPtr;c.length=a.repeat;c.period=a.period;break;case 10:if(this.tick)break;a.volume+=e;if(64<a.volume)a.volume=64;c.volume=a.volume;break;case 11:if(this.tick)break;a.volume-=e;if(0>a.volume)a.volume=0;c.volume=a.volume;break;case 12:if(this.tick==e)c.volume=a.volume=0;break;case 13:if(this.tick!=e||0==a.period)break;c.enabled=0;c.pointer=a.pointer;c.length=a.length;c.delay=30;c.enabled=1;c.pointer=a.loopPtr;c.length=a.repeat;c.period=a.period;break;case 14:if(this.tick||this.patternDelay)break;this.patternDelay=++e;break;case 15:if(this.tick)break;(a.funkSpeed=e)&&this.updateFunk(a)}}},updateFunk:{value:function(a){var c=a.channel,e,d;a.funkPos+=n[a.funkSpeed];if(!(128>a.funkPos))if(a.funkPos=0,this.version==j){e=a.pointer+a.sample.realLen-a.repeat;d=a.funkWave+a.repeat;if(d>e)d=a.loopPtr,c.length=a.repeat;c.pointer=a.funkWave=d}else{e=a.loopPtr+a.repeat;d=a.funkWave+1;if(d>=e)d=a.loopPtr;this.mixer.memory[d]=-this.mixer.memory[d]}}},createRow:{value:function(){var a=this.mixer.createRow();Object.defineProperties(a,{step:{value:0,writable:!0}});return a}},createSample:{value:function(){var a=this.mixer.createSample();Object.defineProperties(a,{finetune:{value:0,writable:!0},realLen:{value:0,writable:!0}});return a}}});
			g.track=new Uint32Array(128);
			g.voices[0]=i(0);
			g.voices[0].next=g.voices[1]=i(1);
			g.voices[1].next=g.voices[2]=i(2);
			g.voices[2].next=g.voices[3]=i(3);
			return Object.seal(g)
		}
		var j=1,l=2,k=3,h=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,0,850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113,0,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112,0,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111,0,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110,0,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109,0,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109,0,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108,0,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,0,900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119,0,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118,0,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,0,881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117,0,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,0,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,0,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114,0],m=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24],n=[0,5,6,7,8,10,11,13,16,19,22,26,32,43,64,128]
	})();
	
	(function(){
		function j(g){
			return Object.create(null,{index:{value:g,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},period:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0},volume:{value:0,writable:!0},last:{value:0,writable:!0},slideCtr:{value:0,writable:!0},slideDir:{value:0,writable:!0},slideParam:{value:0,writable:!0},slidePeriod:{value:0,writable:!0},slideSpeed:{value:0,writable:!0},stepPeriod:{value:0,writable:!0},stepSpeed:{value:0,writable:!0},stepWanted:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.stepWanted=this.stepSpeed=this.stepPeriod=this.slideSpeed=this.slidePeriod=this.slideParam=this.slideDir=this.slideCtr=this.last=this.volume=this.param=this.effect=this.period=this.enabled=0}}})
		}
		window.neoart.createFXPlayer=function(g){
			g=createAmigaPlayer(g);
			Object.defineProperties(g,{id:{value:"FXPlayer"},track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},force:{set:function(b){b<m?b=m:b>k&&(b=k);this.version=b}},ntsc:{set:function(b){this.mode(b);b=(b?20.44952532:20.637767904)*(this.sampleRate/1E3)/120;this.mixer.samplesTick=this.tempo/122*b>>0}},initialize:{value:function(){var b=this.voices[0];this.core_initialize();this.ntsc=this.standard;this.timer=6;for(this.jumpFlag=this.patternPos=this.trackPos=0;b;)b.initialize(),b.channel=this.mixer.channels[b.index],b.sample=this.samples[0],b=b.next}},loader:{value:function(b){var c=0,e,d,a,f,g=0,h;if(!(1686>b.length)){b.position=60;e=b.readString(4);if("SONG"!=e){b.position=124;e=b.readString(4);if("SO31"!=e)return;if(2350>b.length)return;d=32;a=544;this.version=k}else d=16,a=0,this.version=m;this.tempo=b.readUnsignedShort();b.position=0;for(e=1;e<d;++e)(h=b.readUnsignedInt())?(f=this.mixer.createSample(),f.pointer=g,g+=h,this.samples[e]=f):this.samples[e]=null;b.position+=20;for(e=1;e<d;++e)(f=this.samples[e])?(f.name=b.readString(22),f.length=b.readUnsignedShort()<<1,f.volume=b.readUnsignedShort(),f.loop=b.readUnsignedShort(),f.repeat=b.readUnsignedShort()<<1):b.position+=30;b.position=530+a;this.length=d=b.readUnsignedByte();b.position++;for(e=0;e<d;++e)h=b.readUnsignedByte()<<8,this.track[e]=h,h>c&&(c=h);a&&(a+=4);b.position=660+a;c+=256;this.patterns=[];this.patterns.length=c;d=this.samples.length;for(e=0;e<c;++e){a=this.mixer.createRow();a.note=b.readShort();h=b.readUnsignedByte();a.param=b.readUnsignedByte();a.effect=h&15;a.sample=h>>4;this.patterns[e]=a;if(this.version==k)a.note&4096&&(a.sample+=16,0<a.note&&(a.note&=61439));else{if(9==a.effect||856<a.note)this.version=i;if(-3>a.note)this.version=n}if(a.sample>=d||null==this.samples[a.sample])a.sample=0}this.mixer.store(b,g);for(e=1;e<d;++e)if(f=this.samples[e]){f.loop?f.loopPtr=f.pointer+f.loop:(f.loopPtr=this.mixer.memory.length,f.repeat=2);g=f.pointer+4;for(b=f.pointer;b<g;++b)this.mixer.memory[b]=0}f=this.mixer.createSample();f.pointer=f.loopPtr=this.mixer.memory.length;f.length=f.repeat=2;this.samples[0]=f}}},process:{value:function(){var f;var b,c,e,d,a=this.voices[0];if(this.tick)for(;a;){b=a.channel;if(!(this.version==i&&-3==a.period))if(a.stepSpeed){a.stepPeriod+=a.stepSpeed;if(0>a.stepSpeed){if(a.stepPeriod<a.stepWanted&&(a.stepPeriod=a.stepWanted,this.version>i))a.stepSpeed=0}else if(a.stepPeriod>a.stepWanted&&(a.stepPeriod=a.stepWanted,this.version>i))a.stepSpeed=0;if(this.version>i)a.last=a.stepPeriod;b.period=a.stepPeriod}else{if(a.slideSpeed&&(d=a.slideParam&15))if(++a.slideCtr==d)if(a.slideCtr=0,d=a.slideParam>>4<<3,0==a.slideDir){if(a.slidePeriod+=8,b.period=a.slidePeriod,d+=a.slideSpeed,d==a.slidePeriod)a.slideDir=1}else{if(a.slidePeriod-=8,b.period=a.slidePeriod,d-=a.slideSpeed,d==a.slidePeriod)a.slideDir=0}else{a=a.next;continue}d=0;switch(a.effect){case 1:d=o[this.tick-1];c=0;if(2==d){b.period=a.last;a=a.next;continue}for(d=1==d?a.param&15:a.param>>4;a.last!=l[c];)c++;b.period=l[c+d];break;case 2:d=a.param>>4;a.period=d?a.period+d:a.period-(a.param&15);b.period=a.period;break;case 3:this.mixer.filter.active=1;break;case 4:this.mixer.filter.active=0;break;case 8:d=-1;case 7:a.stepSpeed=a.param&15;e=this.version>i?a.last:a.period;if(0>d)a.stepSpeed=-a.stepSpeed;for(c=0;;){b=l[c];if(b==e)break;if(0>b){c=-1;break}else c++}-1<c?(b=a.param>>4,-1<d&&(b=-b),c+=b,0>c&&(c=0),a.stepWanted=l[c]):a.stepWanted=a.period;break;case 9:a.slideSpeed=a.slidePeriod=a.period,a.slideParam=a.param,a.slideDir=0,a.slideCtr=0}}a=a.next}else for(d=this.track[this.trackPos]+this.patternPos;a;){b=a.channel;a.enabled=0;c=this.patterns[d+a.index];a.period=c.note;a.effect=c.effect;a.param=c.param;if(-3==c.note)a.effect=0;else if(c.sample?(f=a.sample=this.samples[c.sample],c=f,a.volume=c.volume,5==a.effect?a.volume+=a.param:6==a.effect&&(a.volume-=a.param),b.volume=a.volume):c=a.sample,a.period){a.last=a.period;a.slideSpeed=0;a.stepSpeed=0;a.enabled=1;b.enabled=0;switch(a.period){case -2:b.volume=0;break;case -4:this.jumpFlag=1;break;case -5:console.log("Unknown command -5");break;default:b.pointer=c.pointer,b.length=c.length,b.period=a.period}if(a.enabled)b.enabled=1;b.pointer=c.loopPtr;b.length=c.repeat}a=a.next}if(++this.tick==this.timer&&(this.tick=0,this.patternPos+=4,256==this.patternPos||this.jumpFlag))if(this.patternPos=this.jumpFlag=0,++this.trackPos==this.length)this.trackPos=0,this.mixer.complete=1}}});
			g.track=new Uint32Array(128);
			g.voices[0]=j(0);
			g.voices[0].next=g.voices[1]=j(1);
			g.voices[1].next=g.voices[2]=j(2);
			g.voices[2].next=g.voices[3]=j(3);
			return Object.seal(g)
			
		}
		var m=1,i=2,n=3,k=4,o=[0,1,2,1,0],l=[1076,1016,960,906,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,-1]
	})();
	
	(function(){
		function j(h){
			return Object.create(null,{index:{value:h,writable:!0},next:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},pattern:{value:0,writable:!0},soundTranspose:{value:0,writable:!0},transpose:{value:0,writable:!0},patStep:{value:0,writable:!0},frqStep:{value:0,writable:!0},frqPos:{value:0,writable:!0},frqSustain:{value:0,writable:!0},frqTranspose:{value:0,writable:!0},volStep:{value:0,writable:!0},volPos:{value:0,writable:!0},volCtr:{value:0,writable:!0},volSpeed:{value:0,writable:!0},volSustain:{value:0,writable:!0},note:{value:0,writable:!0},pitch:{value:0,writable:!0},volume:{value:0,writable:!0},pitchBendFlag:{value:0,writable:!0},pitchBendSpeed:{value:0,writable:!0},pitchBendTime:{value:0,writable:!0},portamentoFlag:{value:0,writable:!0},portamento:{value:0,writable:!0},volBendFlag:{value:0,writable:!0},volBendSpeed:{value:0,writable:!0},volBendTime:{value:0,writable:!0},vibratoFlag:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},vibratoDelay:{value:0,writable:!0},vibrato:{value:0,writable:!0},initialize:{value:function(){this.sample=null;this.volPos=this.volStep=this.frqTranspose=this.frqSustain=this.frqPos=this.frqStep=this.patStep=this.transpose=this.soundTranspose=this.pattern=this.enabled=0;this.volSpeed=this.volCtr=1;this.vibrato=this.vibratoDelay=this.vibratoDepth=this.vibratoSpeed=this.vibratoFlag=this.volBendTime=this.volBendSpeed=this.volBendFlag=this.portamento=this.portamentoFlag=this.pitchBendTime=this.pitchBendSpeed=this.pitchBendFlag=this.volume=this.pitch=this.note=this.volSustain=0}},volumeBend:{value:function(){if(this.volBendFlag^=1)if(this.volBendTime--,this.volume+=this.volBendSpeed,0>this.volume||64<this.volume)this.volBendTime=0}}})
		}
		window.neoart.createFCPlayer=function(h){
			h=createAmigaPlayer(h);
			Object.defineProperties(h,{id:{value:"FCPlayer"},seqs:{value:null,writable:!0},pats:{value:null,writable:!0},vols:{value:null,writable:!0},frqs:{value:null,writable:!0},length:{value:0,writable:!0},samples:{value:[],writable:!0},voices:{value:[],writable:!0},initialize:{value:function(){var b=this.voices[0];this.core_initialize();this.seqs.position=0;this.pats.position=0;this.vols.position=0;for(this.frqs.position=0;b;)b.initialize(),b.channel=this.mixer.channels[b.index],b.pattern=this.seqs.readUnsignedByte()<<6,b.transpose=this.seqs.readByte(),b.soundTranspose=this.seqs.readByte(),b=b.next;this.timer=this.seqs.readUnsignedByte();if(0==this.timer)this.timer=3;this.tick=this.timer}},loader:{value:function(b){var g,d,e,f,a,c,i,h,j;d=b.readString(4);if("SMOD"==d)this.version=k;else if("FC14"==d)this.version=m;else return;b.position=4;this.length=b.readUnsignedInt();b.position=this.version==k?100:180;this.seqs=createByteArray(new ArrayBuffer(this.length));b.readBytes(this.seqs.view,0,this.length);this.length=this.length/13>>0;b.position=12;e=b.readUnsignedInt();b.position=8;b.position=b.readUnsignedInt();this.pats=createByteArray(new ArrayBuffer(e+1));b.readBytes(this.pats.view,0,e);b.position=20;e=b.readUnsignedInt();b.position=16;b.position=b.readUnsignedInt();this.frqs=createByteArray(new ArrayBuffer(e+9));this.frqs.writeInt(16777216);this.frqs.writeInt(225);b.readBytes(this.frqs.view,8,e);this.frqs.position=this.frqs.length-1;this.frqs.writeByte(225);this.frqs.position=0;b.position=28;e=b.readUnsignedInt();b.position=24;b.position=b.readUnsignedInt();this.vols=createByteArray(new ArrayBuffer(e+8));this.vols.writeInt(16777216);this.vols.writeInt(225);b.readBytes(this.vols.view,8,e);b.position=32;i=b.readUnsignedInt();b.position=40;this.version==k?(this.samples.length=57,f=0):(this.samples.length=200,f=2);for(g=0;10>g;++g)if(e=b.readUnsignedShort()<<1,0<e)if(a=b.position,b.position=i,d=b.readString(4),"SSMP"==d){h=e;for(d=0;10>d;++d)if(b.readInt(),e=b.readUnsignedShort()<<1,0<e){c=this.mixer.createSample();c.length=e+2;c.loop=b.readUnsignedShort();c.repeat=b.readUnsignedShort()<<1;if(c.loop+c.repeat>c.length)c.repeat=c.length-c.loop;if(i+c.length>b.length)c.length=b.length-i;c.pointer=this.mixer.store(b,c.length,i+j);c.loopPtr=c.pointer+c.loop;this.samples[100+10*g+d]=c;j+=c.length;b.position+=6}else b.position+=10;i+=h+2;b.position=a+4}else{b.position=a;c=this.mixer.createSample();c.length=e+f;c.loop=b.readUnsignedShort();c.repeat=b.readUnsignedShort()<<1;if(c.loop+c.repeat>c.length)c.repeat=c.length-c.loop;if(i+c.length>b.length)c.length=b.length-i;c.pointer=this.mixer.store(b,c.length,i);c.loopPtr=c.pointer+c.loop;this.samples[g]=c;i+=c.length}else b.position+=4;if(this.version==k){f=0;h=47;for(g=10;57>g;++g){c=this.mixer.createSample();c.length=l[f++]<<1;c.loop=0;c.repeat=c.length;a=this.mixer.memory.length;c.pointer=a;c.loopPtr=a;this.samples[g]=c;e=a+c.length;for(d=a;d<e;++d)this.mixer.memory[d]=l[h++]}}else{b.position=36;i=b.readUnsignedInt();b.position=100;for(g=10;90>g;++g)if(e=b.readUnsignedByte()<<1,!(2>e)){c=this.mixer.createSample();c.length=e;c.loop=0;c.repeat=c.length;if(i+c.length>b.length)c.length=b.length-i;c.pointer=this.mixer.store(b,c.length,i);c.loopPtr=c.pointer;this.samples[g]=c;i+=c.length}}this.length*=13}},process:{value:function(){var b,g,d,e,f,a=this.voices[0];if(0==--this.tick){for(b=this.seqs.position;a;){g=a.channel;this.pats.position=a.pattern+a.patStep;f=this.pats.readUnsignedByte();if(64<=a.patStep||73==f){if(this.seqs.position==this.length)this.seqs.position=0,this.mixer.complete=1;a.patStep=0;a.pattern=this.seqs.readUnsignedByte()<<6;a.transpose=this.seqs.readByte();a.soundTranspose=this.seqs.readByte();this.pats.position=a.pattern;f=this.pats.readUnsignedByte()}d=this.pats.readUnsignedByte();this.frqs.position=0;this.vols.position=0;if(0!=f){a.note=f&127;a.pitch=0;a.portamento=0;a.enabled=g.enabled=0;f=8+((d&63)+a.soundTranspose<<6);if(f<this.vols.length)this.vols.position=f;a.volStep=0;a.volSpeed=a.volCtr=this.vols.readUnsignedByte();a.volSustain=0;a.frqPos=8+(this.vols.readUnsignedByte()<<6);a.frqStep=0;a.frqSustain=0;a.vibratoFlag=0;a.vibratoSpeed=this.vols.readUnsignedByte();a.vibratoDepth=a.vibrato=this.vols.readUnsignedByte();a.vibratoDelay=this.vols.readUnsignedByte();a.volPos=this.vols.position}if(d&64)a.portamento=0;else if(d&128)a.portamento=this.pats[this.pats.position+1],this.version==k&&(a.portamento<<=1);a.patStep+=2;a=a.next}if(this.seqs.position!=b&&(f=this.seqs.readUnsignedByte()))this.timer=f;this.tick=this.timer}for(a=this.voices[0];a;){g=a.channel;do{b=0;if(a.frqSustain){a.frqSustain--;break}this.frqs.position=a.frqPos+a.frqStep;do{e=0;if(0==this.frqs.bytesAvailable)break;d=this.frqs.readUnsignedByte();if(225==d)break;if(224==d)a.frqStep=this.frqs.readUnsignedByte()&63,this.frqs.position=a.frqPos+a.frqStep,d=this.frqs.readUnsignedByte();switch(d){case 226:g.enabled=0,a.enabled=1,a.volCtr=1,a.volStep=0;case 228:(d=this.samples[this.frqs.readUnsignedByte()])?(g.pointer=d.pointer,g.length=d.length):a.enabled=0;a.sample=d;a.frqStep+=2;break;case 233:f=100+10*this.frqs.readUnsignedByte();if(d=this.samples[f+this.frqs.readUnsignedByte()])g.enabled=0,g.pointer=d.pointer,g.length=d.length,a.enabled=1;a.sample=d;a.volCtr=1;a.volStep=0;a.frqStep+=3;break;case 231:e=1;a.frqPos=8+(this.frqs.readUnsignedByte()<<6);if(a.frqPos>=this.frqs.length)a.frqPos=0;a.frqStep=0;this.frqs.position=a.frqPos;break;case 234:a.pitchBendSpeed=this.frqs.readByte();a.pitchBendTime=this.frqs.readUnsignedByte();a.frqStep+=3;break;case 232:b=1;a.frqSustain=this.frqs.readUnsignedByte();a.frqStep+=2;break;case 227:a.vibratoSpeed=this.frqs.readUnsignedByte(),a.vibratoDepth=this.frqs.readUnsignedByte(),a.frqStep+=3}if(!b&&!e)this.frqs.position=a.frqPos+a.frqStep,a.frqTranspose=this.frqs.readByte(),a.frqStep++}while(e)}while(b);if(a.volSustain)a.volSustain--;else if(a.volBendTime)a.volumeBend();else if(0==--a.volCtr){a.volCtr=a.volSpeed;do{e=0;this.vols.position=a.volPos+a.volStep;if(0==this.vols.bytesAvailable)break;d=this.vols.readUnsignedByte();if(225==d)break;switch(d){case 234:a.volBendSpeed=this.vols.readByte();a.volBendTime=this.vols.readUnsignedByte();a.volStep+=3;a.volumeBend();break;case 232:a.volSustain=this.vols.readUnsignedByte();a.volStep+=2;break;case 224:e=1;f=this.vols.readUnsignedByte()&63;a.volStep=f-5;break;default:a.volume=d,a.volStep++}}while(e)}d=a.frqTranspose;0<=d&&(d+=a.note+a.transpose);d&=127;e=n[d];if(a.vibratoDelay)a.vibratoDelay--;else{f=a.vibrato;if(a.vibratoFlag){if(b=a.vibratoDepth<<1,f+=a.vibratoSpeed,f>b)f=b,a.vibratoFlag=0}else if(f-=a.vibratoSpeed,0>f)f=0,a.vibratoFlag=1;a.vibrato=f;f-=a.vibratoDepth;for(b=(d<<1)+160;256>b;)f<<=1,b+=24;e+=f}a.portamentoFlag^=1;if(a.portamentoFlag&&a.portamento)a.pitch=31<a.portamento?a.pitch+(a.portamento&31):a.pitch-a.portamento;a.pitchBendFlag^=1;a.pitchBendFlag&&a.pitchBendTime&&(a.pitchBendTime--,a.pitch-=a.pitchBendSpeed);e+=a.pitch;113>e?e=113:3424<e&&(e=3424);g.period=e;g.volume=a.volume;if(a.sample)d=a.sample,g.enabled=a.enabled,g.pointer=d.loopPtr,g.length=d.repeat;a=a.next}}}});
			h.voices[0]=j(0);
			h.voices[0].next=h.voices[1]=j(1);
			h.voices[1].next=h.voices[2]=j(2);
			h.voices[2].next=h.voices[3]=j(3);
			return Object.seal(h)
		}
		var k=1,m=2,n=[1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,906,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1812,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,906,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113],l=[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,8,8,8,8,8,8,8,8,16,8,16,16,8,8,24,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,63,55,47,39,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,55,47,39,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,47,39,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,39,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,-104,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,-104,-96,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,-104,-96,-88,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,-104,-96,-88,-80,55,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,127,127,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,127,-128,-128,-128,-128,-128,-128,-128,-128,127,127,127,127,127,127,127,127,-128,-128,-128,-128,-128,-128,-128,127,127,127,127,127,127,127,127,127,-128,-128,-128,-128,-128,-128,127,127,127,127,127,127,127,127,127,127,-128,-128,-128,-128,-128,127,127,127,127,127,127,127,127,127,127,127,-128,-128,-128,-128,127,127,127,127,127,127,127,127,127,127,127,127,-128,-128,-128,127,127,127,127,127,127,127,127,127,127,127,127,127,-128,-128,127,127,127,127,127,127,127,127,127,127,127,127,127,127,-128,-128,127,127,127,127,127,127,127,127,127,127,127,127,127,127,-128,-128,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,127,-128,-128,-96,-80,-64,-48,-32,-16,0,16,32,48,64,80,96,112,69,69,121,125,122,119,112,102,97,88,83,77,44,32,24,18,4,-37,-45,-51,-58,-68,-75,-82,-88,-93,-99,-103,-109,-114,-117,-118,69,69,121,125,122,119,112,102,91,75,67,55,44,32,24,18,4,-8,-24,-37,-49,-58,-66,-80,-88,-92,-98,-102,-107,-108,-115,-125,0,0,64,96,127,96,64,32,0,-32,-64,-96,-128,-96,-64,-32,0,0,64,96,127,96,64,32,0,-32,-64,-96,-128,-96,-64,-32,-128,-128,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,127,-128,-128,-96,-80,-64,-48,-32,-16,0,16,32,48,64,80,96,112]
	})();
	
	(function(){
		function l(i){
			return Object.create(null,{index:{value:i,writable:!0},next:{value:null,writable:!0},step:{value:0,writable:!0},row:{value:0,writable:!0},sample:{value:0,writable:!0},samplePtr:{value:0,writable:!0},sampleLen:{value:0,writable:!0},note:{value:0,writable:!0},noteTimer:{value:0,writable:!0},period:{value:0,writable:!0},volume:{value:0,writable:!0},bendTo:{value:0,writable:!0},bendSpeed:{value:0,writable:!0},arpeggioCtr:{value:0,writable:!0},envelopeCtr:{value:0,writable:!0},pitchCtr:{value:0,writable:!0},pitchFallCtr:{value:0,writable:!0},sustainCtr:{value:0,writable:!0},phaseTimer:{value:0,writable:!0},phaseSpeed:{value:0,writable:!0},wavePos:{value:0,writable:!0},waveList:{value:0,writable:!0},waveTimer:{value:0,writable:!0},waitCtr:{value:0,writable:!0},initialize:{value:function(){this.sample=this.row=this.step=0;this.samplePtr=-1;this.noteTimer=this.note=this.sampleLen=0;this.period=39321;this.waitCtr=this.waveTimer=this.waveList=this.wavePos=this.phaseSpeed=this.phaseTimer=this.sustainCtr=this.pitchFallCtr=this.pitchCtr=this.envelopeCtr=this.arpeggioCtr=this.bendSpeed=this.bendTo=this.volume=0}}})
		}
		window.neoart.createS1Player=function(i){
			i=createAmigaPlayer(i);
			Object.defineProperties(i,{id:{value:"S1Player"},tracksPtr:{value:null,writable:!0},tracks:{value:[],writable:!0},patternsPtr:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},waveLists:{value:null,writable:!0},speedDef:{value:0,writable:!0},patternDef:{value:0,writable:!0},mix1Speed:{value:0,writable:!0},mix2Speed:{value:0,writable:!0},mix1Dest:{value:0,writable:!0},mix2Dest:{value:0,writable:!0},mix1Source1:{value:0,writable:!0},mix1Source2:{value:0,writable:!0},mix2Source1:{value:0,writable:!0},mix2Source2:{value:0,writable:!0},doFilter:{value:0,writable:!0},doReset:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},trackEnd:{value:0,writable:!0},trackLen:{value:0,writable:!0},patternPos:{value:0,writable:!0},patternEnd:{value:0,writable:!0},patternLen:{value:0,writable:!0},mix1Ctr:{value:0,writable:!0},mix2Ctr:{value:0,writable:!0},mix1Pos:{value:0,writable:!0},mix2Pos:{value:0,writable:!0},audPtr:{value:0,writable:!0},audLen:{value:0,writable:!0},audPer:{value:0,writable:!0},audVol:{value:0,writable:!0},initialize:{value:function(){var b,e,c=this.voices[0];this.core_initialize();this.tick=this.timer=this.speedDef;this.trackPos=1;this.trackEnd=0;this.patternPos=-1;this.patternEnd=0;this.patternLen=this.patternDef;for(this.mix2Ctr=this.mix2Pos=this.mix1Ctr=this.mix1Pos=0;c;)c.initialize(),b=this.mixer.channels[c.index],c.channel=b,c.step=this.tracksPtr[c.index],e=this.tracks[c.step],c.row=this.patternsPtr[e.pattern],c.sample=this.patterns[c.row].sample,b.length=32,b.period=c.period,b.enabled=1,c=c.next}},loader:{value:function(b){for(var e,c,h,g,a,j,d,f,i,l,k,m;8<b.bytesAvailable;)if(f=b.readUnsignedShort(),16890==f&&(h=b.readUnsignedShort(),f=b.readUnsignedShort(),53736==f&&(f=b.readUnsignedShort(),65492==f))){m=4076==h?p:5222==h?n:h;j=h+b.position-6;break}if(0!=j&&(b.position=j," SID-MON BY R.v.VLIET  (c) 1988 "==b.readString(32))){b.position=j-44;f=b.readUnsignedInt();for(c=1;4>c;++c)this.tracksPtr[c]=(b.readUnsignedInt()-f)/6>>0;b.position=j-8;f=b.readUnsignedInt();a=b.readUnsignedInt();a<f&&(a=b.length-j);i=a-f>>2;this.patternsPtr=new Int32Array(i);b.position=j+f+4;for(c=1;c<i;++c){f=b.readUnsignedInt()/5>>0;if(0==f){i=c;break}this.patternsPtr[c]=f}b.position=j-44;f=b.readUnsignedInt();b.position=j-28;a=(b.readUnsignedInt()-f)/6>>0;this.tracks=[];this.tracks.length=a;b.position=j+f;for(c=0;c<a;++c){f=this.createStep();f.pattern=b.readUnsignedInt();if(f.pattern>=i)f.pattern=0;b.readByte();f.transpose=b.readByte();if(-99>f.transpose||99<f.transpose)f.transpose=0;this.tracks[c]=f}b.position=j-24;f=b.readUnsignedInt();k=b.readUnsignedInt()-f;for(c=0;32>c;++c)this.mixer.memory[c]=0;this.mixer.store(b,k,j+f);k>>=5;b.position=j-16;f=b.readUnsignedInt();a=b.readUnsignedInt()-f+16;h=k+2<<4;this.waveLists=new Int32Array(a<h?h:a);b.position=j+f;for(c=0;c<h;)this.waveLists[c++]=c>>4,this.waveLists[c++]=255,this.waveLists[c++]=255,this.waveLists[c++]=16,c+=12;for(c=16;c<a;++c)this.waveLists[c]=b.readUnsignedByte();b.position=j-20;b.position=j+b.readUnsignedInt();this.mix1Source1=b.readUnsignedInt();this.mix2Source1=b.readUnsignedInt();this.mix1Source2=b.readUnsignedInt();this.mix2Source2=b.readUnsignedInt();this.mix1Dest=b.readUnsignedInt();this.mix2Dest=b.readUnsignedInt();this.patternDef=b.readUnsignedInt();this.trackLen=b.readUnsignedInt();this.speedDef=b.readUnsignedInt();this.mix1Speed=b.readUnsignedInt();this.mix2Speed=b.readUnsignedInt();if(this.mix1Source1>k)this.mix1Source1=0;if(this.mix2Source1>k)this.mix2Source1=0;if(this.mix1Source2>k)this.mix1Source2=0;if(this.mix2Source2>k)this.mix2Source2=0;if(this.mix1Dest>k)this.mix1Speed=0;if(this.mix2Dest>k)this.mix2Speed=0;if(0==this.speedDef)this.speedDef=4;b.position=j-28;h=b.readUnsignedInt();i=b.readUnsignedInt()-h>>5;63<i&&(i=63);a=i+1;b.position=j-4;f=b.readUnsignedInt();if(1==f){b.position=1820;f=b.readUnsignedShort();if(19962!=f&&(b.position=1788,f=b.readUnsignedShort(),19962!=f)){this.version=0;return}b.position+=b.readUnsignedShort();this.samples=[];this.samples.length=a+3;for(c=0;3>c;++c)d=this.createSample(),d.waveform=16+c,d.length=r[c],d.pointer=this.mixer.store(b,d.length),d.loop=d.loopPtr=0,d.repeat=4,d.volume=64,this.samples[a+c]=d,b.position+=d.length}else this.samples=[],this.samples.length=a,b.position=j+f,e=b.readUnsignedInt(),l=(e>>5)+15,g=b.position,e+=g;d=this.createSample();d.name="flod";this.samples[0]=d;b.position=j+h;for(c=1;c<a;++c){d=this.createSample();d.waveform=b.readUnsignedInt();for(h=0;16>h;++h)d.arpeggio[h]=b.readUnsignedByte();d.attackSpeed=b.readUnsignedByte();d.attackMax=b.readUnsignedByte();d.decaySpeed=b.readUnsignedByte();d.decayMin=b.readUnsignedByte();d.sustain=b.readUnsignedByte();b.readByte();d.releaseSpeed=b.readUnsignedByte();d.releaseMin=b.readUnsignedByte();d.phaseShift=b.readUnsignedByte();d.phaseSpeed=b.readUnsignedByte();d.finetune=b.readUnsignedByte();d.pitchFall=b.readByte();if(m==n)d.pitchFall=d.finetune,d.finetune=0;else{if(15<d.finetune)d.finetune=0;d.finetune*=67}if(d.phaseShift>k)d.phaseShift=0,d.phaseSpeed=0;if(15<d.waveform)if(15<l&&d.waveform>l)d.waveform=0;else{f=g+(d.waveform-16<<5);if(f>=b.length)continue;h=b.position;b.position=f;d.pointer=b.readUnsignedInt();d.loop=b.readUnsignedInt();d.length=b.readUnsignedInt();d.name=b.readString(20);0==d.loop||99999==d.loop||199999==d.loop||d.loop>=d.length?(d.loop=0,d.repeat=m==p?2:4):(d.repeat=d.length-d.loop,d.loop-=d.pointer);d.length-=d.pointer;if(d.length<d.loop+d.repeat)d.length=d.loop+d.repeat;d.pointer=this.mixer.store(b,d.length,e+d.pointer);d.loopPtr=6>d.repeat||0==d.loop?0:d.pointer+d.loop;b.position=h}else if(d.waveform>k)d.waveform=0;this.samples[c]=d}b.position=j-12;f=b.readUnsignedInt();a=(b.readUnsignedInt()-f)/5>>0;this.patterns=[];this.patterns.length=a;b.position=j+f;for(c=0;c<a;++c){e=this.createRow();e.note=b.readUnsignedByte();e.sample=b.readUnsignedByte();e.effect=b.readUnsignedByte();e.param=b.readUnsignedByte();e.timer=b.readUnsignedByte();if(m==n){if(0<e.note&&255>e.note&&(e.note+=469),0<e.effect&&255>e.effect&&(e.effect+=469),59<e.sample)e.sample=i+(e.sample-60)}else if(e.sample>i)e.sample=0;this.patterns[c]=e}if(m==q||m==s||m==n){if(m==q)this.mix1Speed=this.mix2Speed=0;this.doReset=this.doFilter=0}else this.doReset=this.doFilter=1;this.version=1}}},process:{value:function(){var b,e,c,h=this.mixer.memory,g,a;for(a=this.voices[0];a;){b=a.channel;this.audPtr=-1;this.audLen=this.audPer=this.audVol=0;if(0==this.tick){if(this.patternEnd&&(this.trackEnd?a.step=this.tracksPtr[a.index]:a.step++,c=this.tracks[a.step],a.row=this.patternsPtr[c.pattern],this.doReset))a.noteTimer=0;if(0==a.noteTimer){g=this.patterns[a.row];if(0==g.sample){if(g.note&&(a.noteTimer=g.timer,a.waitCtr))e=this.samples[a.sample],this.audPtr=e.pointer,this.audLen=e.length,a.samplePtr=e.loopPtr,a.sampleLen=e.repeat,a.waitCtr=1,b.enabled=0}else{e=this.samples[g.sample];if(a.waitCtr)b.enabled=a.waitCtr=0;15<e.waveform?(this.audPtr=e.pointer,this.audLen=e.length,a.samplePtr=e.loopPtr,a.sampleLen=e.repeat,a.waitCtr=1):(a.wavePos=0,a.waveList=e.waveform,c=a.waveList<<4,this.audPtr=this.waveLists[c]<<5,this.audLen=32,a.waveTimer=this.waveLists[++c]);a.noteTimer=g.timer;a.sample=g.sample;a.envelopeCtr=a.pitchCtr=a.pitchFallCtr=0}if(g.note&&(a.noteTimer=g.timer,255!=g.note))switch(e=this.samples[a.sample],c=this.tracks[a.step],a.note=g.note+c.transpose,a.period=this.audPer=o[1+e.finetune+a.note],a.phaseSpeed=e.phaseSpeed,a.bendSpeed=a.volume=0,a.envelopeCtr=a.pitchCtr=a.pitchFallCtr=0,g.effect){case 0:if(0==g.param)break;e.attackSpeed=g.param;e.attackMax=g.param;a.waveTimer=0;break;case 2:this.timer=g.param;a.waveTimer=0;break;case 3:this.patternLen=g.param;a.waveTimer=0;break;default:a.bendTo=g.effect+c.transpose,a.bendSpeed=g.param}a.row++}else a.noteTimer--}e=this.samples[a.sample];this.audVol=a.volume;switch(a.envelopeCtr){case 0:this.audVol+=e.attackSpeed;if(this.audVol>e.attackMax)this.audVol=e.attackMax,a.envelopeCtr+=2;break;case 2:this.audVol-=e.decaySpeed;if(this.audVol<=e.decayMin||-256>this.audVol)this.audVol=e.decayMin,a.envelopeCtr+=2,a.sustainCtr=e.sustain;break;case 4:a.sustainCtr--;if(0==a.sustainCtr||-256==a.sustainCtr)a.envelopeCtr+=2;break;case 6:if(this.audVol-=e.releaseSpeed,this.audVol<=e.releaseMin||-256>this.audVol)this.audVol=e.releaseMin,a.envelopeCtr=8}a.volume=this.audVol;a.arpeggioCtr=++a.arpeggioCtr&15;c=e.finetune+e.arpeggio[a.arpeggioCtr]+a.note;a.period=this.audPer=o[c];if(a.bendSpeed&&(g=o[e.finetune+a.bendTo],c=~a.bendSpeed+1,-128>c&&(c&=255),a.pitchCtr+=c,a.period+=a.pitchCtr,0>c&&a.period<=g||0<c&&a.period>=g))a.note=a.bendTo,a.period=g,a.bendSpeed=0,a.pitchCtr=0;if(e.phaseShift)a.phaseSpeed?a.phaseSpeed--:(a.phaseTimer=++a.phaseTimer&31,c=(e.phaseShift<<5)+a.phaseTimer,a.period+=h[c]>>2);a.pitchFallCtr-=e.pitchFall;-256>a.pitchFallCtr&&(a.pitchFallCtr+=256);a.period+=a.pitchFallCtr;if(0==a.waitCtr)if(a.waveTimer)a.waveTimer--;else if(16>a.wavePos)c=(a.waveList<<4)+a.wavePos,g=this.waveLists[c++],255==g?a.wavePos=this.waveLists[c]&254:(this.audPtr=g<<5,a.waveTimer=this.waveLists[c],a.wavePos+=2);if(-1<this.audPtr)b.pointer=this.audPtr;if(0!=this.audPer)b.period=a.period;if(0!=this.audLen)b.length=this.audLen;b.volume=e.volume?e.volume:this.audVol>>2;b.enabled=1;a=a.next}this.trackEnd=this.patternEnd=0;if(++this.tick>this.timer&&(this.tick=0,++this.patternPos==this.patternLen&&(this.patternPos=0,this.patternEnd=1,++this.trackPos==this.trackLen)))this.trackPos=this.trackEnd=this.mixer.complete=1;if(this.mix1Speed){if(0==this.mix1Ctr){this.mix1Ctr=this.mix1Speed;c=this.mix1Pos=++this.mix1Pos&31;b=(this.mix1Dest<<5)+31;a=(this.mix1Source1<<5)+31;g=this.mix1Source2<<5;for(e=31;-1<e;--e)h[b--]=h[a--]+h[g+c]>>1,c=--c&31}this.mix1Ctr--}if(this.mix2Speed){if(0==this.mix2Ctr){this.mix2Ctr=this.mix2Speed;c=this.mix2Pos=++this.mix2Pos&31;b=(this.mix2Dest<<5)+31;a=(this.mix2Source1<<5)+31;g=this.mix2Source2<<5;for(e=31;-1<e;--e)h[b--]=h[a--]+h[g+c]>>1,c=--c&31}this.mix2Ctr--}this.doFilter&&(c=this.mix1Pos+32,h[c]=~h[c]+1);for(a=this.voices[0];a;){b=a.channel;if(1==a.waitCtr)a.waitCtr++;else if(2==a.waitCtr)a.waitCtr++,b.pointer=a.samplePtr,b.length=a.sampleLen;a=a.next}}},createRow:{value:function(){var b=this.mixer.createRow();Object.defineProperties(b,{timer:{value:0,writable:!0}});return b}},createSample:{value:function(){var b=this.mixer.createSample();Object.defineProperties(b,{waveform:{value:0,writable:!0},arpeggio:{value:null,writable:!0},attackSpeed:{value:0,writable:!0},attackMax:{value:0,writable:!0},decaySpeed:{value:0,writable:!0},decayMin:{value:0,writable:!0},sustain:{value:0,writable:!0},releaseSpeed:{value:0,writable:!0},releaseMin:{value:0,writable:!0},phaseShift:{value:0,writable:!0},phaseSpeed:{value:0,writable:!0},finetune:{value:0,writable:!0},pitchFall:{value:0,writable:!0}});b.arpeggio=new Int32Array(16);return b}},createStep:{value:function(){return Object.create(null,{pattern:{value:0,writable:!0},transpose:{value:0,writable:!0}})}}});
			i.tracksPtr=new Int32Array(4);
			i.voices[0]=l(0);
			i.voices[0].next=i.voices[1]=l(1);
			i.voices[1].next=i.voices[2]=l(2);
			i.voices[2].next=i.voices[3]=l(3);
			return Object.seal(i)
			
		}
		var p=4090,q=4464,s=4550,n=5188,r=[1166,408,908],o=[0,5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,904,856,808,762,720,678,640,604,570,538,508,480,452,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,0,0,0,0,0,0,0,4028,3806,3584,3394,3204,3013,2855,2696,2538,2395,2268,2141,2014,1903,1792,1697,1602,1507,1428,1348,1269,1198,1134,1071,1007,952,896,849,801,754,714,674,635,599,567,536,504,476,448,425,401,377,357,337,310,300,284,268,252,238,224,213,201,189,179,169,159,150,142,134,0,0,0,0,0,0,0,3993,3773,3552,3364,3175,2987,2830,2672,2515,2374,2248,2122,1997,1887,1776,1682,1588,1494,1415,1336,1258,1187,1124,1061,999,944,888,841,794,747,708,668,629,594,562,531,500,472,444,421,397,374,354,334,315,297,281,266,250,236,222,211,199,187,177,167,158,149,141,133,0,0,0,0,0,0,0,3957,3739,3521,3334,3147,2960,2804,2648,2493,2353,2228,2103,1979,1870,1761,1667,1574,1480,1402,1324,1247,1177,1114,1052,990,935,881,834,787,740,701,662,624,589,557,526,495,468,441,417,394,370,351,331,312,295,279,263,248,234,221,209,197,185,176,166,156,148,140,132,0,0,0,0,0,0,0,3921,3705,3489,3304,3119,2933,2779,2625,2470,2331,2208,2084,1961,1853,1745,1652,1560,1467,1390,1313,1235,1166,1104,1042,981,927,873,826,780,734,695,657,618,583,552,521,491,464,437,413,390,367,348,329,309,292,276,261,246,232,219,207,195,184,174,165,155,146,138,131,0,0,0,0,0,0,0,3886,3671,3457,3274,3090,2907,2754,2601,2448,2310,2188,2065,1943,1836,1729,1637,1545,1454,1377,1301,1224,1155,1094,1033,972,918,865,819,773,727,689,651,612,578,547,517,486,459,433,410,387,364,345,326,306,289,274,259,243,230,217,205,194,182,173,163,153,145,137,130,0,0,0,0,0,0,0,3851,3638,3426,3244,3062,2880,2729,2577,2426,2289,2168,2047,1926,1819,1713,1622,1531,1440,1365,1289,1213,1145,1084,1024,963,910,857,811,766,720,683,645,607,573,542,512,482,455,429,406,383,360,342,323,304,287,271,256,241,228,215,203,192,180,171,162,152,144,136,128,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,904,856,808,762,720,678,640,604,570,538,508,480,452,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127]
	})();
	
	(function(){
		function j(h){
			return Object.create(null,{index:{value:h,writable:!0},next:{value:null,writable:!0},step:{value:null,writable:!0},row:{value:null,writable:!0},instr:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},pattern:{value:0,writable:!0},instrument:{value:0,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},volume:{value:0,writable:!0},original:{value:0,writable:!0},adsrPos:{value:0,writable:!0},sustainCtr:{value:0,writable:!0},pitchBend:{value:0,writable:!0},pitchBendCtr:{value:0,writable:!0},noteSlideTo:{value:0,writable:!0},noteSlideSpeed:{value:0,writable:!0},waveCtr:{value:0,writable:!0},wavePos:{value:0,writable:!0},arpeggioCtr:{value:0,writable:!0},arpeggioPos:{value:0,writable:!0},vibratoCtr:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},timer:{value:0,writable:!0},initialize:{value:function(){this.sample=this.instr=this.row=this.step=null;this.timer=this.vibratoPos=this.vibratoCtr=this.arpeggioPos=this.arpeggioCtr=this.wavePos=this.waveCtr=this.noteSlideSpeed=this.noteSlideTo=this.pitchBendCtr=this.pitchBend=this.sustainCtr=this.adsrPos=this.original=this.volume=this.period=this.note=this.instrument=this.pattern=this.enabled=0}}})
		}
		window.neoart.createS2Player=function(h){
			h=createAmigaPlayer(h);
			Object.defineProperties(h,{id:{value:"S2Player"},tracks:{value:[],writable:!0},patterns:{value:[],writable:!0},instruments:{value:[],writable:!0},samples:{value:[],writable:!0},arpeggios:{value:[],writable:!0},vibratos:{value:[],writable:!0},waves:{value:[],writable:!0},length:{value:0,writable:!0},speedDef:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},patternLen:{value:0,writable:!0},arpeggioFx:{value:[],writable:!0},arpeggioPos:{value:0,writable:!0},initialize:{value:function(){var b=this.voices[0];this.core_initialize();this.tick=this.timer=this.speedDef;this.patternPos=this.trackPos=0;for(this.patternLen=64;b;)b.initialize(),b.channel=this.mixer.channels[b.index],b.instr=this.instruments[0],this.arpeggioFx[b.index]=0,b=b.next}},loader:{value:function(b){var c,d,e,f;e=0;var a,h=0,i,j,g;b.position=58;if("SIDMON II - THE MIDI VERSION"==b.readString(28)){b.position=2;this.length=b.readUnsignedByte();this.speedDef=b.readUnsignedByte();this.samples=[];this.samples.length=b.readUnsignedShort()>>6;b.position=14;f=b.readUnsignedInt();this.tracks=[];this.tracks.length=f;b.position=90;for(c=0;c<f;++c){a=this.createStep();a.pattern=b.readUnsignedByte();if(a.pattern>e)e=a.pattern;this.tracks[c]=a}for(c=0;c<f;++c)a=this.tracks[c],a.transpose=b.readByte();for(c=0;c<f;++c)a=this.tracks[c],a.soundTranspose=b.readByte();a=b.position;b.position=26;f=b.readUnsignedInt()>>5;this.instruments=[];this.instruments.length=++f;b.position=a;this.instruments[0]=this.createInstrument();for(c=0;++c<f;)d=this.createInstrument(),d.wave=b.readUnsignedByte()<<4,d.waveLen=b.readUnsignedByte(),d.waveSpeed=b.readUnsignedByte(),d.waveDelay=b.readUnsignedByte(),d.arpeggio=b.readUnsignedByte()<<4,d.arpeggioLen=b.readUnsignedByte(),d.arpeggioSpeed=b.readUnsignedByte(),d.arpeggioDelay=b.readUnsignedByte(),d.vibrato=b.readUnsignedByte(),d.vibratoLen=b.readUnsignedByte(),d.vibratoSpeed=b.readUnsignedByte(),d.vibratoDelay=b.readUnsignedByte(),d.pitchBend=b.readByte(),d.pitchBendDelay=b.readUnsignedByte(),b.readByte(),b.readByte(),d.attackMax=b.readUnsignedByte(),d.attackSpeed=b.readUnsignedByte(),d.decayMin=b.readUnsignedByte(),d.decaySpeed=b.readUnsignedByte(),d.sustain=b.readUnsignedByte(),d.releaseMin=b.readUnsignedByte(),d.releaseSpeed=b.readUnsignedByte(),this.instruments[c]=d,b.position+=9;a=b.position;b.position=30;f=b.readUnsignedInt();this.waves=[];this.waves.length=f;b.position=a;for(c=0;c<f;++c)this.waves[c]=b.readUnsignedByte();a=b.position;b.position=34;f=b.readUnsignedInt();this.arpeggios=[];this.arpeggios.length=f;b.position=a;for(c=0;c<f;++c)this.arpeggios[c]=b.readByte();a=b.position;b.position=38;f=b.readUnsignedInt();this.vibratos=[];this.vibratos.length=f;b.position=a;for(c=0;c<f;++c)this.vibratos[c]=b.readByte();f=this.samples.length;for(c=a=0;c<f;++c)d=this.createSample(),b.readUnsignedInt(),d.length=b.readUnsignedShort()<<1,d.loop=b.readUnsignedShort()<<1,d.repeat=b.readUnsignedShort()<<1,d.negStart=a+(b.readUnsignedShort()<<1),d.negLen=b.readUnsignedShort()<<1,d.negSpeed=b.readUnsignedShort(),d.negDir=b.readUnsignedShort(),d.negOffset=b.readShort(),d.negPos=b.readUnsignedInt(),d.negCtr=b.readUnsignedShort(),b.position+=6,d.name=b.readString(32),d.pointer=a,d.loopPtr=a+d.loop,a+=d.length,this.samples[c]=d;j=a;f=++e;d=[];d.length=++e;for(c=0;c<f;++c)d[c]=b.readUnsignedShort();a=b.position;b.position=50;f=b.readUnsignedInt();this.patterns=[];b.position=a;e=1;for(c=0;c<f;++c)i=this.createRow(),g=b.readByte(),0==g?(i.effect=b.readByte(),i.param=b.readUnsignedByte(),c+=2):0>g?i.timer=~g:112>g?(i.note=g,g=b.readByte(),c++,0>g?i.timer=~g:112>g?(i.sample=g,g=b.readByte(),c++,0>g?i.timer=~g:(i.effect=g,i.param=b.readUnsignedByte(),c++)):(i.effect=g,i.param=b.readUnsignedByte(),c++)):(i.effect=g,i.param=b.readUnsignedByte(),c++),this.patterns[h++]=i,a+d[e]==b.position&&(d[e++]=h);d[e]=this.patterns.length;0!=(b.position&1)&&b.position++;this.mixer.store(b,j);f=this.tracks.length;for(c=0;c<f;++c)a=this.tracks[c],a.pattern=d[a.pattern];this.length++;this.version=1}}},process:{value:function(){var b,c,d,e,f,a=this.voices[0];this.arpeggioPos=++this.arpeggioPos&3;if(++this.tick>=this.timer){for(this.tick=0;a;){b=a.channel;a.enabled=a.note=0;if(0==this.patternPos)a.step=this.tracks[this.trackPos+a.index*this.length],a.pattern=a.step.pattern,a.timer=0;if(0>--a.timer&&(a.row=d=this.patterns[a.pattern++],a.timer=d.timer,d.note))a.enabled=1,a.note=d.note+a.step.transpose,b.enabled=0;a.pitchBend=0;if(a.note){a.waveCtr=a.sustainCtr=0;a.arpeggioCtr=a.arpeggioPos=0;a.vibratoCtr=a.vibratoPos=0;a.pitchBendCtr=a.noteSlideSpeed=0;a.adsrPos=4;a.volume=0;if(d.sample)a.instrument=d.sample,a.instr=this.instruments[a.instrument+a.step.soundTranspose],a.sample=this.samples[this.waves[a.instr.wave]];a.original=a.note+this.arpeggios[a.instr.arpeggio];b.period=a.period=k[a.original];e=a.sample;b.pointer=e.pointer;b.length=e.length;b.enabled=a.enabled;b.pointer=e.loopPtr;b.length=e.repeat}a=a.next}if(++this.patternPos==this.patternLen&&(this.patternPos=0,++this.trackPos==this.length))this.trackPos=0,this.mixer.complete=1}for(a=this.voices[0];a;){if(a.sample&&(e=a.sample,!e.negToggle))if(e.negToggle=1,e.negCtr)e.negCtr=--e.negCtr&31;else{e.negCtr=e.negSpeed;if(0==e.negDir){a=a.next;continue}f=e.negStart=e.negPos;this.mixer.memory[f]=~this.mixer.memory[f];e.negPos+=e.negOffset;f=e.negLen-1;if(0>e.negPos)2==e.negDir?e.negPos=f:(e.negOffset=~e.negOffset+1,e.negPos+=e.negOffset);else if(f<e.negPos)1==e.negDir?e.negPos=0:(e.negOffset=~e.negOffset+1,e.negPos+=e.negOffset)}a=a.next}for(a=this.voices[0];a;){if(a.sample)a.sample.negToggle=0;a=a.next}for(a=this.voices[0];a;){b=a.channel;c=a.instr;switch(a.adsrPos){case 4:a.volume+=c.attackSpeed;if(c.attackMax<=a.volume)a.volume=c.attackMax,a.adsrPos--;break;case 3:if(0==c.decaySpeed)a.adsrPos--;else if(a.volume-=c.decaySpeed,c.decayMin>=a.volume)a.volume=c.decayMin,a.adsrPos--;break;case 2:a.sustainCtr==c.sustain?a.adsrPos--:a.sustainCtr--;break;case 1:if(a.volume-=c.releaseSpeed,c.releaseMin>=a.volume)a.volume=c.releaseMin,a.adsrPos--}b.volume=a.volume>>2;if(c.waveLen)a.waveCtr==c.waveDelay?(a.waveCtr=c.waveDelay-c.waveSpeed,a.wavePos==c.waveLen?a.wavePos=0:a.wavePos++,a.sample=e=this.samples[waves[c.wave+a.wavePos]],b.pointer=e.pointer,b.length=e.length):a.waveCtr++;if(c.arpeggioLen)a.arpeggioCtr==c.arpeggioDelay?(a.arpeggioCtr=c.arpeggioDelay-c.arpeggioSpeed,a.arpeggioPos==c.arpeggioLen?a.arpeggioPos=0:a.arpeggioPos++,f=a.original+this.arpeggios[c.arpeggio+a.arpeggioPos],a.period=k[f]):a.arpeggioCtr++;d=a.row;if(0==this.tick)switch(d.effect){case 112:this.arpeggioFx[0]=d.param>>4;this.arpeggioFx[2]=d.param&15;f=a.original+this.arpeggioFx[this.arpeggioPos];a.period=k[f];break;case 113:a.pitchBend=~d.param+1;break;case 114:a.pitchBend=d.param;break;case 115:if(0!=a.adsrPos)break;if(0!=a.instrument)a.volume=c.attackMax;a.volume+=d.param<<2;if(256<=a.volume)a.volume=-1;break;case 116:if(0!=a.adsrPos)break;if(0!=a.instrument)a.volume=c.attackMax;a.volume-=d.param<<2;if(0>a.volume)a.volume=0}switch(d.effect){case 117:c.attackMax=d.param;c.attackSpeed=d.param;break;case 118:this.patternLen=d.param;break;case 119:b.volume=d.param;a.volume=d.param<<2;if(255<=a.volume)a.volume=255;break;case 120:if(f=d.param&15)this.timer=f}if(c.vibratoLen)a.vibratoCtr==c.vibratoDelay?(a.vibratoCtr=c.vibratoDelay-c.vibratoSpeed,a.vibratoPos==c.vibratoLen?a.vibratoPos=0:a.vibratoPos++,a.period+=this.vibratos[c.vibrato+a.vibratoPos]):a.vibratoCtr++;c.pitchBend&&(a.pitchBendCtr==c.pitchBendDelay?a.pitchBend+=c.pitchBend:a.pitchBendCtr++);if(d.param&&d.effect&&112>d.param)a.noteSlideTo=k[d.effect+a.step.transpose],f=d.param,0>a.noteSlideTo-a.period&&(f=~f+1),a.noteSlideSpeed=f;if(a.noteSlideTo&&a.noteSlideSpeed&&(a.period+=a.noteSlideSpeed,0>a.noteSlideSpeed&&a.period<a.noteSlideTo||0<a.noteSlideSpeed&&a.period>a.noteSlideTo))a.noteSlideSpeed=0,a.period=a.noteSlideTo;a.period+=a.pitchBend;if(95>a.period)a.period=95;else if(5760<a.period)a.period=5760;b.period=a.period;a=a.next}}},createInstrument:{value:function(){return Object.create(null,{wave:{value:0,writable:!0},waveLen:{value:0,writable:!0},waveDelay:{value:0,writable:!0},waveSpeed:{value:0,writable:!0},arpeggio:{value:0,writable:!0},arpeggioLen:{value:0,writable:!0},arpeggioDelay:{value:0,writable:!0},arpeggioSpeed:{value:0,writable:!0},vibrato:{value:0,writable:!0},vibratoLen:{value:0,writable:!0},vibratoDelay:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},pitchBend:{value:0,writable:!0},pitchBendDelay:{value:0,writable:!0},attackMax:{value:0,writable:!0},attackSpeed:{value:0,writable:!0},decayMin:{value:0,writable:!0},decaySpeed:{value:0,writable:!0},sustain:{value:0,writable:!0},releaseMin:{value:0,writable:!0},releaseSpeed:{value:0,writable:!0}})}},createRow:{value:function(){var b=this.mixer.createRow();Object.defineProperties(b,{timer:{value:0,writable:!0}});return b}},createSample:{value:function(){var b=this.mixer.createSample();Object.defineProperties(b,{negStart:{value:0,writable:!0},negLen:{value:0,writable:!0},negSpeed:{value:0,writable:!0},negDir:{value:0,writable:!0},negOffset:{value:0,writable:!0},negPos:{value:0,writable:!0},negCtr:{value:0,writable:!0},negToggle:{value:0,writable:!0}});return b}},createStep:{value:function(){return Object.create(null,{pattern:{value:0,writable:!0},soundTranspose:{value:0,writable:!0},transpose:{value:0,writable:!0}})}}});
			h.voices[0]=j(0);
			h.voices[0].next=h.voices[1]=j(1);
			h.voices[1].next=h.voices[2]=j(2);
			h.voices[2].next=h.voices[3]=j(3);
			return Object.seal(h)
		}
		var k=[5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,904,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95]
	})();
	
	(function(){
		function k(i){
			return Object.create(null,{index:{value:i,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},enabled:{value:0,writable:!0},restart:{value:0,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},sample:{value:0,writable:!0},samplePtr:{value:0,writable:!0},sampleLen:{value:0,writable:!0},synth:{value:0,writable:!0},synthPtr:{value:0,writable:!0},arpeggio:{value:0,writable:!0},autoArpeggio:{value:0,writable:!0},autoSlide:{value:0,writable:!0},vibrato:{value:0,writable:!0},volume:{value:0,writable:!0},volumeDef:{value:0,writable:!0},adsrControl:{value:0,writable:!0},adsrPtr:{value:0,writable:!0},adsrCtr:{value:0,writable:!0},lfoControl:{value:0,writable:!0},lfoPtr:{value:0,writable:!0},lfoCtr:{value:0,writable:!0},egControl:{value:0,writable:!0},egPtr:{value:0,writable:!0},egCtr:{value:0,writable:!0},egValue:{value:0,writable:!0},fxControl:{value:0,writable:!0},fxCtr:{value:0,writable:!0},modControl:{value:0,writable:!0},modPtr:{value:0,writable:!0},modCtr:{value:0,writable:!0},initialize:{value:function(){this.channel=null;this.enabled=0;this.samplePtr=this.sample=this.period=this.note=this.restart=0;this.sampleLen=2;this.synth=0;this.synthPtr=-1;this.modCtr=this.modPtr=this.modControl=this.fxCtr=this.fxControl=this.egValue=this.egCtr=this.egPtr=this.egControl=this.lfoCtr=this.lfoPtr=this.lfoControl=this.adsrCtr=this.adsrPtr=this.adsrControl=this.volumeDef=this.volume=this.vibrato=this.autoSlide=this.autoArpeggio=this.arpeggio=0}}})
		}
		window.neoart.createBPPlayer=function(i){
			i=createAmigaPlayer(i);
			Object.defineProperties(i,{id:{value:"BPPlayer"},tracks:{value:[],writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},buffer:{value:[],writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},nextPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},repeatCtr:{value:0,writable:!0},arpeggioCtr:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},initialize:{value:function(){var c=0,e=this.voices[0];this.core_initialize();this.timer=6;this.tick=1;this.repeatCtr=this.jumpFlag=this.nextPos=this.patternPos=this.trackPos=0;this.arpeggioCtr=1;for(this.vibratoPos=0;128>c;++c)this.buffer[c]=0;for(;e;)e.initialize(),e.channel=this.mixer.channels[e.index],e.samplePtr=this.mixer.loopPtr,e=e.next}},reset:{value:function(){for(var c,e,b,d=this.voices[0];d;){if(!(0>d.synthPtr)){b=d.index<<5;e=d.synthPtr+32;for(c=d.synthPtr;c<e;++c)this.mixer.memory[c]=this.buffer[b++]}d=d.next}}},loader:{value:function(c){var e=0,b,d=0,g,f;this.title=c.readString(26);b=c.readString(4);if("BPSM"==b)this.version=m;else{b=b.substr(0,3);if("V.2"==b)this.version=n;else if("V.3"==b)this.version=j;else return;c.position=29;f=c.readUnsignedByte()}for(this.length=c.readUnsignedShort();16>++e;){b=this.createSample();if(255==c.readUnsignedByte())b.synth=1,b.table=c.readUnsignedByte(),b.pointer=b.table<<6,b.length=c.readUnsignedShort()<<1,b.adsrControl=c.readUnsignedByte(),b.adsrTable=c.readUnsignedByte()<<6,b.adsrLen=c.readUnsignedShort(),b.adsrSpeed=c.readUnsignedByte(),b.lfoControl=c.readUnsignedByte(),b.lfoTable=c.readUnsignedByte()<<6,b.lfoDepth=c.readUnsignedByte(),b.lfoLen=c.readUnsignedShort(),this.version<j?(c.readByte(),b.lfoDelay=c.readUnsignedByte(),b.lfoSpeed=c.readUnsignedByte(),b.egControl=c.readUnsignedByte(),b.egTable=c.readUnsignedByte()<<6,c.readByte(),b.egLen=c.readUnsignedShort(),c.readByte(),b.egDelay=c.readUnsignedByte(),b.egSpeed=c.readUnsignedByte(),b.fxSpeed=1,b.modSpeed=1,b.volume=c.readUnsignedByte(),c.position+=6):(b.lfoDelay=c.readUnsignedByte(),b.lfoSpeed=c.readUnsignedByte(),b.egControl=c.readUnsignedByte(),b.egTable=c.readUnsignedByte()<<6,b.egLen=c.readUnsignedShort(),b.egDelay=c.readUnsignedByte(),b.egSpeed=c.readUnsignedByte(),b.fxControl=c.readUnsignedByte(),b.fxSpeed=c.readUnsignedByte(),b.fxDelay=c.readUnsignedByte(),b.modControl=c.readUnsignedByte(),b.modTable=c.readUnsignedByte()<<6,b.modSpeed=c.readUnsignedByte(),b.modDelay=c.readUnsignedByte(),b.volume=c.readUnsignedByte(),b.modLen=c.readUnsignedShort());else if(c.position--,b.synth=0,b.name=c.readString(24),b.length=c.readUnsignedShort()<<1,b.length){if(b.loop=c.readUnsignedShort(),b.repeat=c.readUnsignedShort()<<1,b.volume=c.readUnsignedShort(),b.loop+b.repeat>=b.length)b.repeat=b.length-b.loop}else b.pointer--,b.repeat=2,c.position+=6;this.samples[e]=b}b=this.length<<2;this.tracks=[];this.tracks.length=b;for(e=0;e<b;++e){g=this.createStep();g.pattern=c.readUnsignedShort();g.soundTranspose=c.readByte();g.transpose=c.readByte();if(g.pattern>d)d=g.pattern;this.tracks[e]=g}b=d<<4;this.patterns=[];this.patterns.length=b;for(e=0;e<b;++e)d=this.mixer.createRow(),d.note=c.readByte(),d.sample=c.readUnsignedByte(),d.effect=d.sample&15,d.sample=(d.sample&240)>>4,d.param=c.readByte(),this.patterns[e]=d;this.mixer.store(c,f<<6);for(e=0;16>++e;)if(b=this.samples[e],!(b.synth||0==b.length))b.pointer=this.mixer.store(c,b.length),b.loopPtr=b.pointer+b.loop}},process:{value:function(){var c,e,b,d,g,f=this.mixer.memory,h,a=this.voices[0];this.arpeggioCtr=--this.arpeggioCtr&3;for(this.vibratoPos=++this.vibratoPos&7;a;){c=a.channel;a.period+=a.autoSlide;c.period=a.vibrato?a.period+(o[this.vibratoPos]/a.vibrato>>0):a.period;c.pointer=a.samplePtr;c.length=a.sampleLen;if(a.arpeggio||a.autoArpeggio)d=a.note,0==this.arpeggioCtr?d+=((a.arpeggio&240)>>4)+((a.autoArpeggio&240)>>4):1==this.arpeggioCtr&&(d+=(a.arpeggio&15)+(a.autoArpeggio&15)),c.period=a.period=l[d+35],a.restart=0;if(a.synth){d=this.samples[a.sample];if(a.adsrControl&&0==--a.adsrCtr&&(a.adsrCtr=d.adsrSpeed,e=128+f[d.adsrTable+a.adsrPtr]>>2,c.volume=e*a.volume>>6,++a.adsrPtr==d.adsrLen&&(a.adsrPtr=0,1==a.adsrControl)))a.adsrControl=0;if(a.lfoControl&&0==--a.lfoCtr&&(a.lfoCtr=d.lfoSpeed,e=f[d.lfoTable+a.lfoPtr],d.lfoDepth&&(e=e/d.lfoDepth>>0),c.period=a.period+e,++a.lfoPtr==d.lfoLen&&(a.lfoPtr=0,1==a.lfoControl)))a.lfoControl=0;if(!(0>a.synthPtr)){if(a.egControl&&0==--a.egCtr){a.egCtr=d.egSpeed;e=a.egValue;a.egValue=128+f[d.egTable+a.egPtr]>>3;if(a.egValue!=e)if(h=(a.index<<5)+e,b=a.synthPtr+e,a.egValue<e){e-=a.egValue;for(g=b-e;b>g;)f[--b]=this.buffer[--h]}else{e=a.egValue-e;for(g=b+e;b<g;)f[b++]=~this.buffer[h++]+1}if(++a.egPtr==d.egLen&&(a.egPtr=0,1==a.egControl))a.egControl=0}switch(a.fxControl){case 1:if(0==--a.fxCtr){a.fxCtr=d.fxSpeed;b=a.synthPtr;g=a.synthPtr+32;for(e=0<b?f[b-1]:0;b<g;)e=e+f[b+1]>>1,f[b++]=e}break;case 2:h=(a.index<<5)+31;g=a.synthPtr+32;e=d.fxSpeed;for(b=a.synthPtr;b<g;++b)this.buffer[h]<f[b]?f[b]-=e:this.buffer[h]>f[b]&&(f[b]+=e),h--;break;case 3:case 5:h=a.index<<5;g=a.synthPtr+32;e=d.fxSpeed;for(b=a.synthPtr;b<g;++b)this.buffer[h]<f[b]?f[b]-=e:this.buffer[h]>f[b]&&(f[b]+=e),h++;break;case 4:h=a.synthPtr+64;g=a.synthPtr+32;e=d.fxSpeed;for(b=a.synthPtr;b<g;++b)f[h]<f[b]?f[b]-=e:f[h]>f[b]&&(f[b]+=e),h++;break;case 6:if(0==--a.fxCtr){a.fxControl=0;a.fxCtr=1;h=a.synthPtr+64;g=a.synthPtr+32;for(b=a.synthPtr;b<g;++b)f[b]=f[h++]}}if(a.modControl&&0==--a.modCtr&&(a.modCtr=d.modSpeed,f[a.synthPtr+32]=f[d.modTable+a.modPtr],++a.modPtr==d.modLen&&(a.modPtr=0,1==a.modControl)))a.modControl=0}}a=a.next}if(0==--this.tick){this.tick=this.timer;for(a=this.voices[0];a;){c=a.channel;a.enabled=0;g=this.tracks[(this.trackPos<<2)+a.index];h=this.patterns[this.patternPos+(g.pattern-1<<4)];d=h.note;b=h.effect;e=h.param;if(d){a.autoArpeggio=a.autoSlide=a.vibrato=0;if(10!=b||0==(e&240))d+=g.transpose;a.note=d;a.period=l[d+35];a.restart=13>b?a.volumeDef=1:0;d=h.sample;if(0==d)d=a.sample;if(10!=b||0==(e&15))d+=g.soundTranspose;if(13>b&&(!a.synth||a.sample!=d))a.sample=d,a.enabled=1}switch(b){case 0:a.arpeggio=e;break;case 1:a.volume=e;a.volumeDef=0;if(this.version<j||!a.synth)c.volume=a.volume;break;case 2:this.tick=this.timer=e;break;case 3:this.mixer.filter.active=e;break;case 4:a.period-=e;a.arpeggio=0;break;case 5:a.period+=e;a.arpeggio=0;break;case 6:this.version==j?a.vibrato=e:repeatCtr=e;break;case 7:if(this.version==j)this.nextPos=e,this.jumpFlag=1;else if(0==this.repeatCtr)this.trackPos=e;break;case 8:a.autoSlide=e;break;case 9:a.autoArpeggio=e;if(this.version==j&&(a.adsrPtr=0,0==a.adsrControl))a.adsrControl=1;break;case 11:a.fxControl=e;break;case 13:a.autoArpeggio=e;a.fxControl^=1;a.adsrPtr=0;if(0==a.adsrControl)a.adsrControl=1;break;case 14:a.autoArpeggio=e;a.adsrPtr=0;if(0==a.adsrControl)a.adsrControl=1;break;case 15:a.autoArpeggio=e}a=a.next}if(this.jumpFlag)this.trackPos=this.nextPos,this.patternPos=this.jumpFlag=0;else if(16==++this.patternPos&&(this.patternPos=0,++this.trackPos==this.length))this.trackPos=0,this.mixer.complete=1;for(a=this.voices[0];a;){c=a.channel;if(a.enabled)c.enabled=a.enabled=0;if(0!=a.restart&&-1<a.synthPtr){h=a.index<<5;g=a.synthPtr+32;for(b=a.synthPtr;b<g;++b)f[b]=this.buffer[h++];a.synthPtr=-1}a=a.next}for(a=this.voices[0];a;){if(0!=a.restart){c=a.channel;c.period=a.period;a.restart=0;d=this.samples[a.sample];if(d.synth){a.synth=1;a.egValue=0;a.adsrPtr=a.lfoPtr=a.egPtr=a.modPtr=0;a.adsrCtr=1;a.lfoCtr=d.lfoDelay+1;a.egCtr=d.egDelay+1;a.fxCtr=d.fxDelay+1;a.modCtr=d.modDelay+1;a.adsrControl=d.adsrControl;a.lfoControl=d.lfoControl;a.egControl=d.egControl;a.fxControl=d.fxControl;a.modControl=d.modControl;c.pointer=a.samplePtr=d.pointer;c.length=a.sampleLen=d.length;if(a.adsrControl){e=128+f[d.adsrTable]>>2;if(a.volumeDef)a.volume=d.volume,a.volumeDef=0;c.volume=e*a.volume>>6}else c.volume=a.volumeDef?d.volume:a.volume;if(a.egControl||a.fxControl||a.modControl){a.synthPtr=d.pointer;b=a.index<<5;g=a.synthPtr+32;for(h=a.synthPtr;h<g;++h)this.buffer[b++]=f[h]}}else a.synth=a.lfoControl=0,0>d.pointer?(a.samplePtr=this.mixer.loopPtr,a.sampleLen=2):(c.pointer=d.pointer,c.volume=a.volumeDef?d.volume:a.volume,2!=d.repeat?(a.samplePtr=d.loopPtr,c.length=a.sampleLen=d.repeat):(a.samplePtr=this.mixer.loopPtr,a.sampleLen=2,c.length=d.length));c.enabled=a.enabled=1}a=a.next}}}},createSample:{value:function(){var c=this.mixer.createSample();Object.defineProperties(c,{synth:{value:0,writable:!0},table:{value:0,writable:!0},adsrControl:{value:0,writable:!0},adsrTable:{value:0,writable:!0},adsrLen:{value:0,writable:!0},adsrSpeed:{value:0,writable:!0},lfoControl:{value:0,writable:!0},lfoTable:{value:0,writable:!0},lfoDepth:{value:0,writable:!0},lfoLen:{value:0,writable:!0},lfoDelay:{value:0,writable:!0},lfoSpeed:{value:0,writable:!0},egControl:{value:0,writable:!0},egTable:{value:0,writable:!0},egLen:{value:0,writable:!0},egDelay:{value:0,writable:!0},egSpeed:{value:0,writable:!0},fxControl:{value:0,writable:!0},fxDelay:{value:0,writable:!0},fxSpeed:{value:0,writable:!0},modControl:{value:0,writable:!0},modTable:{value:0,writable:!0},modLen:{value:0,writable:!0},modDelay:{value:0,writable:!0},modSpeed:{value:0,writable:!0}});return c}},createStep:{value:function(){return Object.create(null,{pattern:{value:0,writable:!0},soundTranspose:{value:0,writable:!0},transpose:{value:0,writable:!0}})}}});
			i.buffer=new Int32Array(128);
			i.voices[0]=k(0);i.voices[0].next=i.voices[1]=k(1);
			i.voices[1].next=i.voices[2]=k(2);i.voices[2].next=
			i.voices[3]=k(3);
			return Object.seal(i)
			
		}
		var m=1,n=2,j=3,l=[6848,6464,6080,5760,5440,5120,4832,4576,4320,4064,3840,3616,3424,3232,3040,2880,2720,2560,2416,2288,2160,2032,1920,1808,1712,1616,1520,1440,1360,1280,1208,1144,1080,1016,960,904,856,808,760,720,680,640,604,572,540,508,480,452,428,404,380,360,340,320,302,286,270,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,76,72,68,64,60,57],o=[0,64,128,64,0,-64,-128,-64]
	})();
	
	(function(){
		function h(f){
			return Object.create(null,{index:{value:f,writable:!0},next:{value:null,writable:!0},sample:{value:null,writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},status:{value:0,writable:!0},timer:{value:0,writable:!0},step:{value:null,writable:!0},row:{value:null,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},arpeggioPos:{value:0,writable:!0},pitchBend:{value:0,writable:!0},tableCtr:{value:0,writable:!0},tablePos:{value:0,writable:!0},vibratoCtr:{value:0,writable:!0},vibratoDir:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoPeriod:{value:0,writable:!0},volume:{value:0,writable:!0},attackCtr:{value:0,writable:!0},decayCtr:{value:0,writable:!0},releaseCtr:{value:0,writable:!0},sustain:{value:0,writable:!0},initialize:{value:function(){this.sample=null;this.status=this.patternPos=this.trackPos=0;this.timer=1;this.row=this.step=null;this.releaseCtr=this.decayCtr=this.attackCtr=this.volume=this.vibratoPeriod=this.vibratoPos=this.vibratoDir=this.vibratoCtr=this.tablePos=this.tableCtr=this.pitchBend=this.arpeggioPos=this.period=this.note=0;this.sustain=1}}})
		}
		window.neoart.createD1Player=function(f){
			f=createAmigaPlayer(f);
			Object.defineProperties(f,{id:{value:"STPlayer"},pointers:{value:null,writable:!0},tracks:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},voices:{value:[],writable:!0},initialize:{value:function(){var d=this.voices[0];this.core_initialize();for(this.timer=6;d;)d.initialize(),d.channel=this.mixer.channels[d.index],d.sample=this.samples[20],d=d.next}},loader:{value:function(d){var g,b,c,a=0,f,e,h;if("ALL "==d.readString(4)){g=new Int32Array(25);for(b=0;25>b;++b)g[b]=d.readUnsignedInt();this.pointers=new Int32Array(4);for(b=1;4>b;++b)this.pointers[b]=this.pointers[a]+(g[a++]>>1)-1;f=this.pointers[3]+(g[3]>>1)-1;this.tracks=[];this.tracks.length=f;c=104+g[1]-2;d.position=104;a=1;for(b=0;b<f;++b)e=this.createStep(),h=d.readUnsignedShort(),65535==h||d.position==c?(e.pattern=-1,e.transpose=d.readUnsignedShort(),c+=g[a++]):(d.position--,e.pattern=(h>>2&16320)>>2,e.transpose=d.readByte()),this.tracks[b]=e;f=g[4]>>2;this.patterns=[];this.patterns.length=f;for(b=0;b<f;++b)c=this.mixer.createRow(),c.sample=d.readUnsignedByte(),c.note=d.readUnsignedByte(),c.effect=d.readUnsignedByte()&31,c.param=d.readUnsignedByte(),this.patterns[b]=c;c=5;for(b=0;20>b;++b){this.samples[b]=null;if(0!=g[c]){e=this.createSample();e.attackStep=d.readUnsignedByte();e.attackDelay=d.readUnsignedByte();e.decayStep=d.readUnsignedByte();e.decayDelay=d.readUnsignedByte();e.sustain=d.readUnsignedShort();e.releaseStep=d.readUnsignedByte();e.releaseDelay=d.readUnsignedByte();e.volume=d.readUnsignedByte();e.vibratoWait=d.readUnsignedByte();e.vibratoStep=d.readUnsignedByte();e.vibratoLen=d.readUnsignedByte();e.pitchBend=d.readByte();e.portamento=d.readUnsignedByte();e.synth=d.readUnsignedByte();e.tableDelay=d.readUnsignedByte();for(a=0;8>a;++a)e.arpeggio[a]=d.readByte();e.length=d.readUnsignedShort();e.loop=d.readUnsignedShort();e.repeat=d.readUnsignedShort()<<1;e.synth=e.synth?0:1;if(e.synth){for(a=0;48>a;++a)e.table[a]=d.readByte();f=g[c]-78}else f=e.length;e.pointer=this.mixer.store(d,f);e.loopPtr=e.pointer+e.loop;this.samples[b]=e}c++}e=this.createSample();e.pointer=e.loopPtr=this.mixer.memory.length;e.length=e.repeat=2;this.samples[20]=e;this.version=1}}},process:{value:function(){for(var d,f,b,c,a=this.voices[0];a;){f=a.channel;if(0==--a.timer){a.timer=this.timer;if(0==a.patternPos){a.step=this.tracks[this.pointers[a.index]+a.trackPos];if(0>a.step.pattern)a.trackPos=a.step.transpose,a.step=this.tracks[this.pointers[a.index]+a.trackPos];a.trackPos++}b=this.patterns[a.step.pattern+a.patternPos];if(b.effect)a.row=b;if(b.note){f.enabled=0;a.row=b;a.note=b.note+a.step.transpose;a.arpeggioPos=a.pitchBend=a.status=0;c=a.sample=this.samples[b.sample];if(!c.synth)f.pointer=c.pointer;f.length=c.length;a.tableCtr=a.tablePos=0;a.vibratoCtr=c.vibratoWait;a.vibratoPos=c.vibratoLen;a.vibratoDir=c.vibratoLen<<1;a.volume=a.attackCtr=a.decayCtr=a.releaseCtr=0;a.sustain=c.sustain}if(16==++a.patternPos)a.patternPos=0}c=a.sample;if(c.synth)if(0==a.tableCtr){a.tableCtr=c.tableDelay;do{d=1;if(48<=a.tablePos)a.tablePos=0;b=c.table[a.tablePos];a.tablePos++;0<=b?(f.pointer=c.pointer+(b<<5),d=0):-1!=b?c.tableDelay=b&127:a.tablePos=c.table[a.tablePos]}while(d)}else a.tableCtr--;if(c.portamento)if(b=i[a.note]+a.pitchBend,0!=a.period)if(a.period<b){if(a.period+=c.portamento,a.period>b)a.period=b}else{if(a.period-=c.portamento,a.period<b)a.period=b}else a.period=b;0==a.vibratoCtr?(a.vibratoPeriod=a.vibratoPos*c.vibratoStep,0==(a.status&1)?(a.vibratoPos++,a.vibratoPos==a.vibratoDir&&(a.status^=1)):(a.vibratoPos--,0==a.vibratoPos&&(a.status^=1))):a.vibratoCtr--;a.pitchBend=0>c.pitchBend?a.pitchBend+c.pitchBend:a.pitchBend-c.pitchBend;if(a.row)switch(b=a.row,b.effect){case 1:if(b=b.param&15)this.timer=b;break;case 2:a.pitchBend-=b.param;break;case 3:a.pitchBend+=b.param;break;case 4:this.mixer.filter.active=b.param;break;case 5:c.vibratoWait=b.param;break;case 6:c.vibratoStep=b.param;case 7:c.vibratoLen=b.param;break;case 8:c.pitchBend=b.param;break;case 9:c.portamento=b.param;break;case 10:c.volume=64;break;case 11:c.arpeggio[0]=b.param;break;case 12:c.arpeggio[1]=b.param;break;case 13:c.arpeggio[2]=b.param;break;case 14:c.arpeggio[3]=b.param;break;case 15:c.arpeggio[4]=b.param;break;case 16:c.arpeggio[5]=b.param;break;case 17:c.arpeggio[6]=b.param;break;case 18:c.arpeggio[7]=b.param;break;case 19:c.arpeggio[0]=c.arpeggio[4]=b.param;break;case 20:c.arpeggio[1]=c.arpeggio[5]=b.param;break;case 21:c.arpeggio[2]=c.arpeggio[6]=b.param;break;case 22:c.arpeggio[3]=c.arpeggio[7]=b.param;break;case 23:b=b.param;64<b&&(b=64);c.attackStep=b;break;case 24:c.attackDelay=b.param;break;case 25:b=b.param;64<b&&(b=64);c.decayStep=b;break;case 26:c.decayDelay=b.param;break;case 27:c.sustain=b.param&c.sustain&255;break;case 28:c.sustain=(c.sustain&65280)+b.param;break;case 29:b=b.param;64<b&&(b=64);c.releaseStep=b;break;case 30:c.releaseDelay=b.param}c.portamento?b=a.period:(b=i[a.note+c.arpeggio[a.arpeggioPos]],a.arpeggioPos=++a.arpeggioPos&7,b-=c.vibratoLen*c.vibratoStep,b+=a.pitchBend,a.period=0);f.period=b+a.vibratoPeriod;d=a.status&14;b=a.volume;if(0==d)0==a.attackCtr?(a.attackCtr=c.attackDelay,b+=c.attackStep,64<=b&&(d|=2,a.status|=2,b=64)):a.attackCtr--;if(2==d)if(0==a.decayCtr){if(a.decayCtr=c.decayDelay,b-=c.decayStep,b<=c.volume)d|=6,a.status|=6,b=c.volume}else a.decayCtr--;6==d&&(0==a.sustain?(d|=14,a.sustain|=14):a.sustain--);if(14==d)0==a.releaseCtr?(a.releaseCtr=c.releaseDelay,b-=c.releaseStep,0>b&&(a.status&=9,b=0)):a.releaseCtr--;f.volume=a.volume=b;f.enabled=1;if(!c.synth)c.loop?(f.pointer=c.loopPtr,f.length=c.repeat):(f.pointer=this.mixer.loopPtr,f.length=2);a=a.next}}},createSample:{value:function(){var d=this.mixer.createSample();Object.defineProperties(d,{synth:{value:0,writable:!0},attackStep:{value:0,writable:!0},attackDelay:{value:0,writable:!0},decayStep:{value:0,writable:!0},decayDelay:{value:0,writable:!0},releaseStep:{value:0,writable:!0},releaseDelay:{value:0,writable:!0},sustain:{value:0,writable:!0},arpeggio:{value:null,writable:!0},pitchBend:{value:0,writable:!0},portamento:{value:0,writable:!0},table:{value:null,writable:!0},tableDelay:{value:0,writable:!0},vibratoWait:{value:0,writable:!0},vibratoStep:{value:0,writable:!0},vibratoLen:{value:0,writable:!0}});d.arpeggio=new Int32Array(8);d.table=new Int32Array(48);return d}},createStep:{value:function(){return Object.create(null,{pattern:{value:0,writable:!0},transpose:{value:0,writable:!0}})}}});
			f.voices[0]=h(0);
			f.voices[0].next=f.voices[1]=h(1);
			f.voices[1].next=f.voices[2]=h(2);
			f.voices[2].next=f.voices[3]=h(3);
			return Object.seal(f)
		}
		var i=[0,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,960,904,856,808,762,720,678,640,604,570,538,508,480,452,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113]
	})();
	
	(function(){
		function h(g){
			return Object.create(null,{index:{value:g,writable:!0},next:{value:null,writable:!0},sample:{value:null,writable:!0},trackPtr:{value:0,writable:!0},trackPos:{value:0,writable:!0},trackLen:{value:0,writable:!0},patternPos:{value:0,writable:!0},restart:{value:0,writable:!0},step:{value:null,writable:!0},row:{value:null,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},finalPeriod:{value:0,writable:!0},arpeggioPtr:{value:0,writable:!0},arpeggioPos:{value:0,writable:!0},pitchBend:{value:0,writable:!0},portamento:{value:0,writable:!0},tableCtr:{value:0,writable:!0},tablePos:{value:0,writable:!0},vibratoCtr:{value:0,writable:!0},vibratoDir:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoPeriod:{value:0,writable:!0},vibratoSustain:{value:0,writable:!0},volume:{value:0,writable:!0},volumeMax:{value:0,writable:!0},volumePos:{value:0,writable:!0},volumeSustain:{value:0,writable:!0},initialize:{value:function(){this.sample=null;this.restart=this.patternPos=this.trackLen=this.trackPos=this.trackPtr=0;this.row=this.step=null;this.volume=this.vibratoSustain=this.vibratoPeriod=this.vibratoPos=this.vibratoDir=this.vibratoCtr=this.tablePos=this.tableCtr=this.portamento=this.pitchBend=this.arpeggioPos=this.arpeggioPtr=this.finalPeriod=this.period=this.note=0;this.volumeMax=63;this.volumeSustain=this.volumePos=0}}})
		}
		window.neoart.createD2Player=function(g){
			g=createAmigaPlayer(g);
			Object.defineProperties(g,{id:{value:"D2Player"},tracks:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},data:{value:[],writable:!0},arpeggios:{value:null,writable:!0},voices:{value:[],writable:!0},noise:{value:0,writable:!0},initialize:{value:function(){var c=this.voices[0];this.core_initialize();this.timer=5;this.tick=1;for(this.noise=0;c;)c.initialize(),c.channel=this.mixer.channels[c.index],c.sample=this.samples[this.samples.length-1],c.trackPtr=this.data[c.index],c.restart=this.data[c.index+4],c.trackLen=this.data[c.index+8],c=c.next}},loader:{value:function(c){var d,b,e=0,a,g,f;c.position=3014;if(".FNL"==c.readString(4)){c.position=4042;this.data=new Int32Array(12);for(d=0;4>d;++d)this.data[d+4]=c.readUnsignedShort(),f=c.readUnsignedShort()>>1,this.data[d+8]=f,e+=f;f=e;for(d=3;0<d;--d)this.data[d]=f-=this.data[d+8];this.tracks=[];this.tracks.length=e;for(d=0;d<e;++d)b=this.createStep(),b.pattern=c.readUnsignedByte()<<4,b.transpose=c.readByte(),this.tracks[d]=b;e=c.readUnsignedInt()>>2;this.patterns=[];this.patterns.length=e;for(d=0;d<e;++d)b=this.mixer.createRow(),b.note=c.readUnsignedByte(),b.sample=c.readUnsignedByte(),b.effect=c.readUnsignedByte()-1,b.param=c.readUnsignedByte(),this.patterns[d]=b;c.position+=254;f=c.readUnsignedShort();g=c.position;c.position-=256;e=1;a=new Int32Array(128);for(d=0;128>d;++d)b=c.readUnsignedShort(),b!=f&&(a[e++]=b);this.samples=[];this.samples.length=e;for(d=0;d<e;++d){c.position=g+a[d];f=this.createSample();f.length=c.readUnsignedShort()<<1;f.loop=c.readUnsignedShort();f.repeat=c.readUnsignedShort()<<1;for(b=0;15>b;++b)f.volumes[b]=c.readUnsignedByte();for(b=0;15>b;++b)f.vibratos[b]=c.readUnsignedByte();f.pitchBend=c.readUnsignedShort();f.synth=c.readByte();f.index=c.readUnsignedByte();for(b=0;48>b;++b)f.table[b]=c.readUnsignedByte();this.samples[d]=f}e=c.readUnsignedInt();this.mixer.store(c,e);c.position+=64;for(d=0;8>d;++d)a[d]=c.readUnsignedInt();e=this.samples.length;g=c.position;for(d=0;d<e;++d)if(f=this.samples[d],!(0<=f.synth))c.position=g+a[f.index],f.pointer=this.mixer.store(c,f.length),f.loopPtr=f.pointer+f.loop;c.position=3018;for(d=0;1024>d;++d)this.arpeggios[d]=c.readByte();f=this.createSample();f.pointer=f.loopPtr=this.mixer.memory.length;f.length=f.repeat=2;this.samples[e]=f;this.version=1}}},process:{value:function(){var c;c=0;for(var d,b,e,a=this.voices[0];64>c;)this.noise=this.noise<<7|this.noise>>>25,this.noise+=1858762093,this.noise^=2656676139,b=this.noise>>>24&255,127<b&&(b|=-256),this.mixer.memory[c++]=b,b=this.noise>>>16&255,127<b&&(b|=-256),this.mixer.memory[c++]=b,b=this.noise>>>8&255,127<b&&(b|=-256),this.mixer.memory[c++]=b,b=this.noise&255,127<b&&(b|=-256),this.mixer.memory[c++]=b;if(0>--this.tick)this.tick=this.timer;for(;a;){if(!(1>a.trackLen)){c=a.channel;e=a.sample;if(e.synth)c.pointer=e.loopPtr,c.length=e.repeat;if(0==this.tick){if(0==a.patternPos&&(a.step=this.tracks[a.trackPtr+a.trackPos],++a.trackPos==a.trackLen))a.trackPos=a.restart;b=a.row=this.patterns[a.step.pattern+a.patternPos];if(b.note){c.enabled=0;a.note=b.note;a.period=i[b.note+a.step.transpose];e=a.sample=this.samples[b.sample];if(0>e.synth)c.pointer=e.pointer,c.length=e.length;a.arpeggioPos=0;a.tableCtr=0;a.tablePos=0;a.vibratoCtr=e.vibratos[1];a.vibratoPos=0;a.vibratoDir=0;a.vibratoPeriod=0;a.vibratoSustain=e.vibratos[2];a.volume=0;a.volumePos=0;a.volumeSustain=0}switch(b.effect){case 0:this.timer=b.param&15;break;case 1:this.mixer.filter.active=b.param;break;case 2:a.pitchBend=~(b.param&255)+1;break;case 3:a.pitchBend=b.param&255;break;case 4:a.portamento=b.param;break;case 5:a.volumeMax=b.param&63;break;case 6:this.mixer.volume=b.param;break;case 7:a.arpeggioPtr=(b.param&63)<<4}a.patternPos=++a.patternPos&15}e=a.sample;if(0<=e.synth)if(a.tableCtr)a.tableCtr--;else{a.tableCtr=e.index;b=e.table[a.tablePos];if(255==b&&(b=e.table[++a.tablePos],255!=b))a.tablePos=b,b=e.table[a.tablePos];if(255!=b&&(c.pointer=b<<8,c.length=e.length,47<++a.tablePos))a.tablePos=0}b=e.vibratos[a.vibratoPos];a.vibratoPeriod=a.vibratoDir?a.vibratoPeriod-b:a.vibratoPeriod+b;if(0==--a.vibratoCtr)a.vibratoCtr=e.vibratos[a.vibratoPos+1],a.vibratoDir=~a.vibratoDir;if(a.vibratoSustain)a.vibratoSustain--;else{a.vibratoPos+=3;if(15==a.vibratoPos)a.vibratoPos=12;a.vibratoSustain=e.vibratos[a.vibratoPos+2]}if(a.volumeSustain)a.volumeSustain--;else if(b=e.volumes[a.volumePos],d=e.volumes[a.volumePos+1],d<a.volume){if(a.volume-=b,a.volume<d)a.volume=d,a.volumePos+=3,a.volumeSustain=e.volumes[a.volumePos-1]}else if(a.volume+=b,a.volume>d){a.volume=d;a.volumePos+=3;if(15==a.volumePos)a.volumePos=12;a.volumeSustain=e.volumes[a.volumePos-1]}if(a.portamento)if(a.period<a.finalPeriod){if(a.finalPeriod-=a.portamento,a.finalPeriod<a.period)a.finalPeriod=a.period}else if(a.finalPeriod+=a.portamento,a.finalPeriod>a.period)a.finalPeriod=a.period;b=this.arpeggios[a.arpeggioPtr+a.arpeggioPos];if(-128==b)a.arpeggioPos=0,b=this.arpeggios[a.arpeggioPtr];a.arpeggioPos=++a.arpeggioPos&15;if(0==a.portamento)b=a.note+a.step.transpose+b,0>b&&(b=0),a.finalPeriod=i[b];a.vibratoPeriod-=e.pitchBend-a.pitchBend;c.period=a.finalPeriod+a.vibratoPeriod;b=a.volume>>2&63;if(b>a.volumeMax)b=a.volumeMax;c.volume=b;c.enabled=1}a=a.next}}},createSample:{value:function(){var c=this.mixer.createSample();Object.defineProperties(c,{index:{value:0,writable:!0},pitchBend:{value:0,writable:!0},synth:{value:0,writable:!0},table:{value:null,writable:!0},vibratos:{value:null,writable:!0},volumes:{value:null,writable:!0}});c.table=new Int32Array(48);c.vibratos=new Int32Array(15);c.volumes=new Int32Array(15);return c}},createStep:{value:function(){return Object.create(null,{pattern:{value:0,writable:!0},transpose:{value:0,writable:!0}})}}});
			g.arpeggios=new Int32Array(1024);
			g.voices[0]=h(0);
			g.voices[0].next=g.voices[1]=h(1);
			g.voices[1].next=g.voices[2]=h(2);
			g.voices[2].next=g.voices[3]=h(3);
			return Object.seal(g)
		}
		var i=[0,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,904,856,808,762,720,678,640,604,570,538,508,480,452,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113]
	})();
	
	(function(){
		function z(){
			return Object.create(null,{value:{value:0,writable:!0},position:{value:0,writable:!0},frame:{value:0,writable:!0},delta:{value:0,writable:!0},fraction:{value:0,writable:!0},stopped:{value:0,writable:!0},reset:{value:function(){this.stopped=this.fraction=this.delta=this.frame=this.position=this.value=0}}})
		}
		function O(j){j=Object.create(null,{index:{value:j,writable:!0},next:{value:null,writable:!0},flags:{value:0,writable:!0},delay:{value:0,writable:!0},channel:{value:null,writable:!0},patternLoop:{value:0,writable:!0},patternLoopRow:{value:0,writable:!0},playing:{value:null,writable:!0},note:{value:0,writable:!0},keyoff:{value:0,writable:!0},period:{value:0,writable:!0},finetune:{value:0,writable:!0},arpDelta:{value:0,writable:!0},vibDelta:{value:0,writable:!0},instrument:{value:null,writable:!0},autoVibratoPos:{value:0,writable:!0},autoSweep:{value:0,writable:!0},autoSweepPos:{value:0,writable:!0},sample:{value:null,writable:!0},sampleOffset:{value:0,writable:!0},volume:{value:0,writable:!0},volEnabled:{value:0,writable:!0},volEnvelope:{value:null,writable:!0},volDelta:{value:0,writable:!0},volSlide:{value:0,writable:!0},volSlideMaster:{value:0,writable:!0},fineSlideU:{value:0,writable:!0},fineSlideD:{value:0,writable:!0},fadeEnabled:{value:0,writable:!0},fadeDelta:{value:0,writable:!0},fadeVolume:{value:0,writable:!0},panning:{value:0,writable:!0},panEnabled:{value:0,writable:!0},panEnvelope:{value:null,writable:!0},panSlide:{value:0,writable:!0},portaU:{value:0,writable:!0},portaD:{value:0,writable:!0},finePortaU:{value:0,writable:!0},finePortaD:{value:0,writable:!0},xtraPortaU:{value:0,writable:!0},xtraPortaD:{value:0,writable:!0},portaPeriod:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},glissando:{value:0,writable:!0},glissPeriod:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},vibratoReset:{value:0,writable:!0},tremoloPos:{value:0,writable:!0},tremoloSpeed:{value:0,writable:!0},tremoloDepth:{value:0,writable:!0},waveControl:{value:0,writable:!0},tremorPos:{value:0,writable:!0},tremorOn:{value:0,writable:!0},tremorOff:{value:0,writable:!0},tremorVolume:{value:0,writable:!0},retrigx:{value:0,writable:!0},retrigy:{value:0,writable:!0},reset:{value:function(){this.volume=this.sample.volume;this.panning=this.sample.panning;this.finetune=this.sample.finetune>>3<<2;this.fadeDelta=this.fadeEnabled=this.volDelta=this.keyoff=0;this.fadeVolume=65536;this.autoVibratoPos=0;this.autoSweep=1;this.vibratoReset=this.vibDelta=this.autoSweepPos=0;if(4>(this.waveControl&15))this.vibratoPos=0;if(4>this.waveControl>>4)this.tremoloPos=0}},autoVibrato:{value:function(){var a;this.autoVibratoPos=this.autoVibratoPos+this.playing.vibratoSpeed&255;switch(this.playing.vibratoType){case 0:a=P[this.autoVibratoPos];break;case 1:a=128>this.autoVibratoPos?-64:64;break;case 2:a=(64+(this.autoVibratoPos>>1)&127)-64;break;case 3:a=(64-(this.autoVibratoPos>>1)&127)-64}a*=this.playing.vibratoDepth;if(this.autoSweep)this.playing.vibratoSweep?this.autoSweepPos>this.playing.vibratoSweep?(this.autoSweepPos&2&&(a*=this.autoSweepPos/this.playing.vibratoSweep),this.autoSweep=0):a*=++this.autoSweepPos/this.playing.vibratoSweep:this.autoSweep=0;this.flags|=m;return a>>6}},tonePortamento:{value:function(){if(!this.glissPeriod)this.glissPeriod=this.period;if(this.period<this.portaPeriod){if(this.glissPeriod+=this.portaSpeed<<2,this.period=this.glissando?Math.round(this.glissPeriod/64)<<6:this.glissPeriod,this.period>=this.portaPeriod)this.period=this.portaPeriod,this.glissPeriod=this.portaPeriod=0}else if(this.period>this.portaPeriod&&(this.glissPeriod-=this.portaSpeed<<2,this.period=this.glissando?Math.round(this.glissPeriod/64)<<6:this.glissPeriod,this.period<=this.portaPeriod))this.period=this.portaPeriod,this.glissPeriod=this.portaPeriod=0;this.flags|=m}},tremolo:{value:function(){var a=255,e=this.tremoloPos&31;switch(this.waveControl>>4&3){case 0:a=A[e];break;case 1:a=e<<3}this.volDelta=a*this.tremoloDepth>>6;if(31<this.tremoloPos)this.volDelta=-this.volDelta;this.tremoloPos=this.tremoloPos+this.tremoloSpeed&63;this.flags|=i}},tremor:{value:function(){this.tremorPos==this.tremorOn?(this.tremorVolume=this.volume,this.volume=0):(this.tremorPos=0,this.volume=this.tremorVolume);this.flags|=i;this.tremorPos++}},vibrato:{value:function(){var a=255,e=this.vibratoPos&31;switch(this.waveControl&3){case 0:a=A[e];break;case 1:a=e<<3,31<this.vibratoPos&&(a=255-a)}this.vibDelta=a*this.vibratoDepth>>7;if(31<this.vibratoPos)this.vibDelta=-this.vibDelta;this.vibratoPos=this.vibratoPos+this.vibratoSpeed&63;this.flags|=m}}});
			j.volEnvelope=z();
			j.panEnvelope=z();
			return Object.seal(j)
		}

		window.neoart.createF2Player=function(q){
			q=createSBPlayer(q);
			Object.defineProperties(q,{id:{value:"F2Player"},patterns:{value:[],writable:!0},instruments:{value:[],writable:!0},voices:{value:[],writable:!0},linear:{value:0,writable:!0},complete:{value:0,writable:!0},order:{value:0,writable:!0},position:{value:0,writable:!0},nextOrder:{value:0,writable:!0},nextPosition:{value:0,writable:!0},pattern:{value:null,writable:!0},patternDelay:{value:0,writable:!0},patternOffset:{value:0,writable:!0},initialize:{value:function(){var a=0,e;this.core_initialize();this.position=this.order=0;this.nextPosition=this.nextOrder=-1;this.complete=this.patternOffset=this.patternDelay=0;this.master=64;this.voices=[];for(this.voices.length=this.channels;a<this.channels;++a)if(e=O(a),e.channel=this.mixer.channels[a],e.playing=this.instruments[0],e.sample=e.playing.samples[0],this.voices[a]=e,a)this.voices[a-1].next=e}},loader:{value:function(a){var e,d,h,f,c,i,g,b=22,j,k;if(!(360>a.length)){a.position=17;this.title=a.readString(20);a.position++;"Sk@le Tracker"==a.readString(20)&&(b=2);this.version=a.readUnsignedShort();e=a.readUnsignedInt();this.length=a.readUnsignedShort();this.restart=a.readUnsignedShort();this.channels=a.readUnsignedShort();k=j=a.readUnsignedShort();this.instruments=[];this.instruments.length=a.readUnsignedShort()+1;this.linear=a.readUnsignedShort();this.speed=a.readUnsignedShort();this.tempo=a.readUnsignedShort();this.track=new Uint8Array(this.length);for(d=0;d<this.length;++d)h=a.readUnsignedByte(),h>k&&(j=h+1),this.track[d]=h;this.patterns=[];this.patterns.length=j;if(j!=k){f=this.createPattern(64,this.channels);h=f.size;for(d=0;d<h;++d)f.rows[d]=this.createRow();this.patterns[--j]=f}a.position=g=e+60;i=k;for(d=0;d<i;++d){e=a.readUnsignedInt();a.position++;f=this.createPattern(a.readUnsignedShort(),this.channels);j=f.size;k=a.readUnsignedShort();a.position=g+e;c=a.position+k;if(k)for(h=0;h<j;++h){e=this.createRow();k=a.readUnsignedByte();if(k&128){if(k&1)e.note=a.readUnsignedByte();if(k&2)e.instrument=a.readUnsignedByte();if(k&4)e.volume=a.readUnsignedByte();if(k&8)e.effect=a.readUnsignedByte();if(k&16)e.param=a.readUnsignedByte()}else e.note=k,e.instrument=a.readUnsignedByte(),e.volume=a.readUnsignedByte(),e.effect=a.readUnsignedByte(),e.param=a.readUnsignedByte();if(e.note!=s&&96<e.note)e.note=0;f.rows[h]=e}else for(h=0;h<j;++h)f.rows[h]=this.createRow();this.patterns[d]=f;g=a.position;if(g!=c)g=a.position=c}c=a.position;i=this.instruments.length;for(d=1;d<i;++d){h=a.readUnsignedInt();if(a.position+h>=a.length)break;f=this.createInstrument();f.name=a.readString(22);a.position++;k=a.readUnsignedShort();16<k&&(k=16);e=a.readUnsignedInt();2==b&&64!=e&&(e=64);if(k){f.samples=[];f.samples.length=k;for(h=0;96>h;++h)f.noteSamples[h]=a.readUnsignedByte();for(h=0;12>h;++h)f.volData.points[h]=this.createPoint(a.readUnsignedShort(),a.readUnsignedShort());for(h=0;12>h;++h)f.panData.points[h]=this.createPoint(a.readUnsignedShort(),a.readUnsignedShort());f.volData.total=a.readUnsignedByte();f.panData.total=a.readUnsignedByte();f.volData.sustain=a.readUnsignedByte();f.volData.loopStart=a.readUnsignedByte();f.volData.loopEnd=a.readUnsignedByte();f.panData.sustain=a.readUnsignedByte();f.panData.loopStart=a.readUnsignedByte();f.panData.loopEnd=a.readUnsignedByte();f.volData.flags=a.readUnsignedByte();f.panData.flags=a.readUnsignedByte();if(f.volData.flags&B)f.volEnabled=1;if(f.panData.flags&B)f.panEnabled=1;f.vibratoType=a.readUnsignedByte();f.vibratoSweep=a.readUnsignedByte();f.vibratoDepth=a.readUnsignedByte();f.vibratoSpeed=a.readUnsignedByte();f.fadeout=a.readUnsignedShort()<<1;a.position+=b;g=a.position;this.instruments[d]=f;for(h=0;h<k;++h)c=this.mixer.createSample(),c.length=a.readUnsignedInt(),c.loopStart=a.readUnsignedInt(),c.loopLen=a.readUnsignedInt(),c.volume=a.readUnsignedByte(),c.finetune=a.readByte(),c.loopMode=a.readUnsignedByte(),c.panning=a.readUnsignedByte(),c.relative=a.readByte(),a.position++,c.name=a.readString(22),f.samples[h]=c,a.position=g+=e;for(h=0;h<k;++h)if(c=f.samples[h],c.length){g=a.position+c.length;if(c.loopMode&16)c.bits=16,c.loopMode^=16,c.length>>=1,c.loopStart>>=1,c.loopLen>>=1;if(!c.loopLen)c.loopMode=0;c.store(a);if(c.loopMode)c.length=c.loopStart+c.loopLen;a.position=g}}else a.position=c+h;c=a.position;if(c>=a.length)break}f=this.createInstrument();f.name="Flod";f.volData=this.createData();f.panData=this.createData();f.samples=[];for(d=0;12>d;++d)f.volData.points[d]=this.createPoint(),f.panData.points[d]=this.createPoint();c=this.mixer.createSample();c.length=220;c.data=new Float32Array(220);for(d=0;220>d;++d)c.data[d]=0;f.samples[0]=c;this.instruments[0]=f}}},process:{value:function(){var a,e,d,h,f,c,l,g,b=this.voices[0];if(this.tick)for(;b;){c=this.pattern.rows[this.position+b.index];if(b.delay)if((c.param&15)==this.tick)b.flags=b.delay,b.delay=0;else{b=b.next;continue}if(c.volume)switch(e=c.volume>>4,d=c.volume&15,e){case Q:b.volume-=d;if(0>b.volume)b.volume=0;b.flags|=i;break;case R:b.volume+=d;if(64<b.volume)b.volume=64;b.flags|=i;break;case C:b.vibrato();break;case S:b.panning-=d;if(0>b.panning)b.panning=0;b.flags|=j;break;case T:b.panning+=d;if(255<b.panning)b.panning=255;b.flags|=j;break;case r:b.portaPeriod&&b.tonePortamento()}e=c.param>>4;d=c.param&15;switch(c.effect){case U:if(!c.param)break;g=(this.tick-this.timer)%3;0>g&&(g+=3);2==this.tick&&18==this.timer&&(g=0);g?1==g?this.linear?b.arpDelta=-(d<<6):(g=this.amiga(b.note+d,b.finetune),b.arpDelta=g-b.period):this.linear?b.arpDelta=-(e<<6):(g=this.amiga(b.note+e,b.finetune),b.arpDelta=g-b.period):b.arpDelta=0;b.flags|=m;break;case D:b.period-=b.portaU;if(0>b.period)b.period=0;b.flags|=m;break;case E:b.period+=b.portaD;if(9212<b.period)b.period=9212;b.flags|=m;break;case t:b.portaPeriod&&b.tonePortamento();break;case u:if(e)b.vibratoSpeed=e;if(d)b.vibratoDepth=d<<2;b.vibrato();break;case v:f=1;b.portaPeriod&&b.tonePortamento();break;case w:f=1;b.vibrato();break;case F:b.tremolo();break;case G:f=1;break;case x:switch(e){case V:if(this.tick==d)b.volume=0,b.flags|=i;break;case W:0==this.tick%d&&(b.volEnvelope.reset(),b.panEnvelope.reset(),b.flags|=i|j|o)}break;case H:e=b.volSlideMaster>>4;d=b.volSlideMaster&15;if(e){this.master+=e;if(64<this.master)this.master=64;b.flags|=i}else if(d){this.master-=d;if(0>this.master)this.master=0;b.flags|=i}break;case I:if(this.tick==c.param)b.fadeEnabled=1,b.keyoff=1;break;case J:e=b.panSlide>>4;d=b.panSlide&15;if(e){b.panning+=e;if(255<b.panning)b.panning=255;b.flags|=j}else if(d){b.panning-=d;if(0>b.panning)b.panning=0;b.flags|=j}break;case K:a=this.tick;c.volume||a++;if(a%b.retrigy)break;(!c.volume||80<c.volume)&&b.retrigx&&this.retrig(b);b.flags|=o;break;case L:b.tremor()}f&&(e=b.volSlide>>4,d=b.volSlide&15,f=0,e?(b.volume+=e,b.flags|=i):d&&(b.volume-=d,b.flags|=i));b=b.next}else{if(0<=this.nextOrder)this.order=this.nextOrder;if(0<=this.nextPosition)this.position=this.nextPosition;this.nextOrder=this.nextPosition=-1;for(this.pattern=this.patterns[this.track[this.order]];b;){c=this.pattern.rows[this.position+b.index];a=c.volume>>4;f=c.effect==t||c.effect==v||a==r;e=c.param>>4;b.keyoff=0;if(b.arpDelta)b.arpDelta=0,b.flags|=m;if(c.instrument)b.instrument=c.instrument<this.instruments.length?this.instruments[c.instrument]:null,b.volEnvelope.reset(),b.panEnvelope.reset(),b.flags|=i|j|n;else if(c.note==s||c.effect==I&&!c.param)b.fadeEnabled=1,b.keyoff=1;if(c.note&&c.note!=s)if(b.instrument){if(d=b.instrument,g=c.note-1,l=d.samples[d.noteSamples[g]],g+=l.relative,g>=X&&g<=Y){if(!f)b.note=g,b.sample=l,c.instrument?(b.volEnabled=d.volEnabled,b.panEnabled=d.panEnabled,b.flags|=Z):b.flags|=m|o;c.instrument?(b.reset(),b.fadeDelta=d.fadeout):b.finetune=l.finetune>>3<<2;if(c.effect==x&&e==$)b.finetune=(c.param&15)-8<<3;g=this.linear?(120-g<<6)-b.finetune:this.amiga(g,b.finetune);f?b.portaPeriod=g:(b.period=g,b.glissPeriod=0)}}else this.volume=0,b.flags=i|n;else if(b.vibratoReset&&c.effect!=u&&c.effect!=w)b.vibDelta=0,b.vibratoReset=0,b.flags|=m;if(c.volume)if(16<=c.volume&&80>=c.volume)b.volume=c.volume-16,b.flags|=i|n;else switch(d=c.volume&15,a){case aa:b.volume-=d;if(0>b.volume)b.volume=0;b.flags|=i;break;case ba:b.volume+=d;if(64<b.volume)b.volume=64;b.flags|=i;break;case ca:if(d)b.vibratoSpeed=d;break;case C:if(d)b.vibratoDepth=d<<2;break;case da:b.panning=d<<4;b.flags|=j;break;case r:if(d)b.portaSpeed=d<<4}if(c.effect)switch(d=c.param&15,c.effect){case D:if(c.param)b.portaU=c.param<<2;break;case E:if(c.param)b.portaD=c.param<<2;break;case t:if(c.param&&a!=r)b.portaSpeed=c.param;break;case u:b.vibratoReset=1;break;case v:if(c.param)b.volSlide=c.param;break;case w:if(c.param)b.volSlide=c.param;b.vibratoReset=1;break;case F:if(e)b.tremoloSpeed=e;if(d)b.tremoloDepth=d;break;case ea:b.panning=c.param;b.flags|=j;break;case fa:if(c.param)b.sampleOffset=c.param<<8;if(b.sampleOffset>=b.sample.length)b.volume=0,b.sampleOffset=0,b.flags&=~(m|o),b.flags|=i|n;break;case G:if(c.param)b.volSlide=c.param;break;case ga:this.nextOrder=c.param;this.nextOrder>=this.length?this.complete=1:this.nextPosition=0;h=1;this.patternOffset=0;break;case ha:b.volume=c.param;b.flags|=i|n;break;case ia:this.nextPosition=(10*e+d)*this.channels;this.patternOffset=0;if(!h&&(this.nextOrder=this.order+1,this.nextOrder>=this.length))this.complete=1,this.nextPosition=-1;break;case x:switch(e){case ja:if(d)b.finePortaU=d<<2;b.period-=b.finePortaU;b.flags|=m;break;case ka:if(d)b.finePortaD=d<<2;b.period+=b.finePortaD;b.flags|=m;break;case la:b.glissando=d;break;case ma:b.waveControl=b.waveControl&240|d;break;case na:if(d){if(b.patternLoop?b.patternLoop--:b.patternLoop=d,b.patternLoop)this.nextPosition=b.patternLoopRow}else b.patternLoopRow=this.patternOffset=this.position;break;case oa:b.waveControl=b.waveControl&15|d<<4;break;case pa:if(d)b.fineSlideU=d;b.volume+=b.fineSlideU;b.flags|=i;break;case qa:if(d)b.fineSlideD=d;b.volume-=b.fineSlideD;b.flags|=i;break;case ra:b.delay=b.flags;b.flags=0;break;case sa:this.patternDelay=d*this.timer}break;case ta:if(!c.param)break;32>c.param?this.timer=c.param:this.mixer.samplesTick=2.5*this.sampleRate/c.param>>0;break;case ua:this.master=c.param;if(64<this.master)this.master=64;b.flags|=i;break;case H:if(c.param)b.volSlideMaster=c.param;break;case J:if(c.param)b.panSlide=c.param;break;case va:if(!b.instrument||!b.instrument.volEnabled)break;d=b.instrument;g=c.param;e=d.volData.total;for(a=0;a<e&&!(g<d.volData.points[a].frame);a++);b.volEnvelope.position=--a;e--;if(d.volData.flags&M&&a==d.volData.loopEnd)a=b.volEnvelope.position=d.volData.loopStart,g=d.volData.points[a].frame,b.volEnvelope.frame=g;a>=e?(b.volEnvelope.value=d.volData.points[e].value,b.volEnvelope.stopped=1):(b.volEnvelope.stopped=0,b.volEnvelope.frame=g,g>d.volData.points[a].frame&&b.volEnvelope.position++,e=d.volData.points[a],a=d.volData.points[++a],g=a.frame-e.frame,b.volEnvelope.delta=(g?(a.value-e.value<<8)/g>>0:0)||0,b.volEnvelope.fraction=e.value<<8);break;case K:if(e)b.retrigx=e;if(d)b.retrigy=d;if(!c.volume&&b.retrigy){a=this.tick+1;if(a%b.retrigy)break;80<c.volume&&b.retrigx&&this.retrig(b)}break;case L:if(c.param)b.tremorOn=++e,b.tremorOff=++d+e;break;case wa:if(1==e){if(d)b.xtraPortaU=d;b.period-=b.xtraPortaU;b.flags|=m}else if(2==e){if(d)b.xtraPortaD=d;b.period+=b.xtraPortaD;b.flags|=m}}b=b.next}}if(++this.tick>=this.timer+this.patternDelay&&(this.patternDelay=this.tick=0,0>this.nextPosition&&(this.nextPosition=this.position+this.channels,this.nextPosition>=this.pattern.size||this.complete)))if(this.nextOrder=this.order+1,this.nextPosition=this.patternOffset,this.nextOrder>=this.length)this.nextOrder=this.restart,this.mixer.complete=1}},fast:{value:function(){for(var a,e,d,h,f,c=this.voices[0],l;c;){a=c.channel;d=c.flags;c.flags=0;if(d&o)a.index=c.sampleOffset,a.pointer=-1,a.dir=0,a.fraction=0,a.sample=c.sample,a.length=c.sample.length,a.enabled=a.sample.data?1:0,c.playing=c.instrument,c.sampleOffset=0;h=c.playing;e=h.vibratoSpeed?c.autoVibrato():0;l=c.volume+c.volDelta;if(h.volEnabled){if(c.volEnabled&&!c.volEnvelope.stopped&&this.envelope(c,c.volEnvelope,h.volData),l=l*c.volEnvelope.value>>6,d|=i,c.fadeEnabled)c.fadeVolume-=c.fadeDelta,0>c.fadeVolume?(l=0,c.fadeVolume=0,c.fadeEnabled=0,c.volEnvelope.value=0,c.volEnvelope.stopped=1,c.panEnvelope.stopped=1):l=l*c.fadeVolume>>16}else c.keyoff&&(l=0,d|=i);f=c.panning;h.panEnabled&&(c.panEnabled&&!c.panEnvelope.stopped&&this.envelope(c,c.panEnvelope,h.panData),f=c.panEnvelope.value<<2,d|=j,0>f?f=0:255<f&&(f=255));if(d&i)0>l?l=0:64<l&&(l=64),a.volume=N[l*this.master>>6],a.lvol=a.volume*a.lpan,a.rvol=a.volume*a.rpan;if(d&j)a.panning=f,a.lpan=p[256-f],a.rpan=p[f],a.lvol=a.volume*a.lpan,a.rvol=a.volume*a.rpan;if(d&m)e+=c.period+c.arpDelta+c.vibDelta,a.speed=this.linear?(548077568*Math.pow(2,(4608-e)/768)/this.sampleRate>>0)/65536:(65536*(14317456/e)/this.sampleRate>>0)/65536,a.delta=a.speed>>0,a.speed-=a.delta;c=c.next}}},accurate:{value:function(){for(var a,e,d,h,f,c,l,g=this.voices[0];g;){a=g.channel;d=g.flags;g.flags=0;if(d&o){if(a.sample&&(d|=n,a.mixCounter=220,a.oldSample=null,a.oldPointer=-1,a.enabled))a.oldDir=a.dir,a.oldFraction=a.fraction,a.oldSpeed=a.speed,a.oldSample=a.sample,a.oldPointer=a.pointer,a.oldLength=a.length,a.lmixRampD=a.lvol,a.lmixDeltaD=a.lvol/220,a.rmixRampD=a.rvol,a.rmixDeltaD=a.rvol/220;a.dir=1;a.fraction=0;a.sample=g.sample;a.pointer=g.sampleOffset;a.length=g.sample.length;a.enabled=a.sample.data?1:0;g.playing=g.instrument;g.sampleOffset=0}h=g.playing;e=h.vibratoSpeed?g.autoVibrato():0;f=g.volume+g.volDelta;if(h.volEnabled){if(g.volEnabled&&!g.volEnvelope.stopped&&this.envelope(g,g.volEnvelope,h.volData),f=f*g.volEnvelope.value>>6,d|=i,g.fadeEnabled)g.fadeVolume-=g.fadeDelta,0>g.fadeVolume?(f=0,g.fadeVolume=0,g.fadeEnabled=0,g.volEnvelope.value=0,g.volEnvelope.stopped=1,g.panEnvelope.stopped=1):f=f*g.fadeVolume>>16}else g.keyoff&&(f=0,d|=i);c=g.panning;h.panEnabled&&(g.panEnabled&&!g.panEnvelope.stopped&&this.envelope(g,g.panEnvelope,h.panData),c=g.panEnvelope.value<<2,d|=j,0>c?c=0:255<c&&(c=255));if(a.enabled){if(d&i)0>f?f=0:64<f&&(f=64),f=N[f*this.master>>6],h=f*p[256-c],l=f*p[c],f!=a.volume&&!a.mixCounter?(a.volCounter=d&n?220:this.mixer.samplesTick,a.lvolDelta=(h-a.lvol)/a.volCounter,a.rvolDelta=(l-a.rvol)/a.volCounter):(a.lvol=h,a.rvol=l),a.volume=f;if(d&j)f=p[256-c],h=p[c],c!=a.panning&&!a.mixCounter&&!a.volCounter?(a.panCounter=this.mixer.samplesTick,a.lpanDelta=(f-a.lpan)/a.panCounter,a.rpanDelta=(h-a.rpan)/a.panCounter):(a.lpan=f,a.rpan=h),a.panning=c;if(d&m)e+=g.period+g.arpDelta+g.vibDelta,a.speed=this.linear?(548077568*Math.pow(2,(4608-e)/768)/this.sampleRate>>0)/65536:(65536*(14317456/e)/this.sampleRate>>0)/65536;if(a.mixCounter)a.lmixRampU=0,a.lmixDeltaU=a.lvol/220,a.rmixRampU=0,a.rmixDeltaU=a.rvol/220}else a.volCounter=0,a.panCounter=0;g=g.next}}},envelope:{value:function(a,e,d){var h=e.position,f=d.points[h];if(e.frame==f.frame){if(d.flags&M&&h==d.loopEnd)h=e.position=d.loopStart,f=d.points[h],e.frame=f.frame;if(h==d.total-1){e.value=f.value;e.stopped=1;return}if(d.flags&xa&&h==d.sustain&&!a.fadeEnabled){e.value=f.value;return}e.position++;a=d.points[e.position];e.delta=(a.value-f.value<<8)/(a.frame-f.frame)>>0||0;e.fraction=f.value<<8}else e.fraction+=e.delta;e.value=e.fraction>>8;e.frame++}},amiga:{value:function(a,e){var d=0,h=y[++a];0>e?d=(y[--a]-h)/64:0<e&&(d=(h-y[++a])/64);return h-d*e>>0}},retrig:{value:function(a){switch(a.retrigx){case 1:a.volume--;break;case 2:a.volume++;break;case 3:a.volume-=4;break;case 4:a.volume-=8;break;case 5:a.volume-=16;break;case 6:a.volume=(a.volume<<1)/3;break;case 7:a.volume>>=1;break;case 8:a.volume=a.sample.volume;break;case 9:a.volume++;break;case 10:a.volume+=2;break;case 11:a.volume+=4;break;case 12:a.volume+=8;break;case 13:a.volume+=16;break;case 14:a.volume=3*a.volume>>1;break;case 15:a.volume<<=1}if(0>a.volume)a.volume=0;else if(64<a.volume)a.volume=64;a.flags|=i}},createData:{value:function(){return Object.create(null,{points:{value:[],writable:!0},total:{value:0,writable:!0},sustain:{value:0,writable:!0},loopStart:{value:0,writable:!0},loopEnd:{value:0,writable:!0},flags:{value:0,writable:!0}})}},createInstrument:{value:function(){var a=Object.create(null,{name:{value:"",writable:!0},samples:{value:[],writable:!0},noteSamples:{value:[],writable:!0},fadeout:{value:0,writable:!0},volData:{value:null,writable:!0},volEnabled:{value:0,writable:!0},panData:{value:null,writable:!0},panEnabled:{value:0,writable:!0},vibratoType:{value:0,writable:!0},vibratoSweep:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0}});a.noteSamples=new Uint8Array(96);a.volData=this.createData();a.panData=this.createData();return Object.seal(a)}},createPattern:{value:function(a,e){var d=Object.create(null,{rows:{value:[],writable:!0},length:{value:0,writable:!0},size:{value:0,writable:!0}});d.size=a*e;d.rows.length=d.size;d.length=a;return Object.seal(d)}},createPoint:{value:function(a,e){var d=Object.create(null,{frame:{value:0,writable:!0},value:{value:0,writable:!0}});d.frame=a||0;d.value=e||0;return Object.seal(d)}},createRow:{value:function(){return Object.create(null,{note:{value:0,writable:!0},instrument:{value:0,writable:!0},volume:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0}})}}});
			return Object.seal(q)
			
		}
		var m=1,i=2,j=4,o=8,Z=15,n=32,B=1,xa=2,M=4,X=0,Y=118,s=97,U=0,D=1,E=2,t=3,u=4,v=5,w=6,F=7,ea=8,fa=9,G=10,ga=11,ha=12,ia=13,x=14,ta=15,ua=16,H=17,I=20,va=21,J=24,K=27,L=29,wa=33,ja=1,ka=2,la=3,ma=4,$=5,na=6,oa=7,W=9,pa=10,qa=11,V=12,ra=13,sa=14,Q=6,R=7,aa=8,ba=9,ca=10,C=11,da=12,S=13,T=14,r=15,P=[0,-2,-3,-5,-6,-8,-9,-11,-12,-14,-16,-17,-19,-20,-22,-23,-24,-26,-27,-29,-30,-32,-33,-34,-36,-37,-38,-39,-41,-42,-43,-44,-45,-46,-47,-48,-49,-50,-51,-52,-53,-54,-55,-56,-56,-57,-58,-59,-59,-60,-60,-61,-61,-62,-62,-62,-63,-63,-63,-64,-64,-64,-64,-64,-64,-64,-64,-64,-64,-64,-63,-63,-63,-62,-62,-62,-61,-61,-60,-60,-59,-59,-58,-57,-56,-56,-55,-54,-53,-52,-51,-50,-49,-48,-47,-46,-45,-44,-43,-42,-41,-39,-38,-37,-36,-34,-33,-32,-30,-29,-27,-26,-24,-23,-22,-20,-19,-17,-16,-14,-12,-11,-9,-8,-6,-5,-3,-2,0,2,3,5,6,8,9,11,12,14,16,17,19,20,22,23,24,26,27,29,30,32,33,34,36,37,38,39,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,56,57,58,59,59,60,60,61,61,62,62,62,63,63,63,64,64,64,64,64,64,64,64,64,64,64,63,63,63,62,62,62,61,61,60,60,59,59,58,57,56,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,39,38,37,36,34,33,32,30,29,27,26,24,23,22,20,19,17,16,14,12,11,9,8,6,5,3,2],A=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24],p=[0,0.04417,0.062489,0.076523,0.088371,0.098821,0.108239,0.116927,0.124977,0.132572,0.139741,0.146576,0.153077,0.159335,0.16535,0.171152,0.176772,0.18221,0.187496,0.19263,0.197643,0.202503,0.207273,0.211951,0.216477,0.220943,0.225348,0.229631,0.233854,0.237985,0.242056,0.246066,0.249985,0.253873,0.25767,0.261437,0.265144,0.268819,0.272404,0.275989,0.279482,0.282976,0.286409,0.289781,0.293153,0.296464,0.299714,0.302965,0.306185,0.309344,0.312473,0.315602,0.318671,0.321708,0.324746,0.327754,0.3307,0.333647,0.336563,0.339449,0.342305,0.345161,0.347986,0.350781,0.353545,0.356279,0.359013,0.361717,0.364421,0.367094,0.369737,0.37238,0.374992,0.377574,0.380157,0.382708,0.38526,0.387782,0.390303,0.392794,0.395285,0.397746,0.400176,0.402606,0.405037,0.407437,0.409836,0.412206,0.414576,0.416915,0.419254,0.421563,0.423841,0.42618,0.428458,0.430737,0.432985,0.435263,0.437481,0.439729,0.441916,0.444134,0.446321,0.448508,0.450665,0.452852,0.455009,0.457136,0.459262,0.461389,0.463485,0.465611,0.467708,0.469773,0.471839,0.473935,0.47597,0.478036,0.480072,0.482077,0.484112,0.486117,0.488122,0.490127,0.492101,0.494106,0.496051,0.498025,0.5,0.501944,0.503888,0.505802,0.507746,0.50966,0.511574,0.513488,0.515371,0.517255,0.519138,0.521022,0.522905,0.524758,0.526611,0.528465,0.530318,0.53214,0.533993,0.535816,0.537639,0.539462,0.541254,0.543046,0.544839,0.546631,0.548423,0.550216,0.551978,0.553739,0.555501,0.557263,0.558995,0.560757,0.562489,0.56422,0.565952,0.567683,0.569384,0.571116,0.572817,0.574518,0.57622,0.57789,0.579592,0.581262,0.582964,0.584634,0.586305,0.587946,0.589617,0.591257,0.592928,0.594568,0.596209,0.597849,0.599459,0.6011,0.60271,0.60435,0.60596,0.60757,0.60915,0.61076,0.61237,0.61395,0.61556,0.617139,0.618719,0.620268,0.621848,0.623428,0.624977,0.626557,0.628106,0.629655,0.631205,0.632754,0.634303,0.635822,0.637372,0.63889,0.64044,0.641959,0.643478,0.644966,0.646485,0.648004,0.649523,0.651012,0.6525,0.653989,0.655477,0.656966,0.658454,0.659943,0.661431,0.66289,0.664378,0.665836,0.667294,0.668783,0.670241,0.671699,0.673127,0.674585,0.676043,0.677471,0.678929,0.680357,0.681785,0.683213,0.684641,0.686068,0.687496,0.688894,0.690321,0.691749,0.693147,0.694574,0.695972,0.697369,0.698767,0.700164,0.701561,0.702928,0.704326,0.705723,0.70711],N=[0,0.005863,0.013701,0.021569,0.029406,0.037244,0.045082,0.052919,0.060757,0.068625,0.076463,0.0843,0.092138,0.099976,0.107844,0.115681,0.123519,0.131357,0.139194,0.147032,0.1549,0.162738,0.170575,0.178413,0.186251,0.194119,0.201956,0.209794,0.217632,0.225469,0.233307,0.241175,0.249013,0.25685,0.264688,0.272526,0.280394,0.288231,0.296069,0.303907,0.311744,0.319582,0.32745,0.335288,0.343125,0.350963,0.3588,0.366669,0.374506,0.382344,0.390182,0.398019,0.405857,0.413725,0.421563,0.4294,0.437238,0.445076,0.452944,0.460781,0.468619,0.476457,0.484294,0.492132,0.5],y=[29024,27392,25856,24384,23040,21696,20480,19328,18240,17216,16256,15360,14512,13696,12928,12192,11520,10848,10240,9664,9120,8608,8128,7680,7256,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3628,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1814,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,227,214,202,190,180,169,160,151,142,134,127,120,113,107,101,95,90,85,80,75,71,67,63,60,57,53,50,48,45,42,40,38,36,34,32,30,28]
	})();
})();
